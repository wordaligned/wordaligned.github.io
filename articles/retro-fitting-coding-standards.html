<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="/images/favicon.png" type="image/png"/>
<link href="/styles/application.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/scripts/prettify.js"></script>
<script type="text/javascript" src="/scripts/lang-lisp.js"></script>
<script type="text/javascript" src="http://www.haloscan.com/load/wordaligned"></script>

<title>Retro-fitting coding standards</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Guest" />
<meta name="description" content="A Word Aligned article posted 2007-01-11, tagged C++, Python, Subversion, Java, Boost." />
<meta name="keywords" content="C++, Python, Subversion, Java, Boost" />
<link rel="alternate" type="application/rss+xml" title="Feed" href="http://feeds.wordaligned.org/wordaligned" />
</head>

<body onload="prettyPrint()">
<div id="container">
  <div id="header">
<h1><span><a accesskey="h" href="/">Word Aligned</a></span></h1>
<h2>sweating the small stuff</h2>
<a class="button" href="http://feeds.wordaligned.org/wordaligned" title="Subscribe to Word Aligned"><img style="float: right;" src="/images/feed.png" alt="Feed Logo" height="28" width="28"/></a>
</div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="retro-fitting-coding-standards">
<h2 class="title"><a href="/articles/retro-fitting-coding-standards">Retro-fitting coding standards</a></h2>
<p class="meta"><abbr class="published" title="2007-01-11">2007-01-11</abbr> &bull; <a href="/tag/c++" rel="tag">C++</a>, <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/subversion" rel="tag">Subversion</a>, <a href="/tag/java" rel="tag">Java</a>, <a href="/tag/boost" rel="tag">Boost</a> &bull; <a href="/articles/retro-fitting-coding-standards#disqus_thread">Comments</a></p>
<p>I&#8217;ve worked at more than one organisation where a retrospective
attempt has been made to set up a coding standard. This article
discusses why these attempts were made and how they went.</p>
<p><span id="continue-reading"/></p>
<h3 id="what-no-coding-standards">What, No Coding Standards!?</h3>
<p>When I say &#8220;a retrospective attempt&#8221;, I mean that plenty of code had
already been written &#8212; over a number of years, in fact &#8212; with no
existing coding standard in place. Is this a bad thing? Not
necessarily. Joel Spolsky&#8217;s 12 point <a href="http://www.joelonsoftware.com/articles/fog0000000043.html">checklist</a> on how to
write better code is generally sound, and in particular I think he
does well to <strong>not</strong> say:</p>
<blockquote>
<p>&#8220;Do you have a Coding Standard, and does everyone follow it?&#8221;</p>
</blockquote>
<p>In the cases I&#8217;m describing the code was in no way sub-standard. It
worked well. Its success had caused the team to grow, with all the
consequent problems, and in fact it wasn&#8217;t management who imposed
a coding standard, but the developers themselves who decided they 
wanted one.</p>
<h3 id="loss-of-freedom">Loss of Freedom</h3>
<p><span id="excerpt0"/>A good coding standard shouldn&#8217;t be there to constrain developers or force
them to comply to a particular coding style. In fact, most seasoned
programmers are careful not to waste energy arguing about coding
styles (which isn&#8217;t to say we don&#8217;t care, or don&#8217;t have opinions
on such matters &#8212; it&#8217;s just that we prefer not to waste energy).</p>
<p>For this very reason, a coding standard can help. By drawing a line
under arguments about where to place braces, how far to indent, what
to call things, and then moving on, we allow ourselves to concentrate
on solving more interesting problems. Even better, if everyone adopts
a consistent style, it becomes easier to work with code written
by colleagues.</p>
<p>The term &#8220;Coding Standards&#8221; suggests rules and red tape. It&#8217;s perhaps
the most common term, which is why I&#8217;ve been using it, but I think
guidelines are what are really required. In fact, as I&#8217;ll explain, we
don&#8217;t really need guidelines since the experts have already written
them for us. A &#8220;Style Guide&#8221; describing local conventions should be
quite enough.</p>
<h3 id="ask-the-experts">Ask the Experts</h3>
<p>All too often a corporate coding standard reads as an attempt by a
local expert to lay down rules on how to write good code: when to use
exceptions, why to pass arguments by constant reference, when to use
protected data members, etc.  At best, this is a waste of effort, and,
more likely (unless <a href="http://www.gotw.ca/">Herb Sutter</a> or <a href="http://www.aristeia.com/">Scott Meyers</a>
happens to be your local expert), there&#8217;s a high probability these
home-brewed rules will be wrong.</p>
<p><span id="excerpt1"/>It&#8217;s far better to provide a well-stocked library than to attempt
to write your own diluted imitations of Sutter and Meyers.</p>
<p>What <a href="http://www.gotw.ca/">Sutter</a> and <a href="http://www.aristeia.com/">Meyers</a> can&#8217;t do, though, is document your
local coding style &#8212; by which I mean those finickity things such as
what &copy; copyright notice goes in a header file, where braces get
placed, how far to indent, how to name things. That&#8217;s what goes in
your Style Guide.</p>
<h3 id="small-stuff">Small Stuff</h3>
<p>The Style Guide, then, will comprise entirely of what 
<a href="http://www.gotw.ca/publications/c++cs.htm">Sutter and Alexandrescu</a>
refer to as &#8220;small stuff&#8221;, about which their specific advice is:</p>
<blockquote>
<p>Item 0. Don&#8217;t sweat the small stuff.</p>
<p>&#8212; <a href="http://www.gotw.ca/publications/c++cs.htm">C++ Coding Standards</a>, Herb Sutter and Andrei Alexandrescu</p>
</blockquote>
<p>By this they mean:</p>
<blockquote>
<p>Issues that are really just personal taste and don&#8217;t affect correctness
don&#8217;t belong in a coding standard. Any professional programmer can easily
read and write code that is formatted a little differently than they&#8217;re
used to.</p>
</blockquote>
<p>Does this imply that even a Style Guide isn&#8217;t worth writing? And if so,
why ever did the team I was working on want one?</p>
<p>I agree with Sutter and Alexandrescu&#8217;s headline advice, but my take on
it is slightly different: yes, small stuff isn&#8217;t worth fussing over;
and yes, I&#8217;m capable of resetting my tabwidth to edit a file, and even
of adopting the brace placement rules and naming conventions in force
in that file &#8212; but it requires concentration and becomes
tiresome. What if there are several conflicting styles in a single
file? I prefer to work on a consistent code base, and so do most
programmers I&#8217;ve worked with. So some sweating turns out to be
necessary!</p>
<p>In this same section, 
<a href="http://www.gotw.ca/publications/c++cs.htm">Sutter and Alexandrescu</a> manage to
define a sensible naming convention in a single paragraph: this
demonstrates the level of detail we&#8217;re looking for. An entire Style
Guide should fit comfortably on a single page, otherwise 
it&#8217;s too fussy and won&#8217;t be adopted.</p>
<h3 id="re-use">Re-Use</h3>
<p>I hope we&#8217;ve agreed to resist the temptation to write our own feeble
imitations of 
<a href="http://www.gotw.ca/publications/c++cs.htm">&#8220;C++ Coding Standards&#8221;</a>, 
<a href="http://www.aristeia.com/books_frames.html">&#8220;Effective C++&#8221;</a>, 
and similar. Out-sourcing this kind of thing is appealing. Surely we 
could also reuse a coding style we&#8217;ve seen elsewhere?</p>
<h3 id="language-conventions">Language Conventions</h3>
<p>Up to now I&#8217;ve avoided explicitly mentioned what programming language
I&#8217;m talking about. If the language were <a href="http://www.java.com/">Java</a>,
then defining our Style Guide really shouldn&#8217;t be an issue: we&#8217;d just
cross-reference the 
<a href="http://java.sun.com/docs/codeconv/">Sun Java Programming Conventions</a>, 
configure an <a href="http://eclipse-cs.sourceforge.net/">Eclipse plugin</a> 
to enforce these conventions, share the configuration
and be done with it.</p>
<p>Similarly, <a href="http://python.org">Python</a> has a reasonably well-defined
preferred style &#8212; and its famous space-sensitivity unasks most
questions about code layout.</p>
<p>If it&#8217;s C++ we&#8217;re talking about, the ground rules are less clear, and
there&#8217;s a whole lot more syntax to fret about. Nonetheless, we could
draw inspiration from the C++ Standard Library, which follows a
consistent &#8212; if not formally documented &#8212; naming style. This is exactly
what <a href="http//boost.org">Boost</a> has chosen to do, and indeed parts of <a href="http//boost.org">Boost</a> are already
making their way into the C++ Library. Many of the Boost
<a href="http://boost.org/more/lib_guide.htm#Guidelines">guidelines</a> are specific to the Boost project, but we could
sensibly extract the short sections on naming and layout to form the
basis of our own Style Guide.</p>
<blockquote>
<p>Use the naming conventions of the C++ Standard Library (See Naming
conventions rationale): </p>
<ul>
<li>Names (except as noted below) should be all lowercase, with words separated by underscores.  </li>
<li>Acronyms should be treated as ordinary names (e.g. xml_parser instead of XML_parser).  </li>
<li>Template parameter names begin with an uppercase letter.  </li>
<li>Macro (gasp!) names all uppercase and begin with BOOST_.</li>
</ul>
<p>Choose meaningful names &#8212; explicit is better than implicit, and
readability counts. There is a strong preference for clear and
descriptive names, even if lengthy.  </p>
<p>&#8230;  </p>
<ul>
<li>Use fixed-width fonts.</li>
<li>Use spaces rather than tabs.</li>
<li>Limit line lengths to 80 characters.</li>
</ul>
</blockquote>
<p>Of course, if we&#8217;re retro-fitting a style guide, it&#8217;s unlikely that we
can just cut and paste the relevant sections of the Boost one. Another
great site is Sven Rosvall&#8217;s 
<a href="http://www.rosvall.ie/CSG/">Coding Standard Generator</a>, 
which allows you to generate your own coding standard by filling out a few forms.</p>
<h3 id="the-legacy-issue">The Legacy Issue</h3>
<p>What if, having got together our one page Style Guide, we find that,
say, only 50% the codebase fits that style? This is a serious concern,
and one which threatens the usefulness of the whole exercise.</p>
<p>A Style Guide is supposed to make things easier for new team members
to pick things up &#8212; but if they discover little of the codebase
follows the guide, then they&#8217;ll ignore it like everyone else seems
to. Similarly, experienced team members will resent effort spent on
writing a guide which only looks good on paper, and will ignore
it too.</p>
<p>There&#8217;s no easy way to tackle this issue, but there are a few viable
approaches:</p>
<ol>
<li>Relax the style guide. By loosening it to accomodate everything,
   everything conforms.</li>
<li>Refactor the entire codebase to meet the accepted style.</li>
<li>When working on a file, first refactor it to meet the accepted style.</li>
</ol>
<p>General C++ refactorings &#8212; to change the name of a class, for example
&#8212; can be surprisingly difficult to automate and guarantee. The
complexity of the language and its compilation model makes sure of
that. Nonetheless, it can be done if the benefits are judged
worthwhile. If you&#8217;re worried that changing code will break it, then
you probably don&#8217;t have a good suite of regression tests: setting up
and automating such a suite is <em>far</em> more important than code style
issues.</p>
<p>Simple refactorings &#8212; to expand tabs to spaces, or to eliminate
unwanted 
<a href="/articles/keyword-substitution-just-say-no.html">Subversion keywords</a>
 &#8212; are easier to apply. Once done,
they can be enforced using 
<a href="/articles/a-subversion-pre-commit-hook.html">hook scripts</a>.</p>
<p>In practice, a balance between the listed approaches combined with a
good dose of common sense provides our only way forward. The Style
Guide should be a living document which always reflects the current
code base. As is so often the case, we can iterate to get where we want,
starting from: step zero, no style guide, anything goes.</p>
</div>

<h5><a name="feedback">Feedback</a></h5>
<div id="feedback_div">
<ol id="feedback" class="feedback">

<li class="feedbackitem" id="feedback-226">
<div class="author">   
<cite>matthew.bowers@stonetable.org.uk</cite>
2007-01-21
</div>
<div class="content">
<p>Your Style Guide desk reference card lives on at one particular workplace ; )</p>

<p>Matt</p>

</div>
</li>


<li class="feedbackitem" id="feedback-227">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-01-22
</div>
<div class="content">
<p>Hi Matt. I didn't have much to say about how to publish the Style Guide. Since you mention it, I think a triple-folded quick reference card -- which programmers can print out and keep next to the keyboard -- is a good format. The electronic version should be version controlled (of course) and available in a couple of clicks from the Wiki front page.  Once again, let me promote <a href="http://blog.wordaligned.org/articles/2006/12/20/trac-not-just-a-pretty-interface" rel="nofollow">Trac</a>, which allows you to link to version controlled files, meaning your link won't grow stale.</p>

<p>Please don't use Microsoft Word for the Style Guide. Not everyone has Word installed. Word documents take too long to open and they start wittering about changes to read-only files when you try and close them. And don't use some fancy corporate template for the Style Guide. If you're aiming for a single page, as I suggest, then you can't waste space on an elaborate header -- which is of little use to the intended audience. </p>

</div>
</li>


<li class="feedbackitem" id="feedback-233">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-01-31
</div>
<div class="content">
<p>Here are a couple of related discussions at <a href="http://www.artima.com" rel="nofollow">Artima</a>: </p>

<ul>
<li><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=193517" rel="nofollow">How Important is Coding Style, and How Do You Enforce It?</a></li>
<li><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=74230" rel="nofollow">Style is Substance</a></li>
</ul>

</div>
</li>

</ol>
</div>


      
<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://wordaligned.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<script id="dsq-count-scr" src="//wordaligned.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
    <div id="sidebar">
      <div class="sidebar-node">
<h3>Excerpts</h3>
<p><a href="#excerpt0">A good coding standard shouldn't be there to constrain developers or force
them to comply to a particular coding style.</a></p>
<p><a href="#excerpt1">It's far better to provide a well-stocked library than to attempt
to write your own diluted imitations of Sutter and Meyers.</a></p>

</div>

<div class="sidebar-node">
<h3>Tagged</h3>
<ul id="categories"><li><a href="/tag/c++" rel="tag">C++</a></li>
<li><a href="/tag/python" rel="tag">Python</a></li>
<li><a href="/tag/subversion" rel="tag">Subversion</a></li>
<li><a href="/tag/java" rel="tag">Java</a></li>
<li><a href="/tag/boost" rel="tag">Boost</a></li></ul>

</div>

<div class="sidebar-node">
<h3>Chain</h3>
<ul>
<li><a accesskey="n" href="/articles/happy-mac" title="Next article">&laquo; Happy Mac</a></li>
<li><a accesskey="p" href="/articles/fold-left-right" title="Previous article">&raquo; fold left, right</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Feeds</h3>

<ul>
<li><a href="http://feeds.wordaligned.org/wordaligned"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Articles</a></li>
<li><a href="http://feeds.wordaligned.org/wordaligned/comments"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Comments</a></li>
</ul>


</div>

    </div>
  </div>
  <div id="footer">
<hr />
<p><a href="http://tag.wordaligned.org">Thomas Guest</a></p>
</div>

</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3373724-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>
</body>

</html>
