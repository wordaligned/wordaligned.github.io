<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="/images/favicon.png" type="image/png"/>
<link href="/styles/application.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/scripts/prettify.js"></script>
<script type="text/javascript" src="/scripts/lang-lisp.js"></script>
<script type="text/javascript" src="http://www.haloscan.com/load/wordaligned"></script>

<title>Code completion for dynamic languages</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Guest" />
<meta name="description" content="A Word Aligned article posted 2007-02-02, tagged Python, Ruby, Emacs, Dynamic Languages." />
<meta name="keywords" content="Python, Ruby, Emacs, Dynamic Languages" />
<link rel="alternate" type="application/rss+xml" title="Feed" href="http://feeds.wordaligned.org/wordaligned" />
</head>

<body onload="prettyPrint()">
<div id="container">
  <div id="header">
<h1><span><a accesskey="h" href="/">Word Aligned</a></span></h1>
<h2>space sensitive programming</h2>
<a class="button" href="http://feeds.wordaligned.org/wordaligned" title="Subscribe to Word Aligned"><img style="float: right;" src="/images/feed.png" alt="Feed Logo" height="28" width="28"/></a>
</div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="code-completion-for-dynamic-languages">
<h2 class="title"><a href="/articles/code-completion-for-dynamic-languages">Code completion for dynamic languages</a></h2>
<p class="meta"><abbr class="published" title="2007-02-02">2007-02-02</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/ruby" rel="tag">Ruby</a>, <a href="/tag/emacs" rel="tag">Emacs</a>, <a href="/tag/dynamic-languages" rel="tag">Dynamic Languages</a> &bull; <a href="/articles/code-completion-for-dynamic-languages#disqus_thread">Comments</a></p>
<p>Here&#8217;s an interesting <a href="http://www.regdeveloper.co.uk/2007/02/01/making_sense_ruby/">article</a> in which Huw Collingbourne describes
his frustration with trying to program a smart code completion system
for Visual Studio. The problem being, the code in question is
<a href="http://www.ruby-lang.org" title="Ruby Website">Ruby</a>. One particularly juicy quotation reads:</p>
<blockquote>
<p><span id="excerpt0"/>Ruby is a so-called &#8220;dynamic&#8221; language, which is a polite way of saying that it&#8217;s hugely unpredictable.</p>
</blockquote>
<p><span id="continue-reading"/></p>
<p>He goes on to explain:</p>
<blockquote>
<p>A <a href="http://www.ruby-lang.org" title="Ruby Website">Ruby</a> program is so dynamic that you can never be sure what it is
up to from one moment to the next. To take a simple example, when
you write some stand-alone functions into the editor, those
functions get bound into the base class of the entire Ruby class
hierarchy. That means that every single Ruby class automatically
&#8220;inherits&#8221; them - and the IntelliSense system is expected to know
about it!</p>
</blockquote>
<p>Despite overtly grumbling about dynamic languages, the author does a
good job of promoting them. <span id="excerpt1"/>Software is supposed to be soft and
dynamic languages help keep it that way. Everything is
open. Everything can be queried. Everything can be adapted.</p>
<h4 id="emacs-python-mode">Emacs Python mode</h4>
<p>My preferred IDE is <a href="http://www.gnu.org/software/emacs">emacs</a> &#8212; whatever language I&#8217;m using. It has a
particularly nice <a href="http://sourceforge.net/projects/python-mode">Python integration</a>.
Here&#8217;s how it works:</p>
<ul>
<li>Pull up a full-screen window</li>
<li>Split the window vertically</li>
<li>Use one side for the code you&#8217;re working on</li>
<li>Use the other side to run an interpreted <a href="http://python.org">Python</a> session</li>
<li>Switch sides as desired</li>
</ul>
<p>I continually select regions of code to execute. I continually step
into the interpreter and use the <a href="http://python.org">Python</a> <code>help</code> command to get help on
modules and functions &#8212; including the ones I&#8217;m creating right now.
I rework a function in one window then exercise it in the other. I
sketch experimental code, run it, rub it out.</p>
<p>Collingbourne says:</p>
<blockquote>
<p>Creating real
<a href="http://www.sapphiresteel.com/IntelliSense">IntelliSense</a> is much
harder. The only way to do it properly is to analyse the code much
as the Ruby interpreter itself does. The big difference is that the
interpreter only goes into operation when a program is complete &#8230;</p>
</blockquote>
<p>He spots the answer in one sentence &#8212; <em>to do it properly, you do have
to hook into the interpreter and its powers of reflection</em> &#8212; then misses
the point in the next. You just have to run the interpreter alongside the code
you&#8217;re developing, like emacs Python mode does.</p>
<h4 id="a-cheats-guide-to-code-completion">A cheat&#8217;s guide to code-completion</h4>
<p>Collingbourne also exposes some code-completion systems as &#8220;cheats&#8221;.</p>
<blockquote>
<p>Some code-completion systems solve this problem in a cunning way -
they cheat. Instead of working out what type of object x is at any
given moment, taking into account all the difficult stuff such as
its scope, inheritance and context, they work alphabetically. If
someone enters a dot followed by the letters &#8220;my&#8221;, they drop down a
list of names such as &#8220;my_method&#8221;, &#8220;my_othermethod&#8221; and
&#8220;my_random_guess&#8221; whether or not those methods have anything to do
with the object in question.</p>
</blockquote>
<p>Well, I&#8217;m happy to cheat using <a href="http://www.gnu.org/software/emacs">emacs</a> in this way. The <strong><code>ALT-/</code></strong>
combination uses alphabetic completion and I use it more
than any other key sequence, whatever document I&#8217;m working on. More
often than not, it does the right thing. As usual, simple solutions
are better.</p>
</div>

<h5><a name="feedback">Feedback</a></h5>
<div id="feedback_div">
<ol id="feedback" class="feedback">

<li class="feedbackitem" id="feedback-238">
<div class="author">   
<cite><a href="http://homepage.mac.com/keithray/blog/index.html">Keith Ray</a></cite>
2007-02-02
</div>
<div class="content">
<p>re - </p>

<ol>
<li>Pull up a full-screen window</li>
<li>Split the window vertically</li>
<li>Use one side for the code youâ€™re working on</li>
<li>Use the other side to run an interpreted Python session</li>
</ol>

<p>I was just thinking this morning that doing that on a projector would be a great way show off test-driven development in Python (or even Java).</p>

</div>
</li>


<li class="feedbackitem" id="feedback-246">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-02-04
</div>
<div class="content">
<p>Hi Keith. Doing <em>any</em> programming in front of an audience is brave, and makes very for convincing demonstration. </p>

<p>I've been lucky enough to attend the <a href="http://accu.org/index.php/conferences" rel="nofollow">ACCU conference</a> a few times and admire the speakers who have the ability to program live. <a href="http://www.gotw.ca/" rel="nofollow">Herb Sutter</a> excels at it.</p>

</div>
</li>


<li class="feedbackitem" id="feedback-360">
<div class="author">   
<cite>rubikitch</cite>
2007-04-11
</div>
<div class="content">
rct-complete in `rcodetools' package does editor-independent accurate completion.
Instead of analyzing Ruby code, rct-complete actually executes the code to get candidates.

</div>
</li>


<li class="feedbackitem" id="feedback-362">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-04-12
</div>
<div class="content">
<p>rubikitch, thanks for the note -- that's exactly the kind of intelligent code completion technique I was talking about. </p>

</div>
</li>


<li class="feedbackitem" id="feedback-395">
<div class="author">   
<cite>vais</cite>
2007-04-17
</div>
<div class="content">
<p>rubikitch, am I missing something, or is this an extremely dangerous way to do completion? I have been struggling with this thought for a while, could you please explain your reasoning as to how it is ok to run arbitrary code to provide completion candidates. Side effects, anybody? </p>

<p>For example, copy and paste any sample code from <a href="http://www.webrick.org" rel="nofollow">www.webrick.org</a>, and then invoke completion in your editor of choice. What happens? Well, at a minimum you get an http server running on port 2000, and, I suppose depending on the editor in question, it hangs as the ruby code blocks. I have not tried this with things like File.delete, but even if you blacklist certain things, you can never be 100% sure that there are no negative side effects from executing the code you happen to be editing. </p>

<p>So, the question is whether 100% accurate completion is worth the price of uncertainty about the consequences of code execution. I have never been more looking forward to being proved wrong as on this one.</p>

</div>
</li>


<li class="feedbackitem" id="feedback-397">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-04-17
</div>
<div class="content">
<p>vais, I haven't actually used <a href="http://www.google.com/search?q=rct-complete" rel="nofollow">rct-complete</a> myself, and I haven't found any definitive documentation online, but I think the programmer is fully in charge of what gets executed and when. Determining code-complete options can be done using an object's reflection interfaces; then you can select the method and decide if you want to run the code.</p>

<p>Developing any code is "dangerous", but narrowing the gap between writing and executing code reduces the risk.</p>

</div>
</li>


<li class="feedbackitem" id="feedback-420">
<div class="author">   
<cite>vais</cite>
2007-04-19
</div>
<div class="content">
<p>Thomas, I could not agree with you more on the points you make in this post regarding your Emacs setup for working with Python -- my workflow in Ruby is almost identical. </p>

<p>"...to do it properly, you do have to hook into the interpreter and its powers of reflection..." could not be more dead on. </p>

<p>However, you should at least try rct-complete before jumping to the conclusion that it does the right thing, somehow, magically. That is just plain ole wishfull thinking. And, yes, I could not find any documentation either (that would explain the principles behind its operation). I guess the author did not want to kill the magic...</p>

<p>Of course Ruby code must be executed in order to obtain code-complete options, and that is exacly what the tool does. Here, try this:</p>

<ol>
<li>create a file named test.txt</li>
<li>create a file named test.rb, and type the following:
File.rename('test.txt', 'oops.txt')</li>
<li>Hit enter, and type this: 
Dir.</li>
<li>because my editor is set up to call rct-complete when a period is pressed, completion happens, and I get a list of everything the Dir class can do, great!</li>
</ol>

<p>Now, look into the directory where your test.txt and test.rb are. What do you see? oops.txt and test.rb.</p>

<p>I am all for narrowing the gap between writing and executing code, but if this example does not scare you, nothing will. That is just not the way to do it. </p>

<p>Once again, I wish it had some magic and just did the right thing, but a simple test points to the contrary. If only rubikitch would make some of his reasoning behind rct-complete publicly available, but alas...</p>

</div>
</li>


<li class="feedbackitem" id="feedback-421">
<div class="author">   
<cite><a href="http://wordaligned.org">Thomas Guest</a></cite>
2007-04-19
</div>
<div class="content">
<p>vais, you're quite right, I can't really comment on rct-complete because I haven't used it; and although I'm interested in Ruby, I hardly ever program in it, so I won't be able to provide any more informed comments. Thanks too for the use case. I take your point. I am confused though: are you saying you use rct-complete, even though it's so dangerous, or when you say "my editor" do you mean "the editor"?</p>

</div>
</li>


<li class="feedbackitem" id="feedback-432">
<div class="author">   
<cite>vais</cite>
2007-04-19
</div>
<div class="content">
<p>Thomas, I <em>would love</em> to be able to use rct-complete, so when I found it, I got really excited. Of course the next step is to try it, and, it surely did all the things it was supposed to do - what a joy!</p>

<p>The trouble started when I discovered that if there are any syntax errors in the code, or even a mis-typed method name, autocompletion stopped working for the entire file until those things were removed. So, I started digging... and the rest is documented above.</p>

<p>So, to answer your question, I am not speaking in the abstract, and by "my editor" I really do mean my editor. BTW my editor for many years has been SciTE (<a href="http://www.scintilla.org/SciTE.html" rel="nofollow">http://www.scintilla.org/SciTE.html</a>) - a Lua-scriptable tiny wonder (which by the way was orginally created as just a demo of the Scintilla component which in turn was created because the author wanted a better editing component for working with Python code)</p>

<p>Mitchell made it even more perfect(tm) with his scite-tools project you can see here: <a href="http://caladbolg.net/scite.php" rel="nofollow">http://caladbolg.net/scite.php</a>, and scite-tools comes with rct-complete baked right in. Fortunately disabling it is just commenting out a line of Lua, which is what I unfortunatelly had to do as a result of my findings. I must add that scite-tools is MUCH more than that, and anybody who uses SciTE owes it to themselves to check it out. This is the best example I have seen of tapping into the power of Lua under the hood of this editor to do amazing things.</p>

</div>
</li>


<li class="feedbackitem" id="feedback-485">
<div class="author">   
<cite>rubikitch</cite>
2007-04-28
</div>
<div class="content">
I just implemented Test-Driven Completion (TDC) in rcodetools.
TDC means that completion in a method, current implementation cannot do, uses a unit test.
Test scripts are self-enclosed and expected to be executed, so side-effects are not problem.

If you want to use the development version, try
  darcs get <a href="http://eigenclass.org/repos/rcodetools/head" rel="nofollow">http://eigenclass.org/repos/rcodetools/head</a> rcodetools
After `darcs get' the repository,
  darcs pull
updates your local repository.


</div>
</li>

</ol>
</div>


      
<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://wordaligned.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<script id="dsq-count-scr" src="//wordaligned.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
    <div id="sidebar">
      <div class="sidebar-node">
<h3>Excerpts</h3>
<p><a href="#excerpt0">Ruby is a so-called "dynamic" language, which is a polite way of saying that it's hugely unpredictable.</a></p>
<p><a href="#excerpt1">Software is supposed to be soft and
dynamic languages help keep it that way.</a></p>

</div>

<div class="sidebar-node">
<h3>Tagged</h3>
<ul id="categories"><li><a href="/tag/python" rel="tag">Python</a></li>
<li><a href="/tag/ruby" rel="tag">Ruby</a></li>
<li><a href="/tag/emacs" rel="tag">Emacs</a></li>
<li><a href="/tag/dynamic-languages" rel="tag">Dynamic Languages</a></li></ul>

</div>

<div class="sidebar-node">
<h3>Chain</h3>
<ul>
<li><a accesskey="n" href="/articles/bin2hex-py" title="Next article">&laquo; bin2hex.py</a></li>
<li><a accesskey="p" href="/articles/casualties-in-the-great-computer-shootout" title="Previous article">&raquo; Casualties in the great computer shootout</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Feeds</h3>

<ul>
<li><a href="http://feeds.wordaligned.org/wordaligned"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Articles</a></li>
<li><a href="http://feeds.wordaligned.org/wordaligned/comments"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Comments</a></li>
</ul>


</div>

    </div>
  </div>
  <div id="footer">
<hr />
<p><a href="http://tag.wordaligned.org">Thomas Guest</a></p>
</div>

</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3373724-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>
</body>

</html>
