<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="/images/favicon.png" type="image/png"/>
<link href="/styles/application.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/scripts/prettify.js"></script>
<script type="text/javascript" src="/scripts/lang-lisp.js"></script>
<title>Longest common subsequence</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Guest" />
<meta name="description" content="An investigation into the classic computer science problem of calculating the longest common subsequence of two sequences, and its relationship to the edit distance and longest increasing subsequence problems. A Word Aligned article posted 2009-03-11, tagged Algorithms, Python, C++, Lcs, CLRS, Animation." />
<meta name="keywords" content="Algorithms, Python, C++, Lcs, CLRS, Animation" />
<link rel="alternate" type="application/rss+xml" title="Feed" href="http://feeds.wordaligned.org/wordaligned" />
</head>

<body onload="prettyPrint()">
<div id="container">
  <div id="header">
<h1><span><a accesskey="h" href="/">Word Aligned</a></span></h1>
<h2>space sensitive programming</h2>
<a class="button" href="http://feeds.wordaligned.org/wordaligned" title="Subscribe to Word Aligned"><img style="float: right;" src="/images/feed.png" alt="Feed Logo" height="28" width="28"/></a>
</div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="longest-common-subsequence">
<h2 class="title"><a href="/articles/longest-common-subsequence">Longest common subsequence</a></h2>
<p class="meta"><abbr class="published" title="2009-03-11">2009-03-11</abbr> &bull; <a href="/tag/algorithms" rel="tag">Algorithms</a>, <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/c++" rel="tag">C++</a>, <a href="/tag/lcs" rel="tag">Lcs</a>, <a href="/tag/clrs" rel="tag">CLRS</a>, <a href="/tag/animation" rel="tag">Animation</a> &bull; <a href="/articles/longest-common-subsequence#disqus_thread">Comments</a></p>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>
<script type="text/javascript">
function reset(i) {
    jQuery("div.lcs" + i).hide();
}

function slowdown(j, pause) {
    return j == 100 ? pause * 2 : pause;
}

function shownext(i, j, pause) {
    pause = slowdown(j, pause);
    var it1 = jQuery("#lcs" + i + j++);
    var it2 = jQuery("#lcs" + i + j++);
    if (it1.length != 0) {
        it1.fadeIn(pause);
        it2.fadeIn(pause, function() { shownext(i, j, pause); });
    }
}

function animatelcs(i) {
    reset(i);
    shownext(i, 0, 500);
}
</script>

<div style="font: normal 48px arial, sans-serif; height: 12em;text-align: center;">
<div style="border: 2px solid rgb(0, 0, 0); float: left; line-height: normal; background-color: rgb(255, 255, 255);">
<div style="overflow: hidden; width: 6em; height: 12em;">
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 0em;"><span style="font-size:90%; color: #333;"> </span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 1em; padding-top: 0em;"><span style="font-size:90%; color: #333;">H</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 2em; padding-top: 0em;"><span style="font-size:90%; color: #333;">U</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 3em; padding-top: 0em;"><span style="font-size:90%; color: #333;">M</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 4em; padding-top: 0em;"><span style="font-size:90%; color: #333;">A</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 5em; padding-top: 0em;"><span style="font-size:90%; color: #333;">N</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 1em;"><span style="font-size:90%; color: #333;">C</span></div>
<div class="lcs1" id="lcs10" style="position: absolute; padding-left: 1em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs1" id="lcs11" style="position: absolute; padding-left: 1em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs12" style="position: absolute; padding-left: 2em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs1" id="lcs13" style="position: absolute; padding-left: 2em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs14" style="position: absolute; padding-left: 3em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs1" id="lcs15" style="position: absolute; padding-left: 3em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs16" style="position: absolute; padding-left: 4em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs1" id="lcs17" style="position: absolute; padding-left: 4em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs18" style="position: absolute; padding-left: 5em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs1" id="lcs19" style="position: absolute; padding-left: 5em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 2em;"><span style="font-size:90%; color: #333;">H</span></div>
<div class="lcs1" id="lcs110" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs111" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs1" id="lcs112" style="position: absolute; padding-left: 2em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs113" style="position: absolute; padding-left: 2em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs114" style="position: absolute; padding-left: 3em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs115" style="position: absolute; padding-left: 3em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs116" style="position: absolute; padding-left: 4em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs117" style="position: absolute; padding-left: 4em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs118" style="position: absolute; padding-left: 5em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs119" style="position: absolute; padding-left: 5em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 3em;"><span style="font-size:90%; color: #333;">I</span></div>
<div class="lcs1" id="lcs120" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs121" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs122" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs123" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs124" style="position: absolute; padding-left: 3em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs125" style="position: absolute; padding-left: 3em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs126" style="position: absolute; padding-left: 4em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs127" style="position: absolute; padding-left: 4em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs128" style="position: absolute; padding-left: 5em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs129" style="position: absolute; padding-left: 5em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 4em;"><span style="font-size:90%; color: #333;">M</span></div>
<div class="lcs1" id="lcs130" style="position: absolute; padding-left: 1em; padding-top: 4em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs131" style="position: absolute; padding-left: 1em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs132" style="position: absolute; padding-left: 2em; padding-top: 4em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs133" style="position: absolute; padding-left: 2em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs134" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs135" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs1" id="lcs136" style="position: absolute; padding-left: 4em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs137" style="position: absolute; padding-left: 4em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs138" style="position: absolute; padding-left: 5em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs139" style="position: absolute; padding-left: 5em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 5em;"><span style="font-size:90%; color: #333;">P</span></div>
<div class="lcs1" id="lcs140" style="position: absolute; padding-left: 1em; padding-top: 5em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs141" style="position: absolute; padding-left: 1em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs142" style="position: absolute; padding-left: 2em; padding-top: 5em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs143" style="position: absolute; padding-left: 2em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs144" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs145" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs146" style="position: absolute; padding-left: 4em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs147" style="position: absolute; padding-left: 4em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs148" style="position: absolute; padding-left: 5em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs149" style="position: absolute; padding-left: 5em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 6em;"><span style="font-size:90%; color: #333;">A</span></div>
<div class="lcs1" id="lcs150" style="position: absolute; padding-left: 1em; padding-top: 6em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs151" style="position: absolute; padding-left: 1em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs152" style="position: absolute; padding-left: 2em; padding-top: 6em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs153" style="position: absolute; padding-left: 2em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs154" style="position: absolute; padding-left: 3em; padding-top: 6em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs155" style="position: absolute; padding-left: 3em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs156" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs157" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs1" id="lcs158" style="position: absolute; padding-left: 5em; padding-top: 6em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs159" style="position: absolute; padding-left: 5em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 7em;"><span style="font-size:90%; color: #333;">N</span></div>
<div class="lcs1" id="lcs160" style="position: absolute; padding-left: 1em; padding-top: 7em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs161" style="position: absolute; padding-left: 1em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs162" style="position: absolute; padding-left: 2em; padding-top: 7em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs163" style="position: absolute; padding-left: 2em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs164" style="position: absolute; padding-left: 3em; padding-top: 7em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs165" style="position: absolute; padding-left: 3em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs166" style="position: absolute; padding-left: 4em; padding-top: 7em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs167" style="position: absolute; padding-left: 4em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs168" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs1" id="lcs169" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 8em;"><span style="font-size:90%; color: #333;">Z</span></div>
<div class="lcs1" id="lcs170" style="position: absolute; padding-left: 1em; padding-top: 8em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs171" style="position: absolute; padding-left: 1em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs172" style="position: absolute; padding-left: 2em; padding-top: 8em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs173" style="position: absolute; padding-left: 2em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs174" style="position: absolute; padding-left: 3em; padding-top: 8em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs175" style="position: absolute; padding-left: 3em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs176" style="position: absolute; padding-left: 4em; padding-top: 8em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs177" style="position: absolute; padding-left: 4em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs178" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs1" id="lcs179" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 9em;"><span style="font-size:90%; color: #333;">E</span></div>
<div class="lcs1" id="lcs180" style="position: absolute; padding-left: 1em; padding-top: 9em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs181" style="position: absolute; padding-left: 1em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs182" style="position: absolute; padding-left: 2em; padding-top: 9em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs183" style="position: absolute; padding-left: 2em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs184" style="position: absolute; padding-left: 3em; padding-top: 9em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs185" style="position: absolute; padding-left: 3em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs186" style="position: absolute; padding-left: 4em; padding-top: 9em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs187" style="position: absolute; padding-left: 4em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs188" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs1" id="lcs189" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 10em;"><span style="font-size:90%; color: #333;">E</span></div>
<div class="lcs1" id="lcs190" style="position: absolute; padding-left: 1em; padding-top: 10em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs191" style="position: absolute; padding-left: 1em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs192" style="position: absolute; padding-left: 2em; padding-top: 10em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs1" id="lcs193" style="position: absolute; padding-left: 2em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs1" id="lcs194" style="position: absolute; padding-left: 3em; padding-top: 10em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs1" id="lcs195" style="position: absolute; padding-left: 3em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs196" style="position: absolute; padding-left: 4em; padding-top: 10em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs1" id="lcs197" style="position: absolute; padding-left: 4em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs198" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs1" id="lcs199" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs1" id="lcs1100" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1101" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1102" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1103" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1104" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1105" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1106" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs1" id="lcs1108" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs1" id="lcs1110" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1111" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1112" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs1" id="lcs1114" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2190;</span></div>
<div class="lcs1" id="lcs1115" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2190;</span></div>
<div class="lcs1" id="lcs1116" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1117" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs1" id="lcs1118" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs1" id="lcs1107" style="position: absolute; padding-left: 5em; padding-top: 11em;"><span style="font-size:75%; color: #930;">N</span></div>
<div class="lcs1" id="lcs1109" style="position: absolute; padding-left: 4em; padding-top: 11em;"><span style="font-size:75%; color: #930;">A</span></div>
<div class="lcs1" id="lcs1113" style="position: absolute; padding-left: 3em; padding-top: 11em;"><span style="font-size:75%; color: #930;">M</span></div>
<div class="lcs1" id="lcs1119" style="position: absolute; padding-left: 1em; padding-top: 11em;"><span style="font-size:75%; color: #930;">H</span></div>
</div>
</div>
</div>

<p><button id="animatelcs1" onclick="animatelcs(1);">Calculate LCS</button></p>
<p>I pinched the idea for this animation from Ned Batchelder&#8217;s <a href="http://nedbatchelder.com/blog/200805/css_homer_animated.html">clever visualisation</a> of Rom&aacute;n Cort&eacute;s&#8217; brilliant <a href="http://www.romancortes.com/blog/homer-css/">CSS Homer Simpson</a>. It depends on Javascript, CSS and a font containing upwards, leftwards and north west <a href="http://www.alanwood.net/unicode/arrows.html">arrows</a>.  If it doesn&#8217;t work in your user agent, <a href="http://www.mozilla.org/firefox" title="Try Firefox!">my apologies</a>. If you&#8217;d like to find out why I&#8217;m comparing humans with chimpanzees, read on!</p>
<p><span id="continue-reading"/></p>
<h3 id="retracing-our-steps">Retracing our steps</h3>
<p>Taking a brief step back, this article is the third of a series. In the first episode <a href="/articles/a-race-within-a-race.html">we posed a puzzle</a>:</p>
<blockquote>
<p>Starting with a list of runners ordered by finishing time, select a sublist of runners who are getting younger. <strong>What is the longest such sublist?</strong></p>
</blockquote>
<p>In the second episode <a href="/articles/ordered-sublists-a-brute-force-approach.html">we coded up a brute force solution</a> which searched all possible sublists to find an optimal solution. Although the code was simple and succinct, its exponential complexity made it unsuitable for practical use.</p>
<p>In this episode we&#8217;ll discuss an elegant algorithm which solves our particular problem as a special case. On the way we&#8217;ll visit dynamic programming, Python decorators, version control and genetics.</p>
<p>An outline of the approach is:</p>
<ol>
<li>forget about races, runners and ages</li>
<li>the essence of the problem is to determine the longest <strong>ordered</strong> subsequence found within a given sequence R</li>
<li>which is a measure of how close R is to being ordered</li>
<li>so, take a copy of R and sort it using our ordering criterion to form the sequence S</li>
<li>the subsequences of R which are also subsequences of S are precisely the ordered subsequences of R</li>
<li>so any <strong>longest subsequence common to both R and S</strong> is actually a longest ordered subsequence of R</li>
<li>which is exactly what we&#8217;re looking for!</li>
</ol>
<p>Copying and sorting finite sequences is straightforward (and efficient implementations can be found in any standard library), so the steps above reduce our problem to an application of a more general problem: how to find the <strong>longest common subsequence</strong> of two sequences.</p>
<h3 id="simple-example">Simple example</h3>
<p>As a simple example I&#8217;ve highlighted &#8220;HMAN&#8221;, the longest subsequence common to both &#8220;HUMAN&#8221; and &#8220;CHIMPANZEE&#8221;</p>
<p style="margin: 0;font-size:400%"><span style="color:#930">H</span> U <span style="color:#930">M</span> <span style="color:#930">A</span> <span style="color:#930">N</span></p>
<p style="margin:0;font-size:400%">C <span style="color:#930">H</span> I <span style="color:#930">M</span> P <span style="color:#930">A</span> <span style="color:#930">N</span> Z E E</p>

<p>Let&#8217;s note up front that there may not be a unique LCS of two sequences (as a trivial example, &#8220;A&#8221; and &#8220;B&#8221; are both LCSes of &#8220;AB&#8221;, &#8220;BA&#8221;), which is why we&#8217;ll talk about <strong>a</strong> longest common subsequence rather than <strong>the</strong> longest common subsequence.</p>
<p>We can also rule out a simple divide and conquer scheme. We can&#8217;t just split both inputs in half and join together the LCSes of the beginnings and endings to form an answer. Consider finding the LCS of &#8220;123ABC&#8221;, &#8220;DEF123&#8221; for example &#8212; concatenating the LCSes of &#8220;123&#8221;, &#8220;DEF&#8221; and &#8220;ABC&#8221;, &#8220;123&#8221; gives the empty string, which is clearly wrong. (We&#8217;ll see later that a more sophisticated divide and conquer scheme <strong>does</strong> exist, but it comes at a cost.)</p>
<h3 id="a-recursive-approach">A recursive approach</h3>
<p>An elegant recursive approach to solving this problem is based around the observation that the LCS of two sequences can be built from the LCSes of prefixes of these sequences. In algorithm speak, the longest common subsequence problem has <a href="http://en.wikipedia.org/wiki/Optimal_substructure">optimal substructure</a>.</p>
<div class="typocode">

<pre class="prettyprint">def lcs(xs, ys):
    &#x27;&#x27;&#x27;Return a longest common subsequence of xs and ys.

    Example
    &gt;&gt;&gt; lcs("HUMAN", "CHIMPANZEE")
    [&#x27;H&#x27;, &#x27;M&#x27;, &#x27;A&#x27;, &#x27;N&#x27;]
    &#x27;&#x27;&#x27;
    if xs and ys:
        *xb, xe = xs
        *yb, ye = ys
        if xe == ye:
            return lcs(xb, yb) + [xe]
        else:
            return max(lcs(xs, yb), lcs(xb, ys), key=len)
    else:
        return []

</pre>

</div>

<div class="amazon"><a title="CLRS at Amazon" href="http://www.amazon.com/gp/product/0262032937?ie=UTF8&amp;tag=wordalig-20"><img src="/images/books/clrs.jpg" alt="CLRS cover"/></a></div>

<p>A formal explanation of why this works would be much longer than the code. I&#8217;ll sketch out the reasoning, but for a more rigorous approach I recommend Cormen, Leiserson, Rivest and Stein&#8217;s classic reference, <a href="http://www.amazon.com/gp/product/0262032937?ie=UTF8&amp;tag=wordalig-20" title="CLRS at Amazon">&#8220;Introduction to Algorithms&#8221;</a> (CLRS).</p>
<p>Essentially, if either input is empty, then the answer is just the empty sequence. Otherwise, split <code>xs</code> into its beginning, <code>xb</code>, and its final element <code>xe</code>; and similarly for <code>ys</code>. If the value <code>xe</code> equals <code>ye</code>, then <code>lcs(xs, ys)</code> must end with this value, and the remainder of <code>lcs(xs, ys)</code> must solve <code>lcs(xb, yb)</code>. Otherwise, the longer of <code>lcs(xs, yb)</code> and <code>lcs(xb, ys)</code> must be a solution to <code>lcs(xs, ys)</code>.</p>
<p>By the way, the assignment <code>*xb, xe = xs</code> is a nice example of Python 3.0&#8217;s <a href="http://www.python.org/dev/peps/pep-3132/">extended unpacking syntax</a>. In Python 2.6 and earlier you might write <code>xb, xe = xs[:-1], xs[-1]</code>.</p>
<p>The recursion here is interesting. At each step, we compare two elements from the original inputs. Depending on the result, we must evaluate either one or two smaller LCSes.</p>
<p>Note also the call to <code>max</code> in the recursion. At this point, the algorithm chooses between two prefix pairs of the original inputs, <code>(xs, yb)</code> and <code>(xb, ys)</code>, based on the length of their LCSes. Here&#8217;s the source of multiple solutions: <code>max()</code> returns the larger of its two arguments, and if <code>lcs(xs, yb)</code> and <code>lcs(xb, ys)</code> have equal lengths, I suspect the first will always be selected; but if we wanted all LCSes rather than any one LCS, we would have to continue down both routes. </p>
<p>The other important point to make here is that, in any case, both routes must be fully evaluated before a choice can be made. Loosely speaking, every additional step can double the workload. This is a problem!</p>
<h3 id="problems-with-the-recursive-solution">Problems with the recursive solution</h3>
<p>Work is needed to turn the recursive solution into a practical one. The key issue is that the recursive algorithm calculates the LCS of the same prefix pair multiple times. Let&#8217;s run a quick code experiment to show this. Starting with the version of <code>lcs()</code> shown above, we can adapt it to keep track of call counts<a id="fn1link" href="#fn1"><sup><a href="https://blog.codeship.com/building-minimal-docker-containers-for-go-applications/">1</a></sup></a>.</p>
<div class="typocode">

<pre class="prettyprint">from collections import defaultdict
concat = &#x27;&#x27;.join

def lcs(xs, ys):
    ....

def count_lcs_calls(lcs):
    &#x27;&#x27;&#x27;Return a pair (lcs, calls)

    Where:
    lcs - a wrapped version of lcs, which counts up calls
    calls - a dict mapping arg pairs to the number of times lcs
    has been called with these args.
    &#x27;&#x27;&#x27;
    calls = defaultdict(int)
    def wrapped(xs, ys):
        calls[(concat(xs), concat(ys))] += 1
        return lcs(xs, ys)
    return wrapped, calls

lcs, calls = count_lcs_calls(lcs)

</pre>

</div>

<p>If <code>count_lcs_calls()</code> reminds you of a <a href="/articles/echo.html">Python decorator</a>, good! That&#8217;s pretty much how it works. We can now call the newly decorated version of <code>lcs</code> and examine the <code>calls</code> dict to see what&#8217;s been going on.</p>
<p>With two completely different inputs, the recursive algorithm never passes the <code>xe == ye</code> test, and must always consider another pair of prefixes of the inputs.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; lcs(&#x27;MAN&#x27;, &#x27;PIG&#x27;)
[]
&gt;&gt;&gt; print(*sorted((v, k) for k, v in calls.items()), sep=&#x27;\n&#x27;)
(1, (&#x27;&#x27;, &#x27;PIG&#x27;))
(1, (&#x27;M&#x27;, &#x27;PIG&#x27;))
(1, (&#x27;MA&#x27;, &#x27;PIG&#x27;))
(1, (&#x27;MAN&#x27;, &#x27;&#x27;))
(1, (&#x27;MAN&#x27;, &#x27;P&#x27;))
(1, (&#x27;MAN&#x27;, &#x27;PI&#x27;))
(1, (&#x27;MAN&#x27;, &#x27;PIG&#x27;))
(2, (&#x27;MA&#x27;, &#x27;PI&#x27;))
(3, (&#x27;&#x27;, &#x27;PI&#x27;))
(3, (&#x27;M&#x27;, &#x27;PI&#x27;))
(3, (&#x27;MA&#x27;, &#x27;&#x27;))
(3, (&#x27;MA&#x27;, &#x27;P&#x27;))
(6, (&#x27;&#x27;, &#x27;P&#x27;))
(6, (&#x27;M&#x27;, &#x27;&#x27;))
(6, (&#x27;M&#x27;, &#x27;P&#x27;))

</pre>

</div>

<p><a href="http://en.wikipedia.org/wiki/Pascal's_triangle"><img style="float:right" src="http://upload.wikimedia.org/wikipedia/commons/0/0d/PascalTriangleAnimated2.gif" alt="Pascal's triangle"/></a></p>
<p>Here, we show the LCS of &#8220;MAN&#8221; and &#8220;PIG is the empty sequence. The next command prints the call counts to standard output, showing that e.g. we calculate <code>lcs('MA', 'PI')</code> twice and <code>lcs('M', 'P')</code> six times. It should be no surprise to see these call counts appearing in Pascal&#8217;s triangle.</p>
<p>At the other extreme, given identical inputs the recursion zips straight through the identical prefixes, and no call is repeated.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; calls.clear()
&gt;&gt;&gt; lcs(&#x27;CHIMP&#x27;, &#x27;CHIMP&#x27;)
[&#x27;C&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;M&#x27;, &#x27;P&#x27;]
&gt;&gt;&gt; print(*sorted((v, k) for k, v in calls.items()), sep=&#x27;\n&#x27;)
(1, (&#x27;&#x27;, &#x27;&#x27;))
(1, (&#x27;C&#x27;, &#x27;C&#x27;))
(1, (&#x27;CH&#x27;, &#x27;CH&#x27;))
(1, (&#x27;CHI&#x27;, &#x27;CHI&#x27;))
(1, (&#x27;CHIM&#x27;, &#x27;CHIM&#x27;))
(1, (&#x27;CHIMP&#x27;, &#x27;CHIMP&#x27;))

</pre>

</div>

<p>Generally, though, we won&#8217;t be so lucky. By the time I interrupted a call to find the LCS of two short strands of DNA, there had already been a total of over 200 million recursive calls to the function, and we&#8217;d compared <code>'A'</code> and <code>'G'</code> alone over 24 million times. The algorithm, as presented, is of exponential complexity, hence suitable for only the briefest of inputs.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; lcs(&#x27;ACCGGTCGAGTGCGCGGAAGCCGGCCGAA&#x27;, &#x27;GTCGTTCGGAATGCCGTTGCTCTGTAAA&#x27;)
....
KeyboardInterrupt
&gt;&gt;&gt; sum(calls.values())
227603392
&gt;&gt;&gt; max(calls.values())
24853152
&gt;&gt;&gt; import operator
&gt;&gt;&gt; value = operator.itemgetter(1)
&gt;&gt;&gt; mostcalled = list(sorted(calls.items(), key=value))[-5:]
&gt;&gt;&gt; print(*mostcalled, sep=&#x27;\n&#x27;)
((&#x27;&#x27;, &#x27;GT&#x27;), 13182769)
((&#x27;A&#x27;, &#x27;GT&#x27;), 13182769)
((&#x27;A&#x27;, &#x27;G&#x27;), 24853152)
((&#x27;&#x27;, &#x27;G&#x27;), 24853152)
((&#x27;A&#x27;, &#x27;&#x27;), 24853152)

</pre>

</div>

<h3 id="dynamic-programming">Dynamic programming</h3>
<p>We&#8217;ve already seen the LCS of two sequences can be built from the LCSes of prefixes of these subsequences; that is, an optimal solution to the problem can be built from optimal solutions to subproblems, a property known as <strong>optimal substructure</strong>. Our code experiment above shows that the subproblems repeat, possibly many times. This second property, of <strong>overlapping subproblems</strong>, means we have a classic example of a problem we can solve using <a href="http://en.wikipedia.org/wiki/Dynamic_Programming">dynamic programming</a>. There are a couple of standard ways to progress:</p>
<ul>
<li>memoization</li>
<li>converting from top-down to bottom-up</li>
</ul>
<p>Let&#8217;s try these out.</p>
<h3 id="memoize">Memoize</h3>
<p>Memoization is a simple idea. Rather than repeatedly recalculate a function for the same input values, we cache the result of each call, keyed by the function call arguments. If, as in this case, full evaluation is expensive compared to the look-up, and we&#8217;ve got space for the cache, then the technique makes sense.</p>
<p>In Python, we can write an adaptor function which converts our original function into a memoized version of itself. Here&#8217;s just such an adaptor for functions which take an arbitrary number of positional parameters.</p>
<div class="typocode">

<pre class="prettyprint">def memoize(fn):
    &#x27;&#x27;&#x27;Return a memoized version of the input function.

    The returned function caches the results of previous calls.
    Useful if a function call is expensive, and the function 
    is called repeatedly with the same arguments.
    &#x27;&#x27;&#x27;
    cache = dict()
    def wrapped(*v):
        key = tuple(v) # tuples are hashable, and can be used as dict keys
        if key not in cache:
            cache[key] = fn(*v)
        return cache[key]
    return wrapped

</pre>

</div>

<p>We can use this to <a href="http://docs.python.org/py3k/reference/compound_stmts.html#function">decorate</a> our longest common subsequence function. I&#8217;ve also taken the opportunity to bypass some of the list splitting, creating an inner function which uses indices into the original <code>xs</code> and <code>ys</code> inputs.</p>
<div class="typocode">

<pre class="prettyprint">def lcs(xs, ys):
    &#x27;&#x27;&#x27;Return the longest subsequence common to xs and ys.

    Example
    &gt;&gt;&gt; lcs("HUMAN", "CHIMPANZEE")
    [&#x27;H&#x27;, &#x27;M&#x27;, &#x27;A&#x27;, &#x27;N&#x27;]
    &#x27;&#x27;&#x27;
    @memoize
    def lcs_(i, j):
        if i and j:
            xe, ye = xs[i-1], ys[j-1]
            if xe == ye:
                return lcs_(i-1, j-1) + [xe]
            else:
                return max(lcs_(i, j-1), lcs_(i-1, j), key=len)
        else:
            return []
    return lcs_(len(xs), len(ys))

</pre>

</div>

<p>This is a big improvement. If <code>xs</code> and <code>ys</code> have <code>nx</code> and <code>ny</code> elements respectively, then the values of <code>i</code> and <code>j</code> passed to the inner <code>lcs_(i, j)</code> function must fall into the inclusive ranges <code>[0, nx]</code>, <code>[0, ny]</code>, and the cache will grow to contain at most <code>(nx + 1)&times;(ny + 1)</code> elements. If the input sequences are of similar size, it&#8217;s easy to see this version of <code>lcs</code> operates in quadratic time and space.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; ss = lcs(&#x27;ACCGGTCGAGTGCGCGGAAGCCGGCCGAA&#x27;, &#x27;GTCGTTCGGAATGCCGTTGCTCTGTAAA&#x27;)
&gt;&gt;&gt; &#x27;&#x27;.join(ss)
&#x27;GTCGTCGGAAGCCGGCCGAA&#x27;

</pre>

</div>

<h3 id="recursion-limit">Recursion limit</h3>
<p>The memoized version of <code>lcs()</code> remembers previous results, but it&#8217;s still highly recursive, and that can cause problems. Try comparing a couple of longer synthesised strands of DNA.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; from random import choice
&gt;&gt;&gt; def base(): return choice(&#x27;ACGT&#x27;)
&gt;&gt;&gt; dna1 = [base() for _ in range(10000)]
&gt;&gt;&gt; dna2 = [base() for _ in range(10000)]
&gt;&gt;&gt; lcs(dna1, dna2)
....
RuntimeError: maximum recursion depth exceeded

</pre>

</div>

<p>We might try bumping up the recursion limit but this approach is neither clean nor portable. As the <a href="http://docs.python.org/library/sys.html#sys.setrecursionlimit">sys.setrecursionlimit() documentation</a> says:</p>
<blockquote>
<p>The highest possible limit is platform-dependent. A user may need to set the limit higher when she has a program that requires deep recursion and a platform that supports a higher limit. This should be done with care, because a too-high limit can lead to a crash.</p>
</blockquote>
<p>We might also try using a different language or a different <a href="http://www.stackless.com/">Python implementation</a>, but instead let&#8217;s stick with CPython and explore a bottom-up approach.</p>
<h3 id="bottom-up-calculation">Bottom up calculation</h3>
<p>Rather than continue with our top-down recursive algorithm, we can employ another standard dynamic programming technique and transform the algorithm into one which works from the bottom up. Recall that, in the general case, to calculate <code>lcs(xs, ys)</code> we needed to solve three sub-problems, <code>lcs(xb, yb)</code>, <code>lcs(xb, ys)</code>, <code>lcs(xs, yb)</code>, where <code>xb</code> is the result of removing the end element from <code>xs</code>, and similarly for <code>yb</code>.</p>
<div class="typocode">

<pre class="prettyprint">    *xb, xe = xs
    *yb, ye = ys
     if xe == ye:
         return lcs(xb, yb) + [xe]
     else:
         return max(lcs(xs, yb), lcs(xb, ys), key=len)

</pre>

</div>

<p>These subproblems in turn depend on the LCSes of yet shorter prefix pairs of <code>xs</code> and <code>ys</code>. A bottom up approach reverses the direction and calculates the LCSes of all prefix pairs of <code>xs</code> and <code>ys</code>, from shortest to longest. We iterate through these prefix pairs filling a rectangular grid with the information needed to continue and to eventually reconstruct an LCS. Once again, the code is easier to read than an explanation.</p>
<div class="typocode">

<pre class="prettyprint">from collections import defaultdict, namedtuple
from itertools import product

def lcs_grid(xs, ys):
    &#x27;&#x27;&#x27;Create a grid for longest common subsequence calculations.

    Returns a grid where grid[(j, i)] is a pair (n, move) such that
    - n is the length of the LCS of prefixes xs[:i], ys[:j]
    - move is \, ^, &lt;, or e, depending on whether the best move
      to (j, i) was diagonal, downwards, or rightwards, or None.

    Example:
       T  A  R  O  T
    A 0&lt; 1\ 1&lt; 1&lt; 1&lt;
    R 0&lt; 1^ 2\ 2&lt; 2&lt;
    T 1\ 1&lt; 2^ 2&lt; 3\
    &#x27;&#x27;&#x27;
    Cell = namedtuple(&#x27;Cell&#x27;, &#x27;length move&#x27;)
    grid = defaultdict(lambda: Cell(0, &#x27;e&#x27;))
    sqs = product(enumerate(ys), enumerate(xs))
    for (j, y), (i, x) in sqs:
        if x == y:
            cell = Cell(grid[(j-1, i-1)].length + 1, &#x27;\\&#x27;)
        else:
            left = grid[(j, i-1)].length
            over = grid[(j-1, i)].length
            if left &lt; over:
                cell = Cell(over, &#x27;^&#x27;)
            else:
                cell = Cell(left, &#x27;&lt;&#x27;)
        grid[(j, i)] = cell
    return grid

</pre>

</div>

<p>The implementation here makes a couple of <a href="http://www.merriam-webster.com/dictionary/questionable">unusual</a> choices. It models a 2 dimensional grid of values using a dict keyed by <code>(i, j)</code> pairs, rather than a more conventional array representation. Furthermore, it uses a <code>defaultdict</code>, which returns a value even for keys which haven&#8217;t been filled in. I&#8217;ve used this data structure primarily to avoid special case code at the edges of the grid. For example, a grid cell can be accessed at position <code>(j-1, i-1)</code> even if <code>i</code> or <code>j</code> is zero, and that cell automatically takes the desired <code>(0, 'e')</code> value.</p>
<p>I&#8217;ve <a href="http://www.eflorenzano.com/blog/post/gems-python/" title="See item 4 of Eric Florenzano's Gems of Python list">come across the suggestion</a> that <code>defaultdict</code>&#8217;s should be converted into regular <code>dict</code>&#8217;s before being passed back to callers, which <a href="http://norvig.com/spell-correct.html" title="Peter Norvig admits that, much as he likes defaultdicts, they've caught him out">makes a lot of sense</a>, but in this case I&#8217;m choosing to return a <code>defaultdict</code> since its default value property will be useful in subsequent calculations &#8212; to find an actual LCS for example. </p>
<h3 id="extracting-an-lcs-from-the-grid">Extracting an LCS from the grid</h3>
<p>Cells in the LCS grid hold moves and LCS lengths. To extract an actual LCS, we need to retrace the moves. Here&#8217;s an iterative algorithm (a recursive one would also be possible) which does this.</p>
<div class="typocode">

<pre class="prettyprint">def lcs(xs, ys):
    &#x27;&#x27;&#x27;Return a longest common subsequence of xs, ys.&#x27;&#x27;&#x27;
    # Create the LCS grid, then walk back from the bottom right corner
    grid = lcs_grid(xs, ys)
    i, j = len(xs) - 1, len(ys) - 1
    lcs = list()
    for move in iter(lambda: grid[(j, i)].move, &#x27;e&#x27;):
        if move == &#x27;\\&#x27;:
            lcs.append(xs[i])
            i -= 1
            j -= 1
        elif move == &#x27;^&#x27;:
            j -= 1
        elif move == &#x27;&lt;&#x27;:
            i -= 1
    lcs.reverse()
    return lcs

</pre>

</div>

<p>If you haven&#8217;t come across the 2-argument version of <a href="http://docs.python.org/py3k/library/functions.html#iter"><code>iter</code></a>, it&#8217;s a neat way to generate a sequence terminated by a sentinel value. In this case we move back through the grid, finishing when we hit an <code>'e'</code> end move. Note that we only require the <code>move</code> fields of the grid cells to reconstruct an LCS. The length fields were used during calculation of the grid itself.</p>
<h3 id="animation">Animation</h3>
<p>I&#8217;ve reproduced here the animation shown at the start of the article. It demonstrates the LCS grid being calculated, one cell at a time. The numbers in the cells correspond to the lengths of the LCSes ending at various prefix pairs of the inputs and the arrows indicate the moves: as an example, the 2 in the 4th row, 4th column shows that <code>lcs("CHIM", "HUMA")</code> has length 2, and the leftwards arrow shows the best previous LCS was <code>lcs("CHIM", "HUM")</code>.</p>
<p>Once the grid has been filled, the red and orange arrows track back through it to find an LCS. The orange arrows indicate matches &#8212; elements of an LCS &#8212; and the red arrows indicate a route which threads through in the greatest possible number of these.</p>
<div style="font: normal 48px arial, sans-serif; height: 12em;text-align: center;">
<div style="border: 2px solid rgb(0, 0, 0); float: left; line-height: normal; background-color: rgb(255, 255, 255);">
<div style="overflow: hidden; width: 6em; height: 12em;">
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 0em;"><span style="font-size:90%; color: #333;"> </span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 1em; padding-top: 0em;"><span style="font-size:90%; color: #333;">H</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 2em; padding-top: 0em;"><span style="font-size:90%; color: #333;">U</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 3em; padding-top: 0em;"><span style="font-size:90%; color: #333;">M</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 4em; padding-top: 0em;"><span style="font-size:90%; color: #333;">A</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 5em; padding-top: 0em;"><span style="font-size:90%; color: #333;">N</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 1em;"><span style="font-size:90%; color: #333;">C</span></div>
<div class="lcs2" id="lcs20" style="position: absolute; padding-left: 1em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs2" id="lcs21" style="position: absolute; padding-left: 1em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs22" style="position: absolute; padding-left: 2em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs2" id="lcs23" style="position: absolute; padding-left: 2em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs24" style="position: absolute; padding-left: 3em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs2" id="lcs25" style="position: absolute; padding-left: 3em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs26" style="position: absolute; padding-left: 4em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs2" id="lcs27" style="position: absolute; padding-left: 4em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs28" style="position: absolute; padding-left: 5em; padding-top: 1em;"><span style="font-size:25%; color: #666;">0</span></div>
<div class="lcs2" id="lcs29" style="position: absolute; padding-left: 5em; padding-top: 1em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 2em;"><span style="font-size:90%; color: #333;">H</span></div>
<div class="lcs2" id="lcs210" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs211" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs2" id="lcs212" style="position: absolute; padding-left: 2em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs213" style="position: absolute; padding-left: 2em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs214" style="position: absolute; padding-left: 3em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs215" style="position: absolute; padding-left: 3em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs216" style="position: absolute; padding-left: 4em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs217" style="position: absolute; padding-left: 4em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs218" style="position: absolute; padding-left: 5em; padding-top: 2em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs219" style="position: absolute; padding-left: 5em; padding-top: 2em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 3em;"><span style="font-size:90%; color: #333;">I</span></div>
<div class="lcs2" id="lcs220" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs221" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs222" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs223" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs224" style="position: absolute; padding-left: 3em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs225" style="position: absolute; padding-left: 3em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs226" style="position: absolute; padding-left: 4em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs227" style="position: absolute; padding-left: 4em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs228" style="position: absolute; padding-left: 5em; padding-top: 3em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs229" style="position: absolute; padding-left: 5em; padding-top: 3em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 4em;"><span style="font-size:90%; color: #333;">M</span></div>
<div class="lcs2" id="lcs230" style="position: absolute; padding-left: 1em; padding-top: 4em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs231" style="position: absolute; padding-left: 1em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs232" style="position: absolute; padding-left: 2em; padding-top: 4em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs233" style="position: absolute; padding-left: 2em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs234" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs235" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs2" id="lcs236" style="position: absolute; padding-left: 4em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs237" style="position: absolute; padding-left: 4em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs238" style="position: absolute; padding-left: 5em; padding-top: 4em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs239" style="position: absolute; padding-left: 5em; padding-top: 4em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 5em;"><span style="font-size:90%; color: #333;">P</span></div>
<div class="lcs2" id="lcs240" style="position: absolute; padding-left: 1em; padding-top: 5em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs241" style="position: absolute; padding-left: 1em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs242" style="position: absolute; padding-left: 2em; padding-top: 5em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs243" style="position: absolute; padding-left: 2em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs244" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs245" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs246" style="position: absolute; padding-left: 4em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs247" style="position: absolute; padding-left: 4em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs248" style="position: absolute; padding-left: 5em; padding-top: 5em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs249" style="position: absolute; padding-left: 5em; padding-top: 5em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 6em;"><span style="font-size:90%; color: #333;">A</span></div>
<div class="lcs2" id="lcs250" style="position: absolute; padding-left: 1em; padding-top: 6em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs251" style="position: absolute; padding-left: 1em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs252" style="position: absolute; padding-left: 2em; padding-top: 6em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs253" style="position: absolute; padding-left: 2em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs254" style="position: absolute; padding-left: 3em; padding-top: 6em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs255" style="position: absolute; padding-left: 3em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs256" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs257" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="lcs2" id="lcs258" style="position: absolute; padding-left: 5em; padding-top: 6em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs259" style="position: absolute; padding-left: 5em; padding-top: 6em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 7em;"><span style="font-size:90%; color: #333;">N</span></div>
<div class="lcs2" id="lcs260" style="position: absolute; padding-left: 1em; padding-top: 7em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs261" style="position: absolute; padding-left: 1em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs262" style="position: absolute; padding-left: 2em; padding-top: 7em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs263" style="position: absolute; padding-left: 2em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs264" style="position: absolute; padding-left: 3em; padding-top: 7em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs265" style="position: absolute; padding-left: 3em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs266" style="position: absolute; padding-left: 4em; padding-top: 7em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs267" style="position: absolute; padding-left: 4em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs268" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs2" id="lcs269" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:75%; color: #999;">&#x2196;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 8em;"><span style="font-size:90%; color: #333;">Z</span></div>
<div class="lcs2" id="lcs270" style="position: absolute; padding-left: 1em; padding-top: 8em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs271" style="position: absolute; padding-left: 1em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs272" style="position: absolute; padding-left: 2em; padding-top: 8em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs273" style="position: absolute; padding-left: 2em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs274" style="position: absolute; padding-left: 3em; padding-top: 8em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs275" style="position: absolute; padding-left: 3em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs276" style="position: absolute; padding-left: 4em; padding-top: 8em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs277" style="position: absolute; padding-left: 4em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs278" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs2" id="lcs279" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 9em;"><span style="font-size:90%; color: #333;">E</span></div>
<div class="lcs2" id="lcs280" style="position: absolute; padding-left: 1em; padding-top: 9em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs281" style="position: absolute; padding-left: 1em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs282" style="position: absolute; padding-left: 2em; padding-top: 9em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs283" style="position: absolute; padding-left: 2em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs284" style="position: absolute; padding-left: 3em; padding-top: 9em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs285" style="position: absolute; padding-left: 3em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs286" style="position: absolute; padding-left: 4em; padding-top: 9em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs287" style="position: absolute; padding-left: 4em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs288" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs2" id="lcs289" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="row_col_head"  style="position: absolute; padding-left: 0em; padding-top: 10em;"><span style="font-size:90%; color: #333;">E</span></div>
<div class="lcs2" id="lcs290" style="position: absolute; padding-left: 1em; padding-top: 10em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs291" style="position: absolute; padding-left: 1em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs292" style="position: absolute; padding-left: 2em; padding-top: 10em;"><span style="font-size:25%; color: #666;">1</span></div>
<div class="lcs2" id="lcs293" style="position: absolute; padding-left: 2em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2190;</span></div>
<div class="lcs2" id="lcs294" style="position: absolute; padding-left: 3em; padding-top: 10em;"><span style="font-size:25%; color: #666;">2</span></div>
<div class="lcs2" id="lcs295" style="position: absolute; padding-left: 3em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs296" style="position: absolute; padding-left: 4em; padding-top: 10em;"><span style="font-size:25%; color: #666;">3</span></div>
<div class="lcs2" id="lcs297" style="position: absolute; padding-left: 4em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs298" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:25%; color: #666;">4</span></div>
<div class="lcs2" id="lcs299" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #999;">&#x2191;</span></div>
<div class="lcs2" id="lcs2100" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2101" style="position: absolute; padding-left: 5em; padding-top: 10em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2102" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2103" style="position: absolute; padding-left: 5em; padding-top: 9em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2104" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2105" style="position: absolute; padding-left: 5em; padding-top: 8em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2106" style="position: absolute; padding-left: 5em; padding-top: 7em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs2" id="lcs2108" style="position: absolute; padding-left: 4em; padding-top: 6em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs2" id="lcs2110" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2111" style="position: absolute; padding-left: 3em; padding-top: 5em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2112" style="position: absolute; padding-left: 3em; padding-top: 4em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs2" id="lcs2114" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2190;</span></div>
<div class="lcs2" id="lcs2115" style="position: absolute; padding-left: 2em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2190;</span></div>
<div class="lcs2" id="lcs2116" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2117" style="position: absolute; padding-left: 1em; padding-top: 3em;"><span style="font-size:75%; color: #930;">&#x2191;</span></div>
<div class="lcs2" id="lcs2118" style="position: absolute; padding-left: 1em; padding-top: 2em;"><span style="font-size:75%; color: orange;">&#x2196;</span></div>
<div class="lcs2" id="lcs2107" style="position: absolute; padding-left: 5em; padding-top: 11em;"><span style="font-size:75%; color: #930;">N</span></div>
<div class="lcs2" id="lcs2109" style="position: absolute; padding-left: 4em; padding-top: 11em;"><span style="font-size:75%; color: #930;">A</span></div>
<div class="lcs2" id="lcs2113" style="position: absolute; padding-left: 3em; padding-top: 11em;"><span style="font-size:75%; color: #930;">M</span></div>
<div class="lcs2" id="lcs2119" style="position: absolute; padding-left: 1em; padding-top: 11em;"><span style="font-size:75%; color: #930;">H</span></div>
</div>
</div>
</div>

<p><button id="animatelcs2" onclick="animatelcs(2);">Calculate LCS</button></p>
<h3 id="performance">Performance</h3>
<p>If the inputs are of size X, Y, then the grid will have X &times; Y entries each of which gets set in constant time. Recovering an LCS from the grid is a linear operation, so overall, this algorithm operates in O(XY) time and requires O(XY) space. If X and Y are similarly sized, we have a quadratic algorithm.</p>
<p>Practically speaking, we don&#8217;t bang into CPython&#8217;s recursion limit any more, but large inputs still put a strain on the machine. I tried running this new LCS calculation on a couple of long strands of DNA.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; len(dna1), len(dna2)
(10000, 10000)
&gt;&gt;&gt; lcs(dna1, dna2)

</pre>

</div>

<p>To complete this calculation, we&#8217;ll need a grid with 10000 &times; 10000 entries, i.e. 100 million entries. So if each grid entry occupies 10 bytes, we&#8217;re looking at roughly a gigabyte &#8212; a sizable chunk even for today&#8217;s computers. And if each step takes 100 nanoseconds, we&#8217;d be looking at a run-time of 10 seconds, if we don&#8217;t run out of memory first that is.</p>
<p>This back of an envelope calculation turned out to be way off. Running the code snippet above caused my system to thrash. I killed it after 10 minutes, at which point the Python process alone was using over 1GB of memory.</p>
<p>At this point the choice of a <code>dict</code> (a hashtable) very definitely becomes questionable. Actually, our choice of Python becomes questionable. When you have a quadratic algorithm with large inputs, the space and time constant factors both become critical.</p>
<p>We have a number of options:</p>
<ol>
<li>find a leaner algorithm.</li>
<li>find a bigger computer.</li>
<li>treat our Python implementation as a prototype. Code up a high performance version in a language which gives better control over the machine.</li>
</ol>
<p>Then there&#8217;s option 2a, to find a way of distributing the job over a number of computers. There&#8217;s also an option 3a, to tune up our Python implementation.</p>
<h3 id="reducing-the-space-for-lcs-lengths">Reducing the space for LCS lengths</h3>
<p>When you&#8217;ve run out of main memory, any estimate of runtime based on big-O analysis becomes useless. The system either crashes or thrashes, paging in virtual memory. By contrast, if we can reduce the memory required by a program, the time analysis should still hold &#8212; we never have to page in more time.</p>
<p>Once you&#8217;ve watched the dynamic programming solution a few times, you&#8217;ll realise that the LCS lengths (the numbers in the grid) are computed row by row, with each row only depending on the row above. If we just wanted to calculate the LCS length of two sequences, we could write:</p>
<div class="typocode">

<pre class="prettyprint">import itertools

def lcs_length(xs, ys):
    &#x27;&#x27;&#x27;Return the length of the LCS of xs and ys.

    Example:
    &gt;&gt;&gt; lcs_length("HUMAN", "CHIMPANZEE")
    4
    &#x27;&#x27;&#x27;
    ny = len(ys)
    curr = list(itertools.repeat(0, 1 + ny))
    for x in xs:
        prev = list(curr)
        for i, y in enumerate(ys):
            if x == y:
                curr[i+1] = prev[i] + 1
            else:
                curr[i+1] = max(curr[i], prev[i+1])
    return curr[ny]

</pre>

</div>

<p>This LCS length algorithm requires just a linear amount of space for the current and previous rows in the grid (in fact we could halve this space again, since each the LCS calculation for each cell in the grid only depends on the contents of the previous <code>ny + 2</code> cells, but the code is a little more subtle).</p>
<p>To calculate an actual LCS, though, we would still need a full grid of moves for the final backtracking stage of the algorithm. Clearly we can compact this grid, since each cell contains one of four moves (&uarr;, &larr;, &#x2196; e) and can therefore be be represented in just 2 bits. Despite this, the grid would still occupy a quadratic amount of space. </p>
<p>Fortunately, an ingenious hybrid algorithm by <a href="http://www.ics.uci.edu/~dan/">Professor Dan Hirschberg</a> requires just a linear amount of space.</p>
<h3 id="hirschbergs-linear-space-algorithm">Hirschberg&#8217;s Linear Space Algorithm</h3>
<p>In a 1975 paper titled <a href="http://portal.acm.org/citation.cfm?id=360861">&#8220;A linear space algorithm for computing maximal common subsequences&#8221;</a>, D.S. Hirschberg describes a technique for computing an LCS using space proportional to the length of the inputs. The algorithm combines the dynamic programming technique discussed in this article with a classic divide and conquer approach.</p>
<p>If you search for this paper, you&#8217;ll soon find a copy of the original online. It&#8217;s just three pages long and very accessible. The key idea is to split one of the input sequences in two.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; mid = len(xs)//2
&gt;&gt;&gt; xb, xe = xs[:mid], xs[mid:]

</pre>

</div>

<p>We then calculate LCS lengths for the pair <code>(xb, ys)</code> and the pair <code>(reversed(xe), reversed(ys))</code>. If we find a y-position, <code>k</code>, which maximises the sums of these forward and backwards LCS lengths, then we have a suitable position to split <code>ys</code>. Thus our answer reduces to finding the answer for two smaller subsequences.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; yb, ye = ys[:k], ys[k:]
&gt;&gt;&gt; lcs_xs_ys = lcs(xb, yb) + lcs(xe, ye)

</pre>

</div>

<p><img src="/images/python-pony.png" width="550" height="265" alt="Python Pony"/></p>
<p>The picture shows the first stage of this algorithm for the input pair (PYTHON, PONY).</p>
<ol>
<li>split PYTHON evenly into PYT, HON</li>
<li>working forwards from the top left, use <code>lcs_length('PYT', 'PONY)'</code> to fill the T row of the grid.</li>
<li>working backwards from the bottom right, use <code>lcs_length('NOH', 'YNOP)'</code> to fill the H row of the grid</li>
<li>find the column which maximises the sum of lcs lengths on the T and H rows, adding each T-item to the H-item below and one to the right. In this case, the sums are + 2, 1 + 2, 1 + 1, 1 + 0, 2 +, the maximum value of 3 is at 1 + 2.</li>
<li>split PONY at this column.</li>
<li>thus <code>lcs('PYTHON', 'PONY')</code> is equal to <code>lcs('PYT', 'P') + lcs('HON', 'ONY')</code></li>
</ol>
<p><a href="http://portal.acm.org/citation.cfm?id=360861">Hirschberg</a> proves the correctness of this algorithm and goes on to prove that it has quadratic performance but requires just a linear amount of space.</p>
<p>The code looks something like the following.</p>
<div class="typocode">

<pre class="prettyprint">import itertools

def lcs_lens(xs, ys):
    curr = list(itertools.repeat(0, 1 + len(ys)))
    for x in xs:
        prev = list(curr)
        for i, y in enumerate(ys):
            if x == y:
                curr[i + 1] = prev[i] + 1
            else:
                curr[i + 1] = max(curr[i], prev[i + 1])
    return curr

def lcs(xs, ys):
    nx, ny = len(xs), len(ys)
    if nx == 0:
        return []
    elif nx == 1:
        return [xs[0]] if xs[0] in ys else []
    else:
        i = nx // 2
        xb, xe = xs[:i], xs[i:]
        ll_b = lcs_lens(xb, ys)
        ll_e = lcs_lens(xe[::-1], ys[::-1])
        _, k = max((ll_b[j] + ll_e[ny - j], j)
                    for j in range(ny + 1))
        yb, ye = ys[:k], ys[k:]
        return lcs(xb, yb) + lcs(xe, ye)

</pre>

</div>

<p>I say &#8220;something like&#8221; because this code is unpolished and inefficient. Although the space requirement is proportional to the input sizes, it continually creates new list slices in order to get the job done. It may well be capable of handling large inputs in a using a limited amount of memory, but it takes far too long doing so. </p>
<p>On a more positive note, at least this implementation passes some simple tests.</p>
<div class="typocode">

<pre class="prettyprint">def test():
    concat = &#x27;&#x27;.join
    assert concat(lcs(&#x27;&#x27;, &#x27;&#x27;)) == &#x27;&#x27;
    assert concat(lcs(&#x27;a&#x27;, &#x27;&#x27;)) == &#x27;&#x27;
    assert concat(lcs(&#x27;&#x27;, &#x27;b&#x27;)) == &#x27;&#x27;
    assert concat(lcs(&#x27;abc&#x27;, &#x27;abc&#x27;)) == &#x27;abc&#x27;
    assert concat(lcs(&#x27;abcd&#x27;, &#x27;obce&#x27;)) == &#x27;bc&#x27;
    assert concat(lcs(&#x27;abc&#x27;, &#x27;ab&#x27;)) == &#x27;ab&#x27;
    assert concat(lcs(&#x27;abc&#x27;, &#x27;bc&#x27;)) == &#x27;bc&#x27;
    assert concat(lcs(&#x27;abcde&#x27;, &#x27;zbodf&#x27;)) == &#x27;bd&#x27;
    assert concat(lcs(&#x27;aa&#x27;,&#x27;aaaa&#x27;)) == &#x27;aa&#x27;
    assert concat(lcs(&#x27;GTCGTTCGGAATGCCGTTGCTCTGTAAA&#x27;,
                      &#x27;ACCGGTCGAGTGCGCGGAAGCCGGCCGAA&#x27;)
                  ) == &#x27;GTCGTCGGAAGCCGGCCGAA&#x27;

</pre>

</div>

<p>This is an achievment in itself: if you examine the implementation, you&#8217;ll see plenty of space for off-by-one errors to creep in. This is about as far as we&#8217;ll get with Python, but a working implementation is a great resource when we switch to a more efficient language. </p>
<h3 id="applied-to-the-new-york-marathon-results">Applied to the New York Marathon Results</h3>
<p>Remember our original problem? At last we&#8217;re ready to take it on.</p>
<p>In 2008, 38096 runners completed the world&#8217;s largest running event, the <a href="http://www.nycmarathon.org">New York City marathon</a>. A <a href="http://www.nycmarathon.org/Results.htm">full set of results</a> is available online, one page at a time, but it&#8217;s not too hard to scrape them into a single file for convenient offline processing.</p>
<p>Runners&#8217; ages are supplied to the nearest year. To find a longest sublist of the results comprising runners who aren&#8217;t getting any older, we sort the results in reverse age order, then run our LCS algorithm against the original results list. Note that we use age alone for comparison: so, for example, GAUTI HOSKULDSSON (a 47 year old male who finished in 295th place with a time of 2:47:00) equals
PHILIPPE LETESSIER (also 47, male, 298th in 2:47:14).</p>
<p>To find a longest sublist of runners who are getting strictly younger, we must uniquify the youth-ordered results before applying the LCS algorithm.</p>
<p>Here&#8217;s a sketch of how we&#8217;d do it in Python. I&#8217;ve omitted details of the <code>AgingRunner</code> class; all that matters is that it has an <code>age</code> field, which is used for both ordering and equality comparisons.</p>
<div class="typocode">

<pre class="prettyprint">class AgingRunner:
    &#x27;&#x27;&#x27;Class to represent runners keyed by age.
    &#x27;&#x27;&#x27;
    ....
    def __lt__(self, other):
        &#x27;&#x27;&#x27;Return True if this runner is *older* than the other.&#x27;&#x27;&#x27;
        return self.age &gt; other.age

    def __eq__(self, other):
        &#x27;&#x27;&#x27;Return True if this runner is the same age as the other.&#x27;&#x27;&#x27;
        return self.age == other.age

def uniq(xs):
    import itertools, operator
    return map(operator.itemgetter(0), itertools.groupby(xs))

runners = read_in_results()
srunners = list(sorted(runners))
not_getting_older = lcs(runners, srunners)

urunners = list(uniq(srunners))
getting_younger = lcs(runners, urunners)

</pre>

</div>

<p>Sadly this really is just a sketch. Even though our space efficient Python LCS implementation runs comfortably in main memory on a modern computer, it just isn&#8217;t quick enough. Hirschberg&#8217;s paper (published way back in 1975) says:</p>
<blockquote>
<p>We present an algorithm which will solve this problem in quadratic time and in linear space. For example, assuming coefficients of 2 microseconds and 10 bytes [&#8230;] for strings of length 10,000 we would require a little over 3 minutes and 100K bytes.</p>
</blockquote>
<p>If we suppose a modern computer runs 1000 times faster, but that our naive Python implementation is 100 times slower than native code, for input sizes of 38096 we&#8217;d expect a run time of around 6 minutes. Sadly this estimate turns out to be optimistic. It took me almost an hour and a half to run this program on a computer with a 2GHZ Intel Core duo processor.</p>
<p>C++ excels at high performance sequence crunching. Rather than try and tune up my Python program I used it as a reference implementation for a C++ one. The C++ version processed the full set of results in a respectable 18 seconds, giving a coefficient of around 12 nanoseconds &#8212; much closer to the figure I&#8217;d expect from a machine with a 2.33 GHz processor.</p>
<p>I found the longest sequence of runners who weren&#8217;t getting any older had length 1724. I also found a sequence of 60 runners who were getting younger, covering every age between 80 and 18, with the exceptions of 79, 77, 76.</p>
<pre>
24319, CHABANE KETFI, 80, M, 4:37:04
31293, GRACCO VARAGNOLO, 78, M, 5:07:42
32576, JOSEPH PASCARELLA, 75, M, 5:17:32
32931, THEODORE ROGERS, 74, M, 5:20:42
33351, GOODMAN ESPY, 73, M, 5:24:17
33982, MANUEL GUARIN, 72, M, 5:30:06
34646, GIORGIO LUDWIG, 71, M, 5:37:43
35014, PIETRO ROSSI, 70, M, 5:42:00
35052, MARCELLA HSIUNG, 69, F, 5:42:41
35717, LUIS BECERRA, 68, M, 5:52:55
35841, SHIZUKO HAZEYAMA, 67, F, 5:55:25
36237, MONIKA LUDWIG, 66, F, 6:03:30
36248, PETER GELTNER, 65, M, 6:03:49
36427, SERGE GIROUD, 64, M, 6:08:44
36462, HIDEMI HARA, 63, F, 6:09:58
36483, KIMIE NISHIOKA, 62, F, 6:10:24
36486, ERNEST YONG, 61, M, 6:10:33
36530, FRANCO ZUCCHINI, 60, M, 6:11:39
36629, FRANCESCO CERETTI, 59, M, 6:14:18
36646, MASAHARU AKAZAWA, 58, M, 6:14:39
36680, LOUISE SEELEY, 57, F, 6:15:31
36706, BETH EIDEMILLER, 56, F, 6:16:22
36720, DANIELA CARACENI, 55, F, 6:16:51
36796, GUSTAVO CASTILLO SOSA, 54, M, 6:18:53
36836, GAIL COOPER, 53, F, 6:19:49
36850, WAYNE DOLNICK, 52, M, 6:19:56
36869, ANNALEA BIANCHI, 51, F, 6:20:18
36914, PATRICIA DRISCOLL, 50, F, 6:21:59
....
</pre>

<p>Incidentally, CHABANE KETFI was comfortably the fastest of 17 octogenarian finishers, one of whom, PETER HARANGOZO, 87, was also the oldest finisher.</p>
<h3 id="hirschbergs-linear-space-algorithm-in-c">Hirschberg&#8217;s linear space algorithm in C++</h3>
<p>Here&#8217;s a C++ implementation based on the reference Python implementation. It should work on any container type which supports forward and reverse iteration. It&#8217;s similar to the Python implementation, but note:</p>
<ol>
<li>rather than copy slices of the original sequences, it passes around iterators and reverse iterators into these sequences</li>
<li>rather than recursively accumulating sums of sub-LCS results, it ticks off items in a members array, <code>xs_in_lcs</code></li>
</ol>
<div class="typocode">

<pre class="prettyprint">/*
  C++ implementation of 
  "A linear space algorithm for computing maximal common subsequences"
  D. S. Hirschberg
  http://portal.acm.org/citation.cfm?id=360861

  See also: http://wordaligned.org/articles/longest-common-subsquence.html
*/
#include &lt;algorithm&gt;
#include &lt;iterator&gt;
#include &lt;vector&gt;

typedef std::vector&lt;int&gt; lengths;

/*
  The "members" type is used as a sparse set for LCS calculations.
  Given a sequence, xs, and members, m, then
  if m[i] is true, xs[i] is in the LCS.
*/
typedef std::vector&lt;bool&gt; members;

/*
  Fill the LCS sequence from the members of a sequence, xs
  x - an iterator into the sequence xs
  xs_in_lcs - members of xs
  lcs - an output results iterator
*/
template &lt;typename it, typename ot&gt;
void set_lcs(it x, members const &amp; xs_in_lcs, ot lcs)
{
    for (members::const_iterator xs_in = xs_in_lcs.begin();
         xs_in != xs_in_lcs.end(); ++xs_in, ++x)
    {
        if (*xs_in)
        {
            *lcs++ = *x;
        }
    }
}

/*
  Calculate LCS row lengths given iterator ranges into two sequences.
  On completion, `lens` holds LCS lengths in the final row.
*/
template &lt;typename it&gt;
void lcs_lens(it xlo, it xhi, it ylo, it yhi, lengths &amp; lens)
{
    // Two rows of workspace.
    // Careful! We need the 1 for the leftmost column.
    lengths curr(1 + distance(ylo, yhi), 0);
    lengths prev(curr);

    for (it x = xlo; x != xhi; ++x)
    {
        swap(prev, curr);
        int i = 0;
        for (it y = ylo; y != yhi; ++y, ++i)
        {
            curr[i + 1] = *x == *y
                ? prev[i] + 1
                : std::max(curr[i], prev[i + 1]);
        }
    }
    swap(lens, curr);
}

/*
  Recursive LCS calculation.
  See Hirschberg for the theory!
  This is a divide and conquer algorithm.
  In the recursive case, we split the xrange in two.
  Then, by calculating lengths of LCSes from the start and end
  corners of the [xlo, xhi] x [ylo, yhi] grid, we determine where
  the yrange should be split.

  xo is the origin (element 0) of the xs sequence
  xlo, xhi is the range of xs being processed
  ylo, yhi is the range of ys being processed
  Parameter xs_in_lcs holds the members of xs in the LCS.
*/
template &lt;typename it&gt;
void
calculate_lcs(it xo, it xlo, it xhi, it ylo, it yhi, members &amp; xs_in_lcs)
{
    unsigned const nx = distance(xlo, xhi);

    if (nx == 0)
    {
        // empty range. all done
    }
    else if (nx == 1)
    {
        // single item in x range.
        // If it&#x27;s in the yrange, mark its position in the LCS
        xs_in_lcs[distance(xo, xlo)] = find(ylo, yhi, *xlo) != yhi;
    }
    else
    {
        // split the xrange
        it xmid = xlo + nx / 2;

        // Find LCS lengths at xmid, working from both ends of the range
        lengths ll_b, ll_e;
        std::reverse_iterator&lt;it&gt; hix(xhi), midx(xmid), hiy(yhi), loy(ylo);

        lcs_lens(xlo, xmid, ylo, yhi, ll_b);
        lcs_lens(hix, midx, hiy, loy, ll_e);

        // Find the optimal place to split the y range
        lengths::const_reverse_iterator e = ll_e.rbegin();
        int lmax = -1;
        it y = ylo, ymid = ylo;

        for (lengths::const_iterator b = ll_b.begin();
             b != ll_b.end(); ++b, ++e)
        {
            if (*b + *e &gt; lmax)
            {
                lmax = *b + *e;
                ymid = y;
            }
            // Care needed here!
            // ll_b and ll_e contain one more value than the range [ylo, yhi) 
            // As b and e range over dereferenceable values of ll_b and ll_e,
            // y ranges over iterator positions [ylo, yhi] _including_ yhi.
            // That&#x27;s fine, y is used to split [ylo, yhi), we do not
            // dereference it. However, y cannot go beyond ++yhi.
            if (y != yhi)
            {
                ++y;
            }
        }
        // Split the range and recurse
        calculate_lcs(xo, xlo, xmid, ylo, ymid, xs_in_lcs);
        calculate_lcs(xo, xmid, xhi, ymid, yhi, xs_in_lcs);
    }
}

// Calculate an LCS of (xs, ys), returning the result in an_lcs. 
template &lt;typename seq&gt;
void lcs(seq const &amp; xs, seq const &amp; ys, seq &amp; an_lcs)
{
    members xs_in_lcs(xs.size(), false);
    calculate_lcs(xs.begin(), xs.begin(), xs.end(),
                  ys.begin(), ys.end(), xs_in_lcs);
    set_lcs(xs.begin(), xs_in_lcs, back_inserter(an_lcs));
}

</pre>

</div>

<h3 id="applications-edit-distance">Applications: edit distance</h3>
<p>You may be thinking this is all of academic interest only. Who really cares about the longest common subsequence problem? Well, anyone who uses version control does. The longest common subsequence problem is closely related to the more general edit distance problem, which is all about finding the smallest number of point mutations needed to change one sequence into another. For example, if we allow just two such mutations:</p>
<ol>
<li>insert an element</li>
<li>delete an element</li>
</ol>
<p>then the number of mutations needed to convert a <code>xs</code> into <code>ys</code> is the sum of the lengths of <code>xs</code> and <code>ys</code> minus twice the length of their LCS. Or in Python:</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; edit_distance(xs, ys) == len(xs) + len(ys) - 2 * lcs(xs, ys)
True

</pre>

</div>

<p>For example, we can change &#8220;HUMAN&#8221; into &#8220;CHIMPANZEE&#8221; using the LCS, &#8220;HMAN&#8221; as follows: delete the U from HUMAN, to give HMAN, then insert C, I, P, Z, E, E giving CHIMPANZEE. </p>
<p>In general:</p>
<ol>
<li>find an LCS of <code>xs</code> and <code>ys</code>. Let&#8217;s say this LCS has length <code>L</code>. </li>
<li>strike out all elements of <code>xs</code> which are not in this LCS, a total of <code>len(xs) - L</code> moves</li>
<li>now insert all the elements of <code>ys</code> which are missing from the LCS, another <code>len(ys) - L</code> moves.</li>
</ol>
<p>Thus the edit distance is at most <code>len(xs) + len(ys) - 2 * L</code>. It remains to show there can be no shorter edit distance. The same argument works well enough in reverse. Given a minimal edit sequence, note we do not delete anything we already inserted, otherwise we could remove this insert-delete pair to form a shorter edit sequence. Thus we can sort this edit sequence so the deletions preceed the insertions to form another minimal edit sequence. . Now process all the deletions, leaving a subsequence of <code>xs</code>. Since we can now get from this subsequence to <code>ys</code> using insertions alone, it must also be a subsequence of <code>ys</code>.</p>
<p>More general variants of the edit distance problem allow substitution and transposition mutations, and may assign weights to each type of mutation. In all cases, similar algorithms can be used to the dynamic programming algorithm shown in this example, but improvements can be made if we know the inputs are similar &#8212; as in the case of genetic mutations, for example.</p>
<h3 id="applications-genetic-mutations">Applications: genetic mutations</h3>
<p><a href="http://www.csse.monash.edu.au/~lloyd/tildeAlgDS/Dynamic/HUMHBB/"><img src="/images/acgt.png" alt="{A,C,T,G}"/></a></p>
<p>I&#8217;ve already mentioned Cormen, Leiserson, Rivest and Stein&#8217;s classic reference, &#8220;Introduction to Algorithms&#8221; (CLRS for short). This book introduces the longest common subsequence problem as follows:</p>
<blockquote>
<p>In biological applications, we often want to compare the DNA of two (or more) different organisms. [&#8230;] For example, the DNA of one organism may be S<sub>1</sub> = <a href="http://www.google.com/search?q=ACCGGTCGAGTGCGCGGAAGCCGGCCGAA" title="I hoped for a googlewhack -">ACCGGTCGAGTGCGCGGAAGCCGGCCGAA</a> while the DNA of another organism may be S<sub>2</sub> = <a href="http://www.google.com/search?q=GTCGTTCGGAATGCCGTTGCTCTGTAAA" title="- but others have borrowed the CLRS example -">GTCGTTCGGAATGCCGTTGCTCTGTAAA</a>. One goal of comparing two strands of DNA is to determine how &#8220;similar&#8221; the two strands are, as some measure of how cosely related the two organisms are. </p>
</blockquote>
<p>And, CLRS goes on to say, the longest common subsequence of S<sub>1</sub> and S<sub>2</sub> is one such measure of similarity. In this case, the longest common subsequence, S<sub>3</sub> would be <a href="http://www.google.com/search?q=GTCGTCGGAAGCCGGCCGAA" title="- which has become the canonical longest common subsequence!">GTCGTCGGAAGCCGGCCGAA</a> </p>
<p>Genetic comparision is an important application of sequence matching. As already mentioned, it&#8217;s also a special case, which means we can can do rather better than the general purpose algorithm presented above. For one thing, the alphabet of bases, Adenine, Cytosine, Guanine, Thymine has just 4 elements. More importantly, the evolution of life on this planet is based around DNA <strong>replication</strong>. Over 400 million years, glitches in DNA replication lead to genetic mutations, leading in turn to a variety of life forms. But, for example, human and chimpanzee DNA are <a href="http://news.nationalgeographic.com/news/2005/08/0831_050831_chimp_genes.html">at least 96% similar</a>. If we&#8217;re comparing two human genomes, a recent article entitled <a href="http://bioinformatics.oxfordjournals.org/cgi/content/full/25/2/274#SEC2">Human genomes as email attachments</a> points out:</p>
<blockquote>
<p>The key insight is to consider that any two human genomes are more than 99% identical.</p>
</blockquote>
<p>So the random A, C, G, T sequences I used earlier this article were highly non-representative.</p>
<p>When the edit distance, D, between two sequences is small compared to the lengths of these sequences, more specialised algorithms can calculate this distance in O(ND) complexity and linear space. I&#8217;m not going to discuss these algorithms here, but they&#8217;re elegant and accessible. See a 1986 paper <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.4.6927">&#8220;An O(ND) difference algorithm and its variations&#8221;</a> by Eugene W. Myers for more details.</p>
<p><a href="/pages/lcs-dna"><img src="/images/lcs-dna.gif" alt="lcs(ACCGGTCGAGTGCGCGGAAGCCGGCCGAA, GTCGTTCGGAATGCCGTTGCTCTGTAAA)"/></a></p>
<h3 id="applications-version-control">Applications: version control</h3>
<p>Similar considerations apply to a version controlled file. Generally the distance between two versions of a file is small compared to the size of the file itself; the Unix <code>diff</code> and <code>patch</code> tools exploit this, as do the difference engines embedded in version control systems. Here&#8217;s a comment in <a href="http://svn.collab.net/viewvc/svn/trunk/subversion/libsvn_diff/">Subversion&#8217;s differencing engine</a>.</p>
<blockquote><pre>
/*
 * Calculate the Longest Common Subsequence between two datasources.
 * This function is what makes the diff code tick.
 *
 * The LCS algorithm implemented here is described by Sun Wu,
 * Udi Manber and Gene Meyers in "An O(NP) Sequence Comparison Algorithm"
 *
 */ 
</pre></blockquote>

<p>(I&#8217;m fairly sure they mean &#8220;Myers&#8221;, and <code>P</code> is the the number of deletions in an edit sequence. You can easily find a copy of the referenced paper, which walks through a beautiful greedy algorithm and beats Myers&#8217; earlier <code>O(ND)</code> algorithm by a factor of two, or better.)</p>
<h3 id="conclusions">Conclusions</h3>
<p>The longest common subsequence problem and the more general edit distance problem have been &#8212; <a href="http://www.ics.uci.edu/~dan/">and continue to be</a> &#8212; extensively studied. A classic dynamic programming solution to this problem is based on an elegant recursive algorithm, though by the time we&#8217;ve created an efficient implementation some of that elegance has been hidden. And efficiency, here, is an important consideration, since the general purpose algorithm presented in this article is of quadratic complexity.</p>
<p>A Python implementation is quick to develop and flexible enough to experiment with. With some effort we can control its space requirements. But a C++ implementation comfortably outperforms Python by an order of magnitude or more, and for large inputs, compiled native code is required. Does this make Python suitable only for toy projects, short scripts and blog posts? <a href="http://www.python.org/about/quotes/">No</a>, but I&#8217;ll save a more complete answer for another time!</p>
<p>In the case where the input sequences are similar, more efficient <a href="http://en.wikipedia.org/wiki/Greedy_algorithm">greedy algorithms</a> exist. These algorithms form the backbone of the venerable Unix diff tool and of modern version control systems.</p>
<h3 id="next-time">Next time</h3>
<p>Let&#8217;s not forget that we really wanted to solve the longest ordered subsequence problem, not the longest common subsequence problem. In the next episode we&#8217;ll explore a beautiful &#8212; and efficient &#8212; longest ordered subsequence algorithm.</p>
<hr />
<h3 id="thanks">Thanks</h3>
<p>My thanks to Soeren Meyer-Eppler for <a href="#comment-75731663">reporting</a> a tricky bug in the C++ LCS implementation. I should have run more tests using -D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC!</p>
<h3 id="python-3-notes">Python 3 Notes</h3>
<p><strong>Note 1.</strong> The results served up from the official New York Marathon site were encoded using <code>charset=iso-8859-1</code>, and I maintained this encoding for my local copy of these results. In Python 3.0, you can explicitly specify an encoding when <a href="http://docs.python.org/py3k/library/functions.html#open">opening a file</a> in text mode.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; fp = open(&#x27;nyc-results.txt&#x27;, encoding=&#x27;iso-8859-1&#x27;)

</pre>

</div>

<p>From the <a href="http://docs.python.org/py3k/library/functions.html#open">documentation</a>:</p>
<blockquote>
<p><em>encoding</em> is the name of the encoding used to decode or encode the file. This should only be used in text mode. The default encoding is platform dependent, but any encoding supported by Python can be passed. See the <a href="http://docs.python.org/py3k/library/codecs.html#module-codecs">codecs</a> module for the list of supported encodings.</p>
</blockquote>
<p>Somewhere along the line a case conversion algorithm must have failed to get the details right. Here are the finishers with more than one non-ASCII character in their names:</p>
<ul>
<li>3275, TORBJ&ouml;RN SKJ&ouml;LDERFORS, 49, M, 3:22:46</li>
<li>4141, G&ouml;RAN H&auml;RSTEDT, 43, M, 3:27:40</li>
<li>4510, J&uuml;RG M&uuml;LLER, 49, M, 3:29:15</li>
<li>6763, &Oslash;YVIND SCHAGE F&oslash;RDE, 35, M, 3:39:16</li>
<li>8832, &Oslash;YSTEIN &Oslash;KLAND, 55, M, 3:47:19</li>
<li>11402, THOMAS KR&auml;HENB&uuml;HL, 31, M, 3:55:22</li>
<li>13582, L&aacute;SZL&oacute; SZAB&oacute;, 50, M, 4:00:55</li>
<li>18186, &Oslash;YVIND B&oslash;RRESEN, 52, M, 4:16:31</li>
<li>23727, FERNANDO SEBASTI&aacute;N L&oacute;PEZ, 34, M, 4:34:50</li>
<li>28315, KOLBR&uacute;N BRYNJA EGILSD&oacute;TTIR, 46, F, 4:52:29</li>
<li>33457, JAN KRISTIAN R&oslash;DST&oslash;L, 37, M, 5:25:12</li>
</ul>
<p><strong>Note 2.</strong> I&#8217;ve already pointed out Python 3.0&#8217;s <a href="http://www.python.org/dev/peps/pep-3132/">extended unpacking syntax</a>. Here&#8217;s another example:</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; car, *cdr = items

</pre>

</div>

<p><strong>Note 3.</strong> You may well have spotted the truncating integer division used in the divide and conquer algorithm:</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; i = nx // 2

</pre>

</div>

<p>Without the double slash, <code>i</code> would become a floating point number, and using it as slice index would raise a <code>TypeError</code>. The <code>//</code> floor division operator is available in Python 2.6 and earlier and I recommend using it for all C-style truncating integer divisions. Here&#8217;s <a href="http://python-history.blogspot.com/2009/03/problem-with-integer-division.html">the full history</a>. </p>
<p><strong>Note 4.</strong> To order and compare runners by age for the preliminary <code>sort()</code> and the subsequent <code>lcs()</code> calls, I added <code>__lt__</code> and <code>__eq__</code> methods to the <code>AgingRunner</code> class. In Python 2.6 the <code>__cmp__</code> method could have been used instead of these rich comparison methods, but this is <a href="http://docs.python.org/3.0/whatsnew/3.0.html#ordering-comparisons">no longer supported in 3.0</a>. A <a href="http://code.activestate.com/recipes/576685/">recipe</a> by Raymond Hettinger demonstrates a class decorator which automatically creates all the rich comparisons methods from any subset of them (e.g. <code>__gt__</code>, <code>__ge__</code>, <code>__le__</code> can all be sensibly derived from <code>__lt__</code>).</p>
<hr />
<p><a id="fn1" href="#fn1link"><a href="https://blog.codeship.com/building-minimal-docker-containers-for-go-applications/">1</a></a>. Note that the original version of <code>lcs()</code> works for any pair of sequences with equality comparable elements. The newly adapted version will only work for strings and byte arrays. This isn&#8217;t really a problem, since we&#8217;re just using it to run a quick code experiment.</p>
</div>

<div class="comments"><hr/><div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/wordaligned/embed.js"></script></div>
      
<div id="comments"><script type="text/javascript">
//<![CDATA[
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
        if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
        }
    }
    document.write('<script type="text/javascript" src="http://disqus.com/forums/wordaligned/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script></div>

    </div>
    <div id="sidebar">
      
<div class="sidebar-node">
<h3>Tagged</h3>
<ul id="categories"><li><a href="/tag/algorithms" rel="tag">Algorithms</a></li>
<li><a href="/tag/python" rel="tag">Python</a></li>
<li><a href="/tag/c++" rel="tag">C++</a></li>
<li><a href="/tag/lcs" rel="tag">Lcs</a></li>
<li><a href="/tag/clrs" rel="tag">CLRS</a></li>
<li><a href="/tag/animation" rel="tag">Animation</a></li></ul>

</div>

<div class="sidebar-node">
<h3>Chain</h3>
<ul>
<li><a accesskey="n" href="/articles/good-maths-bad-computers" title="Next article">&laquo; Good maths, bad computers</a></li>
<li><a accesskey="p" href="/articles/ordered-sublists-a-brute-force-approach" title="Previous article">&raquo; Ordered sublists. A brute force approach</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Feeds</h3>

<ul>
<li><a href="http://feeds.wordaligned.org/wordaligned"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Articles</a></li>
<li><a href="http://feeds.wordaligned.org/wordaligned/comments"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Comments</a></li>
</ul>


</div>

    </div>
  </div>
  <div id="footer">
<hr />
<p><a href="http://tag.wordaligned.org">Thomas Guest</a></p>
</div>

</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3373724-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>
</body>

</html>
