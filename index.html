<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="/images/favicon.png" type="image/png"/>
<link href="/styles/application.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/scripts/prettify.js"></script>
<script type="text/javascript" src="/scripts/lang-lisp.js"></script>
<script type="text/javascript" src="http://www.haloscan.com/load/wordaligned"></script>

<title>Word Aligned</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Guest" />
<meta name="description" content="A collection of articles on software development written by Thomas Guest." />
<meta name="keywords" content="CLRS, Regex, Missiles, Cycling, apple, Agile, Self, Editors, Emacs, Primes, Torvalds, talks, ImageMagick, Hoare, IDE, Decorators, Tests, Shell, PIL, Lcs, Turing, Ruby on Rails, Puzzles, Europython, iphone, Characters, Pictures, Fractals, Crabs, tests, Github, DocBook, Dynamic Languages, lighttpd, Bugs, CVS, Reviews, Steganography, Oulipo, Perec, Content, Markdown, Two Wheels, Conferences, Syntax, Unix, Arc, Go, Web-applications, Chess, Web Applications, Java, Esr, Recursion, Charts, Perl, Subversion, Recommended, Teamwork, Build, ACCU, Knuth, Android, Erlang, Boost, php, OCR, Python, cvs2svn, self, Scrum, SICP, Windows, Books, Awk, Graphics, Disqus, Ruby, openid, C, Zlib, Trac, Lisp, Documentation, C++, Etc, Streams, Bristol, Tesseract, Drawing, Accidents, Google, Apple, Functional Programming, Pi, Haskell, Design, Virtualization, Unicode, Spolsky, Algorithms, Curl, Scheme" />
<link rel="alternate" type="application/rss+xml" title="Feed" href="http://feeds.wordaligned.org/wordaligned" />
</head>

<body onload="prettyPrint()">
<div id="container">
  <div id="header">
<h1><span><a accesskey="h" href="/">Word Aligned</a></span></h1>
<h2>tales from the code face</h2>
<a class="button" href="http://feeds.wordaligned.org/wordaligned" title="Subscribe to Word Aligned"><img style="float: right;" src="/images/feed.png" alt="Feed Logo" height="28" width="28"/></a>
</div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="lazy-sequences-working-hard">
<h2 class="title"><a href="/articles/lazy-sequences-working-hard">Lazy sequences working hard</a></h2>
<p class="meta"><abbr class="published" title="2017-05-16">2017-05-16</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/streams" rel="tag">Streams</a> &bull; <a href="/articles/lazy-sequences-working-hard#disqus_thread">Comments</a></p>
<p>I gave a talk <a href="http://www.pydiff.wales/events/2017-05-16.html">@PyDiff</a> this evening in the computer science department at Cardiff University.
</p>
<blockquote><p><h2>Lazy Sequences working hard</h2>
</p>
<p>Python has no problem handling large and even infinite streams of data. Just write lazy programs &#8212; code which defers data access until the last minute. This talk examines Python&#8217;s language and library support for such delaying tactics. There will be live coding, and we&#8217;ll draw parallels with similar features in other languages, in particular the Unix shell.
</p>
</blockquote><p>Being unsure where to pitch it, I started off easy and kept going until I&#8217;d lost everybody &#8212; including myself.
</p>
<p>The room was well set up with a good quality projector and whiteboard, along with a desk to sit down when I wanted to write and run code and plenty of space to move around in otherwise. I did feel a bit like a jack-in-the-box by the end.
</p>
<p><a data-flickr-embed="true"  href="https://www.flickr.com/photos/thomasguest/34663534326/in/dateposted-friend/" title="Me @PyDiff"><img src="https://c1.staticflickr.com/5/4164/34663534326_4bf8851eeb.jpg" width="500" height="375" alt="Me @PyDiff"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script>
</p>
<p>I&#8217;d based the talk on a Jupyter notebook which I replayed with the ingenious <a href="https://github.com/damianavila/RISE">RISE reveal.js extension</a> written by Damian Avila. This worked well, since I got the pretty graphics along with the interactive coding. A static version of the slides is <a href="http://nbviewer.jupyter.org/url/wordaligned.org/docs/lazy-sequences.ipynb">available here</a>.
</p>
<p>Thanks to everyone who came. Sorry I had to rush off after. If anyone would <a href="http://swanseasdc.co.uk/">like to talk at Swansea</a>, please let me know: you&#8217;d be most welcome.
</p>

</div>


<div class="atomentry" id="slicing-a-list-evenly-with-python">
<h2 class="title"><a href="/articles/slicing-a-list-evenly-with-python">Slicing a list evenly with Python</a></h2>
<p class="meta"><abbr class="published" title="2017-05-14">2017-05-14</abbr> &bull; <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/slicing-a-list-evenly-with-python#disqus_thread">Comments</a></p>
<img src="/images/sliced-python.jpg" alt="Sliced Python"/>

<p>Here&#8217;s a problem I came up against recently.
</p>
<p>The task was to chop a list into exactly <code>n</code> evenly slized chunks. To give a little more context, let&#8217;s suppose we want to divide a list of jobs equally between <code>n</code> workers, where <code>n</code> might be the number of CPU cores available.
</p>
<p>We can build the result by repeatedly slicing the input:
</p>
<div class="typocode">

<pre class="prettyprint">def chunk(xs, n):
    '''Split the list, xs, into n chunks'''
    L = len(xs)
    assert 0 &lt; n &lt;= L
    s = L//n
    return [xs[p:p+s] for p in range(0, L, s)]

</pre>

</div>

<p>This looks promising
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; chunk('abcdefghi', 3)
['abc', 'def', 'ghi']

</pre>

</div>

<p>but if the size of the list is not an exact multiple of <code>n</code>, the result won&#8217;t contain <strong>exactly</strong> <code>n</code> chunks.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; chunk('abcde', 3)
['a', 'b', 'c', 'd', 'e']
&gt;&gt;&gt; chunk('abcdefgh', 3)
['ab', 'cd', 'ef', 'gh']
&gt;&gt;&gt; chunk('abcdefghij', 3)
['abc', 'def', 'ghi', 'j']

</pre>

</div>

<p>(By the way, I&#8217;m using strings rather than lists in the examples. The code works equally well for both types, and strings make it slightly easier to see what&#8217;s going on.)
</p>
<p>One way to fix the problem is to group the final chunks together.
</p>
<div class="typocode">

<pre class="prettyprint">def chunk(xs, n):
    '''Split the list, xs, into n chunks'''
    L = len(xs)
    assert 0 &lt; n &lt;= L
    s, r = divmod(L, n)
    chunks = [xs[p:p+s] for p in range(0, L, s)]
    chunks[n-1:] = [xs[-r-s:]]
    return chunks

</pre>

</div>

<p>Now we have exactly <code>n</code> chunks, but they may not be evenly sized, since the last chunk gets padded with any surplus.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; chunk('abcde', 3)
['a', 'b', 'cde']
&gt;&gt;&gt; chunk('abcdefgh', 3)
['ab', 'cd', 'efgh']
&gt;&gt;&gt; chunk('abcdefghij', 3)
['abc', 'def', 'ghij']

</pre>

</div>

<p>What does &#8220;evenly sized&#8221; actually mean? Loosely speaking, we want the resulting chunks as closely sized as possible.
</p>
<p>More precisely, if the result of dividing the length of the list <code>L</code> by the number of chunks <code>n</code> gives a size <code>s</code> with remainder <code>r</code>, then the function should return <code>r</code> chunks of size <code>s+1</code> and <code>n-r</code> chunks of size <code>s</code>. There are <a href="https://en.wikipedia.org/wiki/Combination">choose(n, r)</a> ways of doing this. Here&#8217;s a solution which puts the longer chunks to the front of the results.
</p>
<div class="typocode">

<pre class="prettyprint">def chunk(xs, n):
    '''Split the list, xs, into n evenly sized chunks'''
    L = len(xs)
    assert 0 &lt; n &lt;= L
    s, r = divmod(L, n)
    t = s + 1
    return ([xs[p:p+t] for p in range(0, r*t, t)] +
            [xs[p:p+s] for p in range(r*t, L, s)])

</pre>

</div>

<p>Here&#8217;s a second implementation, this time using <code>itertools</code>. Chaining <code>r</code> copies of <code>s+1</code> and <code>n-r</code> copies of <code>s</code> gives us the <code>n</code> chunk widths. Accumulating the widths gives us the list offsets for slicing &#8212; though note we need to prepend an initial <code>0</code>. Now we can form a <a href="/articles/zippy-triples-served-with-python">(this, next) pair of iterators</a> over the offsets, and the result is the accumulation of repeated <code>(begin, end)</code> slices taken from the original list.
</p>
<div class="typocode">

<pre class="prettyprint">from itertools import accumulate, chain, repeat, tee

def chunk(xs, n):
    assert n &gt; 0
    L = len(xs)
    s, r = divmod(L, n)
    widths = chain(repeat(s+1, r), repeat(s, n-r))
    offsets = accumulate(chain((0,), widths))
    b, e = tee(offsets)
    next(e)
    return [xs[s] for s in map(slice, b, e)]

</pre>

</div>

<p>This version does something sensible in the case when the number of slices, <code>n</code>, exceeds the length of the list.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; chunk('ab', 5)
['a', 'b', '', '', '']

</pre>

</div>

<p>Finally, some tests.
</p>
<div class="typocode">

<pre class="prettyprint">def test_chunk():
    assert chunk('', 1) == ['']
    assert chunk('ab', 2) == ['a', 'b']
    assert chunk('abc', 2) == ['ab', 'c']
    
    xs = list(range(8))
    assert chunk(xs, 2) == [[0, 1, 2, 3], [4, 5, 6, 7]]
    assert chunk(xs, 3) == [[0, 1, 2], [3, 4, 5], [6, 7]]
    assert chunk(xs, 5) == [[0, 1], [2, 3], [4, 5], [6], [7]]
    
    rs = range(1000000)
    assert chunk(rs, 2) == [range(500000), range(500000, 1000000)]

</pre>

</div>

</div>


<div class="atomentry" id="agile-at-a-distance">
<h2 class="title"><a href="/articles/agile-at-a-distance">Agile at a distance &#x1f44d;</a></h2>
<p class="meta"><abbr class="published" title="2017-04-14">2017-04-14</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/agile" rel="tag">Agile</a> &bull; <a href="/articles/agile-at-a-distance#disqus_thread">Comments</a></p>
<img width="540px" src="/docs/agile-at-a-distance/we-are-here.jpg" alt="We are here"/>

<p>I&#8217;m happy to be <a href="http://charlestolman.com/">part of a team</a> which supports remote working. This post collects a few notes on how agile practices fare when people may not be colocated. I don&#8217;t claim what&#8217;s written to be generally true; rather, it&#8217;s specific to me, my team, and how we work.
</p>
<img width="540px" src="/docs/agile-at-a-distance/remote-team.jpg" alt="Remote team"/>

<p>We&#8217;re by no means entirely distributed. There are seven of us in the engineering team, all UK based. We have a dedicated office space and of the seven, four are office-based and three are remote workers. Office-based staff are free to work from home when it suits. I&#8217;m office-based but work from home around 40% of the time, for example. Remote workers typically visit the office every couple of weeks to attend the sprint ceremonies &#8212; review, retrospective, planning. The rest of the company is more distributed and mobile, comprising product and marketing, medical experts, operations engineers, sales and admin.
</p>
<img width="540px" src="/docs/agile-at-a-distance/wfh.jpg" alt="WFH"/>
<div class="extended">
<p><a href="/articles/agile-at-a-distance#continue-reading">Continue reading...</a></p>
</div>

</div>


<div class="atomentry" id="from-bytes-to-strings-in-python-and-back-again">
<h2 class="title"><a href="/articles/from-bytes-to-strings-in-python-and-back-again">From bytes to strings in Python and back again</a></h2>
<p class="meta"><abbr class="published" title="2017-03-24">2017-03-24</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/unicode" rel="tag">Unicode</a> &bull; <a href="/articles/from-bytes-to-strings-in-python-and-back-again#disqus_thread">Comments</a></p>
<p>Low level languages like C have little opinion about what goes in a string, which is simply a null-terminated sequence of bytes. Those bytes could be ASCII or UTF-8 encoded text, or they could be raw data &#8212; object code, for example. It&#8217;s quite possible and legal to have a C string with mixed content.
</p>
<pre><code>char const * mixed =
    "EURO SIGN "          // ASCII
    "UTF-8 \xE2\x82\xAC " // UTF-8 encoded EURO SIGN
    "Latin-9 \xA4";       // Latin-9 encoded EURO SIGN
</code></pre><p>This might seem indisciplined and risky but it can be useful. Environment variables are notionally text but actually C strings, for example, meaning they can hold whatever data you want. Similarly filenames and command line parameters are only loosely text.
</p>
<p>A higher level language like Python makes a strict distinction between bytes and strings. Bytes objects contain raw data &#8212; a sequence of octets &#8212; whereas strings are Unicode sequences. Conversion between the two types is explicit: you encode a string to get bytes, specifying an encoding (which defaults to UTF-8); and you decode bytes to get a string. Clients of these functions should be aware that such conversions may fail, and should consider how failures are handled.
</p>
<p>Simply put, a string in Python is a valid Unicode sequence. Real world text data may not be. Programmers need to take charge of reconciling any discrepancies.
</p>
<p>We faced such problems recently <a href="https://clinithink.com">at work</a>. We&#8217;re in the business of extracting meaning from clinical narratives &#8212; text data stored on medical records systems in hospitals, for example. These documents may well have passed through a variety of systems. They may be unclear about their text encoding. They may not be encoded as they claim. So what? They can and do contain abbreviations, mispellings, jargon and colloquialisms. Refining the signal from such noise is our core business: if we can correctly interpret positional and temporal aspects of a sentence such as:
</p>
<blockquote><p>Previous fracture of left neck of femur
</p>
</blockquote><p>then we can surely deal with text which claims to be UTF-8 encoded but isn&#8217;t really.
</p>
<p>Our application stack is server-based: a REST API to a Python application handles document ingest; lower down, a C++ engine does the actual document processing. The problem we faced was supporting a modern API capable of handling real world data.
</p>
<p>It&#8217;s both undesirable and unnecessary to require clients to clean their text before submitting it. We want to make the ingest direct and idiomatic. Also, we shouldn&#8217;t penalise clients whose data <strong>is</strong> clean. Thus document upload is an HTTP POST request, and the document content is a JSON string &#8212; rather than, say, base64 encoded binary data. Our server, however, will be permissive about the contents of this string.
</p>
<p>So far so good. <a href="http://www.catb.org/jargon/html/P/Postels-Prescription.html" title="Postel's prescription">Postel&#8217;s prescription</a> advises:
</p>
<blockquote><p>Be liberal in what you accept, and conservative in what you send.
</p>
</blockquote><p>This would suggest accepting messy text data but presenting it in a cleaned up form. In our case, we <strong>do</strong> normalise the input data &#8212; a process which includes detecting and standardising date/time information, expanding abbreviations, fixing typos and so on &#8212; but this normalised form links back to a faithful copy of the original data. What gets presented to the user is their own text annotated with our findings. That is, we subscribe to a <a href="https://en.wikipedia.org/wiki/Garbage_in,_garbage_out">more primitive prescription</a> than Postel&#8217;s:
</p>
<blockquote><p>Garbage in, garbage out
</p>
</blockquote><p>with the caveat that the garbage shouldn&#8217;t be damaged in transit.
</p>
<p>Happily, there is a simple way to pass dodgy strings through Python. It&#8217;s used in the standard library to handle text data which isn&#8217;t guaranteed to be clean &#8212; those environment variables, command line parameters, and filenames for example.
</p>
<p>The <code>surrogateescape</code> error handler smuggles non-decodable bytes into the (Unicode) Python string in such a way that the original bytes can be recovered on encode, as described in <a href="https://www.python.org/dev/peps/pep-0383/" title="PEP 383 -- Non-decodable Bytes in System Character Interfaces">PEP 383</a>:
</p>
<blockquote><p>On POSIX systems, Python currently applies the locale&#8217;s encoding to convert the byte data to Unicode, failing for characters that cannot be decoded. With <a href="https://www.python.org/dev/peps/pep-0383/" title="PEP 383 -- Non-decodable Bytes in System Character Interfaces">this PEP</a>, non-decodable bytes &gt;= 128 will be represented as lone surrogate codes U+DC80..U+DCFF.
</p>
</blockquote><p>This workaround is possible because Unicode surrogates are intended for use in pairs. Quoting the Unicode specification, they <a href="http://www.unicode.org/versions/Unicode9.0.0/ch03.pdf#G2630">&#8220;have no interpretation on their own&#8221;</a>. The lone trailing surrogate code &#8212; the half-a-pair &#8212; can only be the result of a <code>surrogateescape</code> error handler being invoked, and the original bytes can be recovered by using the same error handler on encode.
</p>
<p>In conclusion, text data is handled differently in C++ and Python, posing a problem for layered applications. The <code>surrogateescape</code> error handler provides a standard and robust way of closing the gap.
</p>

<h2>Unicode Surrogate Pairs</h2>
<p><a href="http://www.unicode.org/versions/Unicode9.0.0/ch03.pdf#G2630"><img src="/images/unicode-surrogates.png" alt="Surrogates"/></a>
</p>

<h2>Code Listing</h2>
<pre><code>&gt;&gt;&gt; mixed = b"EURO SIGN \xE2\x82\xAC \xA4"
&gt;&gt;&gt; mixed
b'EURO SIGN \xe2\x82\xac \xa4'
&gt;&gt;&gt; mixed.decode()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa4 in position 14:
  invalid start byte
&gt;&gt;&gt; help(mixed.decode)
Help on built-in function decode:

decode(encoding='utf-8', errors='strict') method of builtins.bytes instance
    Decode the bytes using the codec registered for encoding.

encoding
      The encoding with which to decode the bytes.
    errors
      The error handling scheme to use for the handling of decoding errors.
      The default is 'strict' meaning that decoding errors raise a
      UnicodeDecodeError. Other possible values are 'ignore' and 'replace'
      as well as any other name registered with codecs.register_error that
      can handle UnicodeDecodeErrors.

&gt;&gt;&gt; mixed.decode(errors='surrogateescape')
'EURO SIGN &euro; \udca4'
&gt;&gt;&gt; s = mixed.decode(errors='surrogateescape')
&gt;&gt;&gt; s.encode()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeEncodeError: 'utf-8' codec can't encode character '\udca4' in position 12:
  surrogates not allowed
&gt;&gt;&gt; s.encode(errors='surrogateescape')
b'EURO SIGN \xe2\x82\xac \xa4'
</code></pre>

</div>


<div class="atomentry" id="24-puzzles">
<h2 class="title"><a href="/articles/24-puzzles">24 Puzzles</a></h2>
<p class="meta"><abbr class="published" title="2017-03-08">2017-03-08</abbr> &bull; <a href="/tag/puzzles" rel="tag">Puzzles</a>, <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/24-puzzles#disqus_thread">Comments</a></p>
<p>On <a href="http://blog.plover.com">The Universe of Discourse</a> Mark Dominus discusses the classic <a href="http://blog.plover.com/math/24-puzzle.html">24 Puzzle</a>:
</p>
<blockquote><p>You are given a sequence of four digits, say 1, 2, 3, 4, and your job is to combine them with ordinary arithmetic operations (+, -, &times;, and &divide;) in any order to make a target number, typically 24. For example, with 1, 2, 3, 4, you can go with <code>((1+2)+3)&times;4=24</code> or with <code>4&times;((2&times;3)&times;1)=24</code>.
</p>
</blockquote><p>Here&#8217;s a solver for such puzzles. It uses <code>itertools</code> to generate possible expressions, <code>fractions</code> to get the arithmetic right, and <code>eval</code> to evaluate expressions. It&#8217;s limited to expressions formed from 4 numbers which means I don&#8217;t have to programmatically calculate different ways of parenthesising: there are only 5.
</p>
<div class="typocode">

<pre class="prettyprint"># http://blog.plover.com/math/24-puzzle.html
import re
import math

# Use fractions for exact calculations
from fractions import Fraction

# Solve for 4 numbers only!
N = 4

# So these are the only expression templates
# where X is a number and @ is an operation
templates = '''\
((X @ X) @ X) @ X
(X @ (X @ X)) @ X
X @ ((X @ X) @ X)
X @ (X @ (X @ X))
(X @ X) @ (X @ X)'''.splitlines()

import itertools as its

def defrac(s):
    return re.compile(r'Fraction\((\d+)\)').sub(r'\1', s)

def evaluate(nums, ops, template):
    fracs = ('Fraction(%s)' % n for n in nums)
    ops = iter(ops)
    expr = ''.join(next(fracs) if c == 'X' else
                   next(ops) if c == '@' else c
                   for c in template)
    try:
        return expr, eval(expr)
    except ZeroDivisionError:
        return expr, None

def solve(spec, ops):
    numbers = re.compile(r'\d+').findall(spec)
    assert len(numbers) == N + 1
    result = Fraction(numbers.pop())
    seqs = its.product(its.permutations(numbers),
                       its.product(ops, repeat=N-1),
                       templates)
    print(defrac(next((e for e, v in its.starmap(evaluate, seqs)
                       if v == result),
                      'Impossible')))

def main():
    solve('2,5,6,6 =&gt; 17', '+-/*')
    solve('3,3,8,8 =&gt; 24', '+-/*')

main()

</pre>

</div>

<p>Here&#8217;s a second attempt, which doesn&#8217;t assume there will just be 4 numbers on the left hand side of the equation. Given a sequence of numbers and a set of operators, it repeatedly reduces the sequence length by picking pair of numbers and combining them using one of the operators, iterating over all possible ways of doing this. The first sequence of length 1 which equals the target value gives a solution and terminates the search.
</p>
<div class="typocode">

<pre class="prettyprint"># http://blog.plover.com/math/24-puzzle.html
from fractions import Fraction
import itertools as its
import operator
import re

def pick2(xs):
    return ((p[:2], p[2:]) for p in its.permutations(xs))

def allow(op, l, r):
    return op != '/' or eval(r) != 0

def apply(op, l, r):
    return '(%s%s%s)'%(l, op, r)

def values(xs, ops):
    L = [xs]
    while L:
        xs = L.pop()
        if len(xs) == 1:
            yield xs.pop()
        else:
            L.extend([apply(op, *lr)] + list(tl)
                     for op, (lr, tl) in its.product(ops, pick2(xs))
                     if allow(op, *lr))

def solve(spec, ops):
    numbers = ['Fraction(%s)'%n for n in re.compile(r'\d+').findall(spec)]
    target = eval(numbers.pop())
    print(next((v for v in values(numbers, ops) if eval(v) == target), 'Impossible'))

def main():
    solve('2,5,6,6 =&gt; 17', '+-/*')
    solve('3,3,8,8 =&gt; 24', '+-/*')

main()

</pre>

</div>

</div>


<div class="atomentry" id="unit-tests-questioned-reading-list">
<h2 class="title"><a href="/articles/unit-tests-questioned-reading-list">Unit Tests Questioned: Reading List</a></h2>
<p class="meta"><abbr class="published" title="2017-02-01">2017-02-01</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/tests" rel="tag">Tests</a>, <a href="/tag/knuth" rel="tag">Knuth</a>, <a href="/tag/hoare" rel="tag">Hoare</a> &bull; <a href="/articles/unit-tests-questioned-reading-list#disqus_thread">Comments</a></p>
<p>I enjoyed <a href="http://swanseasdc.co.uk/events/why-service-oriented-architecture/">talking about unit testing</a> last night, and would like to thank <a href="https://twitter.com/SwanseaSDC">Swansea Software Development Community</a> and especially Viv Richards for organising the event, <a href="https://swansea.techhub.com/">TechHub</a> for the venue, and everyone who turned up to listen, ask questions and offer feedback.
</p>
<div><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Up first <a href="https://twitter.com/thomasguest">@thomasguest</a> <a href="https://twitter.com/hashtag/ssdc?src=hash">#ssdc</a> <a href="https://t.co/4nEqh0ErZr">pic.twitter.com/4nEqh0ErZr</a></p>&mdash; SSDC (@SwanseaSDC) <a href="https://twitter.com/SwanseaSDC/status/826137883341885441">January 30, 2017</a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div>

<p>The slides are available <a href="/docs/unit-tests">here</a>. You&#8217;ll find links in the slide deck to the various papers and articles I referenced, but for convenience I&#8217;m listing them here with some notes.
</p>
<ol>
 <li><p><big><a href="http://www.gwern.net/docs/1996-hoare.pdf" title="Tony Hoare, How Did Software Get So Reliable Without Proof? (PDF)">How Did Software Get So Reliable Without Proof?</a></big> by Sir Tony Hoare, published in 1996, is a considered and authoritative paper, in which the author calls into question much of his own research. It&#8217;s not necessary to prove your programs correct, he writes, you can create systems which are both large and reliable using more pragmatic techniques. Since then, his conviction has strengthened. I had the privilege of attending his keynote at <a href="/articles/europython-2009">Europython 2009</a>, when he spoke about the science of computing and the engineering of software (this same talk is available on <a href="https://www.infoq.com/presentations/tony-hoare-computing-engineering">InfoQ</a>). His closing slide stated: One day, software will be the most reliable component of every product which contains it; and software engineering will be the most dependable of all engineering professions.
</p>

 </li>

 <li><p><big><a href="http://rbcs-us.com/documents/Why-Most-Unit-Testing-is-Waste.pdf" title="Why Most Unit Testing is Waste (PDF)">Why Most Unit Testing is Waste</a></big> by James O Coplien calls out the unit testing zealots and makes the point that testers should be skeptical.
</p>

 </li>

 <li><p><big><a href="http://www.sqlite.org/testing.html" title="How SQLite Is Tested">How SQLite Is Tested</a></big> details what it takes to make bomb-proof software. Most of the tests described are system level tests. It&#8217;s an impressive document which proves that writing tests requires creativity, determination and maybe even a sprinkling of malice.
</p>

 </li>

 <li><p><big><a href="https://testing.googleblog.com/2016/05/flaky-tests-at-google-and-how-we.html" title="Flaky Tests at Google and How We Mitigate Them, John Micco">Flaky Tests at Google and How We Mitigate Them</a></big> is an honest and all too familiar tale of unreliable tests. However hard you try to eradicate test instabilities, it seems they creep back in at the same rate.
</p>

 </li>

 <li><p><big><a href="https://martinfowler.com/articles/testing-culture.html" title="Goto Fail, Heartbleed, and Unit Testing Culture">Goto Fail, Heartbleed, and Unit Testing Culture</a></big> argues unit tests would have trapped some notorious bugs in low level security software. It goes on to describe in detail the changing culture of the Google Web Server team, which successfully adopted a test-focused regime. There&#8217;s some good advice on de-flaking, so I hope the author connected with his suffering colleagues.
</p>

 </li>

 <li><p><big><a href="https://staff.fnwi.uva.nl/p.vanemdeboas/knuthnote.pdf" title="The correspondence between Donald E. Knuth and Peter van Emde Boas on priority deques during the spring of 1977">The correspondence between Donald E. Knuth and Peter van Emde Boas on priority deques during the spring of 1977</a></big> provides the background and context of Donald Knuth&#8217;s famous quotation, &#8220;Beware of bugs in the above code; I have only proved it correct, not tried it&#8221;. It&#8217;s a a witty admonition but Donald Knuth isn&#8217;t joking. Don&#8217;t trust code until you&#8217;ve run it. Better, run it repeatedly through automated tests.
</p>

 </li>
</ol>

</div>


<div class="atomentry" id="unit-tests-questioned">
<h2 class="title"><a href="/articles/unit-tests-questioned">Unit Tests Questioned</a></h2>
<p class="meta"><abbr class="published" title="2017-01-21">2017-01-21</abbr> &bull; <a href="/tag/self" rel="tag">self</a>, <a href="/tag/tests" rel="tag">tests</a>, <a href="/tag/talks" rel="tag">talks</a> &bull; <a href="/articles/unit-tests-questioned#disqus_thread">Comments</a></p>
<p>I&#8217;m looking forward to <a href="http://swanseasdc.co.uk/events/why-service-oriented-architecture/">talking at TechHub Swansea</a> at the end of the month on the subject of unit testing. 
</p>
<p>The introduction to the talk is here. 
</p>
<p>Hope to see you there.
</p>
<p><a href="/docs/unit-tests/"><img width=640 src="/images/unit-tests-questioned.png" alt="Unit Tests Questioned"/></a>
</p>
<p>In this talk we&#8217;ll consider if unit testing is a good use of our time.
</p>
<p>I am not questioning whether <strong>testing</strong> is important. This slide shows the abstract of <a href="http://www.gwern.net/docs/1996-hoare.pdf" title="(PDF) How did software get so reliable without proof?">a paper published in 1996 by Tony Hoare</a>. What he says is that you don&#8217;t need to <strong>prove</strong> your software works: you can make it so through design and review; by testing; and by good engineering.
</p>
<img width=640 src="/docs/unit-tests/images/how-did-software-get-so-reliable.png" alt="How did software get so reliable without proof?"/>

<p>This may no longer seem controversial or novel but maybe it was a surprising thing for Tony Hoare to say. After all, he invented <a href="https://en.wikipedia.org/wiki/Quicksort">quicksort</a> back in 1959, an algorithm which he <strong>proved</strong> correct. He also proved how quickly it runs, and that &#8212; in the general case &#8212; it couldn&#8217;t be beaten. Much of Hoare&#8217;s subsequent research was dedicated to proving software works using techniques known as <a href="https://en.wikipedia.org/wiki/Formal_methods" title="Formal Methods (Wikipedia)">formal methods</a>. The idea is that you write a formal specification of what your program should do, and then you mathematically verify your code satisfies that specification. Surely nothing less is good enough for software which really is a matter of life and death: a life support system, or a device driver in a nuclear warhead, for example? Actually, no, he says in this paper, there are more pragmatic routes to reliable software.
</p>
<p>So, the idea that you can build reliability via testing may once have seemed radical. It doesn&#8217;t any more. Maybe, though, the conventional modern wisdom that <strong>unit tests</strong> are a good thing should be questioned.
</p>
<img src="/docs/unit-tests/images/coplien.jpg" alt="Coplien" />

<p>James O Coplien voices a dissenting opinion in a more recent paper, <a href="http://rbcs-us.com/documents/Why-Most-Unit-Testing-is-Waste.pdf" title="(PDF) Why Most Unit Testing is Waste">&#8220;Why most unit testing is waste&#8221;</a>.
</p>
<p>What&#8217;s Cope on about!?
</p>
<p>Such is the force of current thinking that even the title of this paper makes it seem like he&#8217;s trolling. Having read the paper carefully, I don&#8217;t think he is. That doesn&#8217;t mean I agree with him, but I agree with his attitude:
</p>
<blockquote><p>There&#8217;s a lot of advice, but very little of it is backed either by theory, data, or even a model of why you should believe a given piece of advice. Good testing begs skepticism. Be skeptical of yourself: measure, prove, retry. Be skeptical of me for heaven&#8217;s sake.
</p>
</blockquote><p>So, this talk will do just that.
</p>
<p>Unit tests: let&#8217;s get skeptical!
</p>

</div>


<div class="atomentry" id="a-language-people-use-and-bitch-about">
<h2 class="title"><a href="/articles/a-language-people-use-and-bitch-about">A language people use and bitch about</a></h2>
<p class="meta"><abbr class="published" title="2016-08-24">2016-08-24</abbr> &bull; <a href="/tag/c" rel="tag">C</a>, <a href="/tag/c++" rel="tag">C++</a> &bull; <a href="/articles/a-language-people-use-and-bitch-about#disqus_thread">Comments</a></p>
<p>Every so often a new essay hits the top of the programming news sites:
</p>
<ul>
 <li>
     why I&#8217;m rewriting <a href="http://250bpm.com/blog:4" title="Why should I have written ZeroMQ in C, not C++">X in C</a> (and abandoning C++)
 </li>

 <li>
     why we will never use C++ for Y (which has always been written in C)
 </li>

 <li>
     why C++ is a <a href="http://thread.gmane.org/gmane.comp.version-control.git/57643/focus=57918" title="Torvalds rants about C++">horrible language</a> (it isn&#8217;t C)
 </li>
</ul>
<p>I&#8217;m a sucker for these articles and have some sympathy with them. Every so often I work with C code rather than C++, and find the experience refreshing: rapid compilation, clear build diagnostics, comprehensible APIs, easy debugging, and an agreeable reduction in layering and punctuation.
</p>
<p>It&#8217;s always easy to return to C because it hasn&#8217;t really changed. Well, it <strong>has</strong> changed, conservatively, and C programmers seem conservative in adopting new features.
</p>
<p>By contrast, C++ <strong>does</strong> change. Sure, C++0X was a long time coming &#8212; finally realised as C++11 &#8212; but since that giant step, smaller improvements continue apace. As a result C++ code soon looks stale. Every time I visit a source file it seems I have to freshen it, using the new way to prevent copying, or return containers, or manage resources, or pass functions, or &#8230; you get the idea.
</p>
<p>The truth is, every substantial C++ codebase I&#8217;ve worked on reads like a history of C++. Somewhere low down there&#8217;ll be hand-written intrusive linked lists; then there&#8217;ll be a few layers of classes, some nested for good measure; then templates, <a href="http://www.boost.org/">boost</a>, functions disguised as classes for use in algorithms; and finally the good stuff, in which auto, lambda, move semantics and intialisers allow us to code as we&#8217;ve always wanted.
</p>
<p>Bjarne Stroustrup <a href="http://www.stroustrup.com/blast.html">defends C++ on his website</a>:
</p>
<blockquote><p>As someone remarked: There are only two kinds of programming languages: those people always bitch about and those nobody uses.
</p>
</blockquote><p>If that &#8220;someone&#8221; wasn&#8217;t Stroustrup, it is now &#8212; he has become the source of his own quotation. His point is that C++ is well-used and must therefore be bitched about.
</p>
<p>C provides an immediate counter-example, however. It is undeniably used, but its <a href="https://en.wikipedia.org/wiki/C_Traps_and_Pitfalls">traps and pitfalls</a> are known and respected, rather than bitched about.
</p>
<p>Ultimately, though, I find C too limited. The lack of standard containers and algorithms combined with the overheads of heap management and ubiquitous error checking make programming in C heavy going.
</p>
<p>C++ is hard to learn and hard to keep up with. The language has grown, considerably, but the progression is necessary. It&#8217;s the more recent extensions which fully realise the power of the standard template library, for example. Stick with C++. The reward will be code which is expressive and efficient.
</p>

</div>


<div class="atomentry" id="negative-sequence-indices-in-python">
<h2 class="title"><a href="/articles/negative-sequence-indices-in-python">Negative Sequence Indices in Python</a></h2>
<p class="meta"><abbr class="published" title="2016-08-01">2016-08-01</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/c++" rel="tag">C++</a> &bull; <a href="/articles/negative-sequence-indices-in-python#disqus_thread">Comments</a></p>
<p>Supply a negative index when accessing a sequence and Python counts back from the end. So, for example, <code>my_list[-2]</code> is the penultimate element of <code>my_list</code>, which is much better than <code>my_list[len(my_list)-2]</code> or even <code>*(++my_list.rbegin())</code>.
</p>
<p>That final example uses one of C++&#8217;s reverse iterators. It gets the penultimate element of a collection by advancing an iterator from the reversed beginning of that collection. If you&#8217;re addicted to negative indices you <strong>can</strong> use them with C++ arrays, sort of.
</p>
<div class="typocode"><div class="codetitle">Negative array indices in C++</div>

<pre class="prettyprint">#include &lt;iostream&gt;

int main()
{
    char const * domain = "wordaligned.org";
    char const * end = domain + strlen(domain);
    std::cout &lt;&lt; end[-3] &lt;&lt; end[-2] &lt;&lt; end[-1] &lt;&lt; '\n';
    return 0;
}

</pre>

</div>

<p>Compiling and running this program outputs the string &#8220;org&#8221;.
</p>
<p>Going back to Python, the valid indices into a sequence of length <code>L</code> are <code>-L</code>, <code>-L+1</code>, &#8230; , <code>0</code>, <code>1</code>, &#8230; <code>L-1</code>. Whenever you write code to calculate an index used for accessing a sequence, and especially if you&#8217;re catching any resulting <code>IndexError</code>s, it&#8217;s worth checking if the result of the calculation can be negative, and if &#8212; in this case &#8212; you really do want the from-the-back indexing behaviour.
</p>
<div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">0</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">1</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">2</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">3</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">4</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">5</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">6</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">7</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">8</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">9</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">10</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">11</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">12</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">13</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&hellip;</div></div>
<div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">W</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">O</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">R</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">D</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">A</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">L</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">I</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">G</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">N</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">E</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">D</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div></div>
<div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&hellip;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-14</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-13</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-12</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-11</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-10</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-9</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-8</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-7</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-6</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-5</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-4</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-3</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-2</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">-1</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div><div style="line-height: 30px;font-family: monospace;text-align:center;border: 1px solid black;width: 30px;height:30px;display:inline-block;">&nbsp;</div></div>

<p>The power of negative indices increases with slicing. Take a slice of a sequence by supplying begin and end indices.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; domain = 'wordaligned.org'
&gt;&gt;&gt; domain[4:9]
'align'
&gt;&gt;&gt; domain[4:-4]
'aligned'
&gt;&gt;&gt; digits = list(range(10))
&gt;&gt;&gt; digits
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt; digits[3:4]
[3]
&gt;&gt;&gt; digits[1:-1]
[1, 2, 3, 4, 5, 6, 7, 8]

</pre>

</div>

<p>Omitting an index defaults it to the end of the sequence. Omit both indices and both ends of the sequence are defaulted, giving a sliced copy.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; domain[-3:]
'org'
&gt;&gt;&gt; domain[:4]
'word'
&gt;&gt;&gt; digits[:]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

</pre>

</div>

<p>I prefer the <code>list(digits)</code> form for copying <code>digits</code> but you should certainly be familiar with the <code>digits[:]</code> version.
</p>
<p>You can supply any indices as slice limits, even ones which wouldn&#8217;t be valid for item access. Imagine laying your sequence out on an indexed chopping board, slicing it at the specified points, then taking whatever lies between these points.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; digits[-1000000]
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
IndexError: list index out of range
&gt;&gt;&gt; digits[1000000]
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
IndexError: list index out of range
&gt;&gt;&gt; digits[-1000000:1000000]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

</pre>

</div>

<p>Sequence slicing also takes a step parameter.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; digits[::2]
[0, 2, 4, 6, 8]
&gt;&gt;&gt; digits[1::2]
[1, 3, 5, 7, 9]

</pre>

</div>

<p>This parameter too can be negative. The sign of the step affects which limiting values the <code>begin</code> and <code>end</code> slice parameters default to. It&#8217;s subtle behaviour, but you soon get used to it.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; digits[0:10:-2]
[]
&gt;&gt;&gt; digits[::-2]
[9, 7, 5, 3, 1]
&gt;&gt;&gt; digits[-2::-2]
[8, 6, 4, 2, 0]

</pre>

</div>

<p>How do you reverse a string? Slice it back to front!
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; domain[::-1]
'gro.dengiladrow'

</pre>

</div>

<p>To recap: the default slice limits are the start and end of the sequence, <code>0</code> and <code>-1</code>, or <code>-1</code> and <code>0</code> if the step is negative. The default step is <code>1</code> whichever way round the limits are. When slicing, <code>s[i:j:k]</code>, <code>i</code> and <code>j</code> may take any integer value, and <code>k</code> can take any integer value <strong>except</strong> <code>0</code>.
</p>
<p>The zero value creates another interesting edge case. Here&#8217;s a function to return the last <code>n</code> items of a sequence.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; def tail(xs, n)
...     return xs[-n:]
...

</pre>

</div>

<p>It fails when <code>n</code> is <code>0</code>.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; tail(digits, 3)
[7, 8, 9]
&gt;&gt;&gt; tail(digits, 2)
[8, 9]
&gt;&gt;&gt; tail(digits, 1)
[9]
&gt;&gt;&gt; tail(digits, 0)
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]

</pre>

</div>

<p>By the way, we&#8217;ve already seen slicing working well with lists and strings. It also works nicely with range objects.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; r = range(10)
&gt;&gt;&gt; r[::2]
range(0, 10, 2)
&gt;&gt;&gt; r[1::2]
range(1, 10, 2)

</pre>

</div>

</div>


<div class="atomentry" id="python-streams-vs-unix-pipes">
<h2 class="title"><a href="/articles/python-streams-vs-unix-pipes">Python Streams vs Unix Pipes</a></h2>
<p class="meta"><abbr class="published" title="2016-07-28">2016-07-28</abbr> &bull; <a href="/tag/shell" rel="tag">Shell</a>, <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/puzzles" rel="tag">Puzzles</a>, <a href="/tag/streams" rel="tag">Streams</a>, <a href="/tag/primes" rel="tag">Primes</a> &bull; <a href="/articles/python-streams-vs-unix-pipes#disqus_thread">Comments</a></p>
<div class="toc">
<h2>Contents</h2>
<ul>
 <li><a href="#tocinfinite-series-and-python" name="toc0" id="toc0">Infinite series and Python</a>
 </li>

 <li><a href="#tocinfinite-series-in-other-languages" name="toc1" id="toc1">Infinite series in Other Languages</a>
 </li>

 <li><a href="#tocpartial-sums" name="toc2" id="toc2">Partial sums.</a>
 </li>

 <li><a href="#tocconsecutive-sums" name="toc3" id="toc3">Consecutive sums</a>
 </li>

 <li><a href="#tocbug-fixes" name="toc4" id="toc4">Bug Fixes</a>
 </li>

 <li><a href="#tocmerging-streams" name="toc5" id="toc5">Merging Streams</a>
 </li>

 <li><a href="#tocgenerating-primes" name="toc6" id="toc6">Generating Primes</a>
 </li>

 <li><a href="#tocpipe-connection" name="toc7" id="toc7">Pipe Connection</a>
 </li>

 <li><a href="#tocportability" name="toc8" id="toc8">Portability</a>
 </li>

 <li><a href="#tocstream-merge" name="toc9" id="toc9">Stream Merge</a>
 </li>

 <li><a href="#tocalternative-solutions" name="toc10" id="toc10">Alternative Solutions</a>
 </li>
</ul>
</div><p>I chanced upon an interesting puzzle:
</p>
<blockquote><p>Find the smallest number that can be expressed as the sum of 5, 17, 563, 641 consecutive prime numbers, and is itself a prime number.
</p>
</blockquote><img src="/images/primes.png" alt="Small primes graphic"/>

<p>Here, the prime numbers are an infinite steam:
</p>
<div class="typocode">

<pre class="prettyprint">2, 3, 5, 7, 11, 13 ...

</pre>

</div>

<p>and sums of N consecutive primes are similarly infinite. For example, the sum of 2 consecutive primes would be the stream:
</p>
<div class="typocode">

<pre class="prettyprint">2+3, 3+5, 5+7, 7+11, 11+13 ...

</pre>

</div>

<p>which is:
</p>
<div class="typocode">

<pre class="prettyprint">5, 8, 12, 18, 24 ...

</pre>

</div>

<p>and the sum of 3 consecutive primes is:
</p>
<div class="typocode">

<pre class="prettyprint">10 (=2+3+5), 15, 23, 31 ...

</pre>

</div>

<p>Had we been asked to find the smallest number which can be expressed as the sum of 3 consecutive primes and as the sum of 5 consecutive primes and is itself prime, the answer would be <code>83</code>.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; 23 + 29 + 31
83
&gt;&gt;&gt; 11 + 13 + 17 + 19 + 23
83

</pre>

</div>


<h3><a href="#toc0" name="tocinfinite-series-and-python" id="tocinfinite-series-and-python">Infinite series and Python</a></h3>
<p>My first thought was to tackle this puzzle using Python iterators and generators. Here&#8217;s the outline of a strategy:
</p>
<ul>
 <li>
     starting with a stream of primes
 </li>

 <li>
     tee the stream to create 4 additional copies
 </li>

 <li>
     transform these copies into the consecutive sums of 5, 17, 563 and 641 primes
 </li>

 <li>
     now merge these consecutive sums back with the original primes stream
 </li>

 <li>
     group the elements of this merged stream by value
 </li>

 <li>
     the first group which contains 5 elements must have occurred in every source, and is therefore a prime and representable as the consecutive sum of 5, 17, 563 and 641 primes
 </li>

 <li>
     which solves the puzzle!
 </li>
</ul>
<p>Note that when we copy an infinite stream we cannot consume it first. We will have to be lazy or we&#8217;ll get exhausted.
</p>
<p>Courtesy of the Python Cookbook, I already had a couple of <a href="http://www.onlamp.com/pub/a/python/excerpt/pythonckbk_chap1/index1.html?page=2">useful</a> <a href="http://code.activestate.com/recipes/491285-iterator-merge/">recipes</a> to help implement this strategy:
</p>
<div class="typocode">

<pre class="prettyprint">def primes():
    '''Generate the sequence of prime numbers: 2, 3, 5 ... '''
    ....

def stream_merge(*ss):
    '''Merge a collection of sorted streams.
    
    Example: merge multiples of 2, 3, 5
    &gt;&gt;&gt; from itertools import count, islice
    &gt;&gt;&gt; def multiples(x): return (x * n for n in count(1))
    &gt;&gt;&gt; s = stream_merge(multiples(2), multiples(3), multiples(5))
    &gt;&gt;&gt; list(islice(s, 10))
    [2, 3, 4, 5, 6, 6, 8, 9, 10, 10]
    '''
    ....

</pre>

</div>

<p>Both these functions merit a closer look for the cunning use they make of standard containers, but we&#8217;ll defer this inspection until later. In passing, note that <code>stream_merge()</code>&#8217;s docstring suggests we might try using it as basis for <code>primes()</code>:
</p>
<ol>
 <li><p>form the series of composite (non-prime) numbers by merging the streams formed by multiples of prime numbers; 
</p>

 </li>

 <li><p>the primes remain when you remove these composites from the series of natural numbers.
</p>

 </li>
</ol>
<p>This scheme is hardly original &#8212; it&#8217;s a variant of <a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Eratosthenes&#8217; sieve</a> &#8212; but if you look carefully you&#8217;ll notice the self-reference. Unfortunately recursive definitions of infinite series don&#8217;t work well with Python<a id="fn1link" href="#fn1"><sup>[1]</sup></a>, hence <code>primes()</code> requires a little more finesse. We&#8217;ll take a look at it later.
</p>
<p>Moving on, to solve the original puzzle we need a consecutive sum filter. This will transform a stream of numbers into a stream of consecutive sums of these numbers:
</p>
<div class="typocode">

<pre class="prettyprint">def consecutive_sum(s, n):
    '''Generate the series of sums of n consecutive elements of s
    
    Example: 0, 1, 2, 3, 4 ... =&gt; 0+1, 1+2, 2+3, 3+4, ...
    &gt;&gt;&gt; from itertools import count, islice
    &gt;&gt;&gt; list(islice(consecutive_sum(count(), 2), 10))
    [1, 3, 5, 7, 9, 11, 13, 15, 17, 19]
    '''
    lo, hi = itertools.tee(s)
    csum = sum(next(hi) for _ in range(n))
    while True:
        yield csum
        csum += next(hi) - next(lo)

</pre>

</div>

<p>Here we can think of the summed elements as lying within a sliding window: each time we slide the window an element gets added to the top and an element gets removed from the bottom, and we adjust <code>csum</code> accordingly.
</p>
<p>So, now we have:
</p>
<ul>
 <li>
     the series of prime numbers, <code>primes()</code>
 </li>

 <li>
     a <code>stream_merge()</code> connector
 </li>

 <li>
     a <code>consecutive_sum()</code> filter
 </li>
</ul>
<p>The remaining stream adaptors come from the standard <a href="http://docs.python.org/lib/itertools-functions.html">itertools module</a>. Note that the <code>stream_merge()</code> works here since all the consecutive sum series are strictly increasing. Note also that the stream of prime numbers can be treated as <code>consecutive_sum(s=primes(), n=1)</code>, handling the &#8220;and is itself a prime number&#8221; requirement.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; lens = 1, 5, 17, 563, 641
&gt;&gt;&gt; N = len(lens)
&gt;&gt;&gt; from itertools import tee, groupby
&gt;&gt;&gt; ps = tee(primes(), N)
&gt;&gt;&gt; csums = [consecutive_sum(p, n) for p, n in zip(ps, lens)]
&gt;&gt;&gt; solns = (n for n, g in groupby(stream_merge(*csums)) 
             if len(list(g)) == N)

</pre>

</div>

<p>Here, <code>solns</code> is yet another stream, the result of merging the <code>N</code> input consecutive sum streams then filtering out the numbers which appear <code>N</code> times; that is, the numbers which can be expressed as sums of 1, 5, 17, 563 and 641 consecutive primes.
</p>
<p>The first such number solves the original puzzle.
</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; next(solns)
7002221

</pre>

</div>

<p>Here&#8217;s a picture of how these stream tools link up to solve this particular puzzle. The great thing is that we can reconnect these same tools to solve a wide range of puzzles, and indeed more practical <a href="http://www.dabeaz.com/generators/">processing tasks</a>. To use the common analogy, we direct data streams along pipes.
</p>
<img alt="Stream connections" src="/images/pipeline.png"/>


<h3><a href="#toc1" name="tocinfinite-series-in-other-languages" id="tocinfinite-series-in-other-languages">Infinite series in Other Languages</a></h3>
<p>Python is the language I find most convenient most of the time, which explains why I reached for it first. It&#8217;s an increasingly popular language, which helps explain why I didn&#8217;t need to write the tricky parts of my solution from scratch: they&#8217;d already been done. Python is also a language which makes compromises. Having used Python to find a solution to the puzzle I wondered if there wasn&#8217;t some other language better suited to this kind of problem.
</p>
<p><a href="http://haskell.org">Haskell</a> makes no compromises when it comes to functional programming. Its lazy evaluation and inductive recursion make it a perfect fit for this kind of puzzle &#8212; but my  approach of teeing, filtering and merging made me consider the Unix Shell. Now, I use Bash every day and page through its manual at least once a week. Scripting appeals and I&#8217;m comfortable at the command line. How hard could it be to solve this puzzle using Bash? After all, I already knew the answer!
</p>

<h3><a href="#toc2" name="tocpartial-sums" id="tocpartial-sums">Partial sums.</a></h3>
<p>Here&#8217;s a simple shell function to generate partial sums. I&#8217;ve used <code>awk</code>, a little language I gave up on a long time ago in favour of more rounded scripting languages like Perl and then Python. Now I look at it again, it seems to fill a useful gap. Awk processes a file sequentially, applying pattern-action rules to each line, a processing template which I&#8217;ve reinvented less cleanly many times. Despite my rediscovery of <code>awk</code>, I&#8217;ll be keeping its use strongly in check in what follows.
</p>
<div class="typocode">

<pre class="prettyprint">$ psum() { awk '{ print s += $1 }'; }

</pre>

</div>

<p>Much like Perl, <code>awk</code> guesses what you want to do. Here, it conjures the summation variable, <code>s</code>, into existence, assigning it a default initial value of 0. (Good guess!) Since we&#8217;re doing arithmetic <code>awk</code> converts the first field of each input line into a number. We can test <code>psum</code> by using <code>jot</code> to generate the sequence 1, 2, 3, 4, 5 (this is on a Mac &#8212; on a Linux platform use <code>seq</code> instead of <code>jot</code>).
</p>
<div class="typocode">

<pre class="prettyprint">$ jot 5 | psum
1
3
6
10
15

</pre>

</div>


<h3><a href="#toc3" name="tocconsecutive-sums" id="tocconsecutive-sums">Consecutive sums</a></h3>
<p>You may be wondering why we&#8217;ve bothered creating this partial sum filter since it&#8217;s the sums of consecutive elements we&#8217;re after, rather than the sum of the series so far. Well, notice that if <code>P[i]</code> and <code>P[i+n]</code> are two elements from the series of partial sums of S, then their difference, <code>P[i+n] - P[i]</code>, is the sum of the <code>n</code> consecutive elements from S.
</p>
<p>So to form an n-element consecutive sum series we can tee the partial sums streams, advance one of these by n, then zip through them in parallel finding their differences. An example makes things clear:
</p>
<div class="typocode">

<pre class="prettyprint">$ mkfifo pipe
$ jot 5 | psum | tee pipe | tail -n +2 | paste - pipe
3       1
6       3
10      6
15      10
        15

</pre>

</div>

<p>Here, <code>jot 5</code> generates the sequence 1, 2, 3, 4, 5, which <code>psum</code> progressively accumulates to 1, 3, 6, 10, 15. We then <code>tee</code> this partial sum series through two pipes: the first, <code>pipe</code>, is an explicitly created named pipe created by <code>mkfifo</code>, the second is implicitly created by the pipeline operator, <code>|</code>. The remainder of the command line delays one series by one (note that <code>tail</code> numbers lines from <code>1</code>, not <code>0</code>, so <code>tail -n +1</code> is the identity filter) then pastes the two series back together<a id="fn2link" href="#fn2"><sup>[2]</sup></a>.
</p>
<p>By appending a single <code>awk</code> action to the pipeline we get a consecutive sum series.
</p>
<div class="typocode">

<pre class="prettyprint">$ jot 5 | psum | tee pipe | tail -n +2 | paste - pipe | awk '{print $1 - $2}'
2
3
4
5
15

</pre>

</div>

<p>The output 2, 3, 4, 5 is the series of consecutive sums of length 1 taken from the original series 1, 2, 3, 4, 5. The trailing 15 and the 1 missed from the start are edge case problems, and easily corrected.
</p>
<p>Accumulating an increasing series of numbers in order to find the differences between elements lying a given distance apart on this series isn&#8217;t a very smart idea on a computer with a fixed word-size, but it&#8217;s good to know (e.g.) that <code>awk</code> doesn&#8217;t stop counting at 32 bits.
</p>
<div class="typocode">

<pre class="prettyprint">$ let "N=1&lt;&lt;32" &amp;&amp; echo $N | tee &gt;(awk '{print $1 * $1}')
4294967296
18446744073709551616

</pre>

</div>

<p>Exactly if and when awk stops counting, I&#8217;m not sure. The documentation doesn&#8217;t say and I haven&#8217;t looked at the source code.
</p>

<h3><a href="#toc4" name="tocbug-fixes" id="tocbug-fixes">Bug Fixes</a></h3>
<p>Let&#8217;s capture these tiny functions and name them. Here, then, are revised <code>psum()</code> and <code>sdiff()</code> filters. The edge case problems should now be fixed.
</p>
<div class="typocode">

<pre class="prettyprint">$ psum()  { awk 'BEGIN { print 0 }{print s += $1 }'; }
$ delay() { let "n = $1 + 1" &amp;&amp; tail +$n; } 
$ sdiff() { mkfifo p.$1 &amp;&amp; tee p.$1 | delay $1 | paste - p.$1 | \
            awk 'NF == 2 {print $1 - $2 }'; }

</pre>

</div>

<p>A quick test:
</p>
<div class="typocode">

<pre class="prettyprint">$ jot 5 | psum | sdiff 3
6
9
12

</pre>

</div>

<p>The output is, as expected, the series of sums of consecutive triples taken from 1, 2, 3, 4, 5 (6=1+2+3, 9=2+3+4, 12=3+4+5).
</p>
<p>There&#8217;s a pernicious bug, though. These functions can&#8217;t handle infinite series so they are of limited use as pipeline tools. For example, if we stream in the series 0, 1, 2, &#8230; (generated here as the partial sums of the series 1, 1, 1, &#8230;) nothing gets output and we have to interrupt the process.
</p>
<div class="typocode">

<pre class="prettyprint"># This command appears to hang
$ yes 1 | psum | sdiff 1
^C

</pre>

</div>

<p>To work around this is, we can use Gnu <code>stdbuf</code> to prohibit <code>tail</code> and <code>paste</code> from using output buffers.
</p>
<div class="typocode">

<pre class="prettyprint">$ psum()  { awk 'BEGIN { print 0 }{print s += $1 }'; }
$ delay() { let "n = $1 + 1" &amp;&amp; stdbuf -o 0 tail +$n; } 
$ sdiff() { mkfifo p.$1 &amp;&amp; tee p.$1 | delay $1 | \
            stdbuf -o 0 paste - p.$1 | \
            awk 'NF == 2 {print $1 - $2 }'; }

</pre>

</div>

<p>Now the data flows again:
</p>
<div class="typocode">

<pre class="prettyprint"># Accumulate the stream 1 1 1 ...
# and print the difference between successive elements
$ yes 1 | psum | sdiff 1
1
1
1
1
^C

</pre>

</div>


<h3><a href="#toc5" name="tocmerging-streams" id="tocmerging-streams">Merging Streams</a></h3>
<p>The Unix shell merges streams rather more succinctly than Python. <code>Sort -m</code> does the job directly. Note that a standard <code>sort</code> cannot yield any output until all its inputs are exhausted, since the final input item might turn out to be the one which should appear first in the output. Merge sort, <code>sort -m</code>, can and does produce output without delay<a id="fn3link" href="#fn3"><sup>[3]</sup></a>.
</p>
<div class="typocode">

<pre class="prettyprint">$ yes | sort
^C
$ yes | sort -m
y
y
y
y
y
^C

</pre>

</div>


<h3><a href="#toc6" name="tocgenerating-primes" id="tocgenerating-primes">Generating Primes</a></h3>
<p>No doubt it&#8217;s possible to generate the infinite series of prime numbers using native Bash code, but I chose to reuse the <a href="http://www.onlamp.com/pub/a/python/excerpt/pythonckbk_chap1/index1.html?page=2">Python Cookbook recipe</a> for the job.
</p>
<div class="typocode"><div class="codetitle">primes</div>

<pre class="prettyprint">#!/usr/bin/env python
import itertools

def primes():
    '''Generate the prime number series: 2, 3, 5 ... '''
    D = {}
    for n in itertools.count(2):
        p = D.pop(n, None)
        if p is None:
            yield n
            D[n * n] = n
        else:
            x = n + p
            while x in D:
                x += p
            D[x] = p

for p in primes():
    print(p)

</pre>

</div>

<p>This is a subtle little program which makes clever use of Python&#8217;s native hashed array container, the dictionary. In this case dictionary values are the primes less than <code>n</code> and the keys are composite multiples of these primes. The loop invariant, roughly speaking, is that the dictionary values are the primes less than <code>n</code>, and the corresponding keys are the lowest multiples of these primes greater than or equal to <code>n</code>. It&#8217;s a lazy, recursion-free take of Eratosthenes&#8217; sieve.
</p>
<p>For the purposes of this article the important things about this program are:
</p>
<ul>
 <li>
     it generates an infinite series of numbers to standard output<a id="fn4link" href="#fn4"><sup>[4]</sup></a>, making it a good source for a shell pipeline
 </li>

 <li>
     by making it executable and adding the usual shebang incantation, we can invoke this Python program seamlessly from the shell.
 </li>
</ul>

<h3><a href="#toc7" name="tocpipe-connection" id="tocpipe-connection">Pipe Connection</a></h3>
<p>Recall the original puzzle:
</p>
<blockquote><p>Find the smallest number that can be expressed as the sum of 5, 17, 563, 641 consecutive prime numbers, and is itself a prime number.
</p>
</blockquote><p>First, let&#8217;s check the connections by solving a simpler problem which we can manually verify: to find prime numbers which are also the sum of 2 consecutive primes. As we noted before, this is the same as finding primes numbers which are the consecutive sums of 1 and 2 primes.
</p>
<p>In one shell window we create a couple of named pipes, <code>c.1</code> and <code>c.2</code>, which we&#8217;ll use to stream the consecutive sum series of 1 and 2 primes respectively. The results series comprises the duplicates when we merge these pipes.
</p>
<div class="typocode"><div class="codetitle">Shell 1</div>

<pre class="prettyprint">$ mkfifo c.{1,2}
$ sort -mn c.{1,2} | uniq -d

</pre>

</div>

<p>In another shell window, stream data into c.1 and c.2:
</p>
<div class="typocode"><div class="codetitle">Shell 2</div>

<pre class="prettyprint">$ for i in 1 2; do (primes | psum | sdiff $i &gt; c.$i) &amp; done

</pre>

</div>

<p>In the first window we see the single number <code>5</code>, which is the first and only prime number equal to the sum of two consecutive primes.
</p>
<p>Prime numbers equal to the sum of three consecutive primes are more interesting. In each shell window recall the previous commands and switch the 2s to 3s (a simple command history recall and edit, <code>^2^3^</code>, does the trick). The merged output now looks like this:
</p>
<div class="typocode">

<pre class="prettyprint">$ sort -mn c.1 c.3 | uniq -d
23
31
41
...

</pre>

</div>

<p>We can check the first few values:
</p>
<div class="typocode">

<pre class="prettyprint">23 = 5 + 7 + 11
31 = 7 + 11 + 13
41 = 11 + 13 + 17

</pre>

</div>

<p>At this point we&#8217;re confident enough to give the actual puzzle a try. Start up the solutions stream.
</p>
<div class="typocode">

<pre class="prettyprint">$ mkfifo c.{1,5,17,563,641}
$ sort -mn c.{1,5,17,563,641} | uniq -c | grep "5 "

</pre>

</div>

<p>Here, we use a standard <a href="/articles/shell-script-sets">shell script set intersection</a> recipe: <code>uniq -c</code> groups and counts repeated elements, and the <code>grep</code> pattern matches those numbers common to all five input streams.
</p>
<p>Now we can kick off the processes which will feed into the consecutive sum streams, which <code>sort</code> is waiting on.
</p>
<div class="typocode">

<pre class="prettyprint">$ for i in 1 5 17 563 641; do (primes | psum | sdiff $i &gt; c.$i) &amp; done

</pre>

</div>

<p>Sure enough, after about 15 seconds elapsed time<a id="fn5link" href="#fn5"><sup>[5]</sup></a>, out pops the result:
</p>
<div class="typocode">

<pre class="prettyprint">$ sort -mn c.{1,5,17,563,641} | uniq -c | grep "5 "
    5 7002221

</pre>

</div>

<p>15 seconds seems an eternity for arithmetic on a modern computer (you could start up a word processor in less time!), and you might be inclined to blame the overhead of all those processes, files, large numbers, etc. In fact it took around 6 seconds for the Python program simply to generate prime numbers up to 7002221, and my pure Python solution ran in 9 seconds.
</p>

<h3><a href="#toc8" name="tocportability" id="tocportability">Portability</a></h3>
<p>One of the most convenient things about Python is its portability. I don&#8217;t mean &#8220;portable so long as you conform to the language standard&#8221; or &#8220;portable if you stick to a subset of the language&#8221; &#8212; I mean that a Python program works whatever platform I use without me having to worry about it.
</p>
<p>Non-portability put me off the Unix shell when I first encountered it: there seemed too many details, too many platform differences &#8212; which shell are you using? which extensions? which implementation of the core utilities, etc, etc? Readily available and well-written documentation didn&#8217;t help much here: generally I want the shell to just do what I mean, which is why I switched so happily to Perl when I discovered it.
</p>
<p>Since then this situation has, for me, improved in many ways. Non-Unix platforms are declining as are the different flavours of Unix. Bash seems to have become the standard shell of choice and Cygwin gets better all the time. GNU coreutils predominate. As a consequence I&#8217;ve forgotten almost all the Perl I ever knew and am actively rediscovering the Unix shell.
</p>
<p>Writing this article, though, I was reminded of the platform dependent behaviour which used to discourage me. On a Linux platform close to hand I had to use <code>seq</code> instead of <code>jot</code>, and <code>awk</code> formatted large integers in a scientific form with a loss of precision.
</p>
<div class="typocode"><div class="codetitle">Loss of precision</div>

<pre class="prettyprint">$ echo '10000000001 0' | awk '{print $1 - $2}'
1e+10

</pre>

</div>

<p>On OS X the same command outputs 10000000001. I couldn&#8217;t tell you which implementation is more correct. The fix is to explicitly format these numbers as decimal integers, but the danger is that the shell silently swallows these discrepancies and you&#8217;ve got a portability problem you don&#8217;t even notice.
</p>
<div class="typocode"><div class="codetitle">Precision recovered</div>

<pre class="prettyprint">$ echo '10000000001 0' | awk '{printf "%d\n", $1 - $2}'
10000000001

</pre>

</div>


<h3><a href="#toc9" name="tocstream-merge" id="tocstream-merge">Stream Merge</a></h3>
<p>I mentioned <code>stream_merge()</code> at the start of this article, a general purpose function written by Raymond Hettinger which I originally found in the Python Cookbook. As with the prime number generator, you might imagine the merge algorithm to be recursively defined:
</p>
<ol>
 <li><p>to merge a pair of streams, take items from the first which are less than the head of the second, then swap;
</p>

 </li>

 <li><p>to merge N streams, merge the first stream with the merged (N-1) rest.
</p>

 </li>
</ol>
<p>Again the Python solution does it differently, this time using a heap as a priority queue of items from the input streams. It&#8217;s ingenious and efficient. Look how easy it is in Python to shunt functions and pairs in and out of queues.
</p>
<div class="typocode">

<pre class="prettyprint">from heapq import heapify, heappop, heapreplace

def stream_merge(*ss):
    '''Merge a collection of sorted streams.'''
    pqueue = []
    for i in map(iter, ss):
        try:
            pqueue.append((i.next(), i.next))
        except StopIteration:
            pass
    heapify(pqueue)
    while pqueue:
        val, it = pqueue[0]
        yield val
        try:
            heapreplace(pqueue, (it(), it))
        except StopIteration:
            heappop(pqueue)

</pre>

</div>

<p>A more sophisticated version of this code has made it into the Python standard library, where it goes by the name of <a href="http://docs.python.org/dev/library/heapq.html#heapq.merge">heapq.merge</a> (I wonder why it wasn&#8217;t filed in <a href="http://docs.python.org/lib/itertools-functions.html">itertools</a>?)
</p>

<h3><a href="#toc10" name="tocalternative-solutions" id="tocalternative-solutions">Alternative Solutions</a></h3>
<p>As usual Haskell wins the elegance award, so I&#8217;ll quote in full a solution built without resorting to cookbookery which produces the (correct!) answer in 20 seconds.
</p>
<div class="typocode">

<pre class="prettyprint">module Main where

import List

isPrime x = all (\i -&gt; 0/=x`mod`i) $ takeWhile (\i -&gt; i*i &lt;= x) primes

primes = 2:filter (\x -&gt; isPrime x) [3..]

cplist n = map (sum . take n) (tails primes)

meet (x:xs) (y:ys) | x &lt; y = meet xs (y:ys)
                   | y &lt; x = meet (x:xs) ys
                   | x == y =  x:meet xs ys

main = print $ head $ \
(primes `meet` cplist 5) `meet` (cplist 17 `meet` cplist 563) `meet` cplist 641

</pre>

</div>

<hr />

<p><a id="fn1" href="#fn1link">[1]</a> CPython, more precisely &#8212; I don&#8217;t think anything in the Python language itself prohibits tail recursion. Even using CPython, yet another <a href="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/496691">recipe</a> from the online Python Cookbook explores the idea of an <code>@tail_recursion</code> decorator.
</p>
<p><a id="fn2" href="#fn2link">[2]</a> <code>Tail</code> is more commonly used to yield a fixed number of lines from the end of the file: by prefixing the line count argument with a <code>+</code> sign, it skips lines from the head of the file. The GNU version of <code>head</code> can similarly be used with a <code>-</code> prefix to skip lines at the tail of a file. The notation is {compact,powerful,subtle,implementation dependent}.
</p>
<p><a id="fn3" href="#fn3link">[3]</a> <code>Sort -m</code> is a sort which doesn&#8217;t really sort &#8212; its inputs should already be sorted &#8212; rather like the <code>+n</code> option turning <code>tail</code> on its head.
</p>
<p><a id="fn4" href="#fn4link">[4]</a> The series is infinite in theory only: at time <code>n</code> the number of items in the <code>has_prime_factors</code> dictionary equals the number of primes less than <code>n</code>, and each key in this dictionary is larger than <code>n</code>. So resource use increases steadily as <code>n</code> increases.
</p>
<p><a id="fn5" href="#fn5link">[5]</a> I used a MacBook laptop used to run these scripts. 
</p>
<pre>
  Model Name:               MacBook
  Model Identifier:         MacBook1,1
  Processor Name:           Intel Core Duo
  Processor Speed:          2 GHz
  Number Of Processors:     1
  Total Number Of Cores:    2
  L2 Cache (per processor): 2 MB
  Memory:                   2 GB
  Bus Speed:                667 MHz
</pre>

</div>


<div class="atomentry" id="productivity">
<h2 class="title"><a href="/articles/productivity">Productivity++ != Better</a></h2>
<p class="meta"><abbr class="published" title="2016-07-14">2016-07-14</abbr> &bull; <a href="/tag/accu" rel="tag">ACCU</a> &bull; <a href="/articles/productivity#disqus_thread">Comments</a></p>
<p>When it comes to productivity there seems to be an assumption that it&#8217;s a good thing, and that more equals better. I&#8217;d like to question that. What matters is producing the right stuff, whatever that is, and if you&#8217;re not sure, producing less would be better.
</p>
<p>It can be hard to cancel work which is in progress or which has already been completed, even though, as software developers, version control can faithfully store and restore our work should we need it.
</p>
<p>More tests does not equal better either. An increasing unit test count would seem uncontroversial, but let&#8217;s not forget we&#8217;re aiming for coverage and completeness whilst avoiding redundancy.  Good unit tests and good design go hand in hand. Good unit tests avoid extended setup and good design reduces the need for combinatorial test suites. More system tests <strong>will</strong> slow down development, especially if they&#8217;re <a href="http://googletesting.blogspot.co.uk/2016/05/flaky-tests-at-google-and-how-we.html">flaky</a>.
</p>
<p>I went to a wonderful and detailed <a href="https://www.infoq.com/presentations/test-complexity">talk at ACCU 2014 by Wojciech Seliga</a>. He described his time as a development manager at Atlassian and the various steps taken to improve their CI builds: to speed them up and get them passing, that is. One particularly effective step was the daring elimination of an entire suite of fragile system tests. Late one evening, after a drink or two, a senior engineer just deleted them. Those tests haven&#8217;t failed since (!).
</p>
<p>I wonder how that engineer felt. Nervous maybe, a bit reckless perhaps. But productive? Can destruction be productive?
</p>
<p>On a similar note, one of the best changes made to the code base I work on has been to kill off unwanted configurations. We no longer support 32 bit builds: eliminating them has removed an entire class of integer conversion issues and slashed CI turnaround times. A reductive act, but one which allows us to produce more of what&#8217;s wanted.
</p>
<p>What is wanted though?
</p>
<p>The trouble is, if we&#8217;re not sure what to do, we like to do something, and we like to be seen to do something. We like to produce. We like to deliver. We don&#8217;t like to sit around in meetings talking about what to do. In these circumstances, though, production is questionable. More than once I have seen clean architecture crumble then decay, smothered by unwanted features.
</p>
<p>Project dashboards can add to the problem. Graphics showing who added the most lines of code are open to misinterpretation and gaming. Who had the best ideas? Who reduced, removed or simplified? Does your dashboard display these metrics?
</p>
<p>Remember, we are software developers, not software producers.
</p>

</div>


<div class="atomentry" id="go-steady-ready">
<h2 class="title"><a href="/articles/go-steady-ready">Go! Steady. Ready?</a></h2>
<p class="meta"><abbr class="published" title="2016-04-18">2016-04-18</abbr> &bull; <a href="/tag/go" rel="tag">Go</a>, <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/accu" rel="tag">ACCU</a> &bull; <a href="/articles/go-steady-ready#disqus_thread">Comments</a></p>
<p>I&#8217;m looking forward to <a href="http://accu.org/index.php/conferences/accu_conference_2016/accu2016_sessions#Go!_Steady._Ready?">talking about Go</a> at the <a href="http://accu.org/index.php/conferences/accu_conference_2016">ACCU 2016 Conference</a> this Friday. If you&#8217;d like to find out what connects an Easter egg with <a href="https://en.wikipedia.org/wiki/Eadweard_Muybridge#Stanford_and_horse_gaits">flying horses</a> and the runner in the green vest, then come along. Expect live coding, concurrent functions and answers.
</p>
<pre><code>&gt;&gt;&gt; import antigravity
</code></pre><p><a data-flickr-embed="true"  href="https://www.flickr.com/photos/thomasguest/25883297343/in/dateposted-friend/" title="muybridge-horse"><img src="https://farm2.staticflickr.com/1707/25883297343_356cc33871.jpg" width="500" height="310" alt="muybridge-horse"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script>
</p>
<p><a data-flickr-embed="true"  href="https://www.flickr.com/photos/thomasguest/17301552044/in/datetaken/" title="Tyntesfield 10k 2014"><img src="https://farm6.staticflickr.com/5449/17301552044_92e033c6d2_z.jpg" width="547" height="640" alt="Tyntesfield 10k 2014"></a><script async src="//embedr.flickr.com/assets/client-code.js" charset="utf-8"></script>
</p>

</div>


<div class="atomentry" id="8-queens-puzzle-cpp">
<h2 class="title"><a href="/articles/8-queens-puzzle-cpp">8 Queens Puzzle++</a></h2>
<p class="meta"><abbr class="published" title="2016-04-05">2016-04-05</abbr> &bull; <a href="/tag/puzzles" rel="tag">Puzzles</a>, <a href="/tag/c++" rel="tag">C++</a> &bull; <a href="/articles/8-queens-puzzle-cpp#disqus_thread">Comments</a></p>
<p><a href="/articles/8-queens-puzzle">Yesterday I wrote about</a> a Python solution to the 8 Queens puzzle.
</p>
<pre><code>n = 8
sqs = range(n)

Qs = (Q for Q in itertools.permutations(sqs)
      if n == len({Q[i]+i for i in sqs})
           == len({Q[i]-i for i in sqs}))
</code></pre><p>It&#8217;s possible to reproduce this strategy in C++:
</p>
<ul>
 <li>
     range(n) &#8594; <a href="http://en.cppreference.com/w/cpp/algorithm/iota">std::iota</a>
 </li>

 <li>
     itertools.permutations &#8594; <a href="/articles/next-permutation">std::next_permutation</a>
 </li>

 <li>
     set comprehension &#8594; set insertion
 </li>
</ul>
<script src="https://gist.github.com/wordaligned/c94649d6b37ec08a9bda16e53c43b888.js"></script>

<p>The <code>std::next_permutation</code> algorithm stands alone in the C++ standard library. Used here, it pairs well with the similarly uncommon <code>do ... while</code> loop. The solution depends on the vector <code>sqs</code> starting off in sorted order, and by the end of the loop the vector will have been returned to <a href="https://rosettacode.org/wiki/Sorting_algorithms/Permutation_sort">this state</a>.
</p>

</div>


<div class="atomentry" id="8-queens-puzzle">
<h2 class="title"><a href="/articles/8-queens-puzzle">8 Queens Puzzle</a></h2>
<p class="meta"><abbr class="published" title="2016-04-04">2016-04-04</abbr> &bull; <a href="/tag/puzzles" rel="tag">Puzzles</a>, <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/8-queens-puzzle#disqus_thread">Comments</a></p>
<p style="font-size:4em">&#9819;&#9819;&#9819;&#9819;&#9819;&#9819;&#9819;&#9819;</p>

<p>Here&#8217;s one of my favourite <a href="http://code.activestate.com/recipes/576647-eight-queens-six-lines">recipes, by Raymond Hettinger</a>, lightly adapted for Python 3.
</p>
<pre><code>from itertools import permutations

n = width_of_chessboard = 8
sqs = range(n)

Qs = (Q for Q in permutations(sqs)
      if n == len({Q[i]+i for i in sqs})
           == len({Q[i]-i for i in sqs}))
</code></pre><p>We start by assigning <code>sqs</code> to the range 0 through 7.
</p>
<pre><code>&gt;&gt;&gt; sqs = range(8)
&gt;&gt;&gt; list(sqs)
[0, 1, 2, 3, 4, 5, 6, 7]
</code></pre><p>The range has 8 indices. If each index represents a column on a standard 8x8 chessboard and the value at that index represents a row on the same chessboard, then our range represents 8 positions on the board. Using the built-in <a href="https://docs.python.org/3/library/functions.html#enumerate">enumerate</a> function to generate these <code>(index, value)</code> pairs we see that <code>sqs</code> encodes the diagonal <code>(0, 0)</code> to <code>(7, 7)</code>:
</p>
<pre><code>&gt;&gt;&gt; list(enumerate(sqs))
[(0, 0), (1, 1), (2, 2), (3, 3), (4, 4), (5, 5), (6, 6), (7, 7)]
</code></pre><p>Next, permute the values &#8212; the rows.
</p>
<pre><code>&gt;&gt;&gt; from itertools import permutations
&gt;&gt;&gt; rooks = permutations(sqs)
&gt;&gt;&gt; next(rooks)
(0, 1, 2, 3, 4, 5, 6, 7)
&gt;&gt;&gt; next(rooks)
(0, 1, 2, 3, 4, 5, 7, 6)
&gt;&gt;&gt; next(rooks)
(0, 1, 2, 3, 4, 6, 5, 7)
&gt;&gt;&gt; list(rooks)[34567]
(6, 7, 0, 1, 3, 4, 5, 2)
</code></pre><p><a href="https://docs.python.org/3/library/itertools.html#itertools.permutations">Itertools.permutations</a> generates values lazily. The snippet above shows the first two results, then skips forward 34568 places. <code>Permutations(sqs)</code> generates all possible arrangements of 8 pieces on a chessboard such that each row has exactly one piece on it and so does each column. That is, it generates all possible ways of placing 8 <a href="http://mathworld.wolfram.com/RooksProblem.html">rooks on a chessboard</a> so that no pair attacks each other.
</p>
<p>In the final program, we filter these rook positions to generate solutions to the more challenging &#8212; and more interesting &#8212; <a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle">eight Queens puzzle</a>.
</p>
<p>Consider our starting point, the diagonal <code>(0, 0)</code> to <code>(7, 7)</code>
</p>
<pre><code>&gt;&gt;&gt; diagonal = range(8)
&gt;&gt;&gt; {r-c for c,r in enumerate(diagonal)}
{0}
&gt;&gt;&gt; {r+c for c,r in enumerate(diagonal)}
{0, 2, 4, 6, 8, 10, 12, 14}
</code></pre><p>Here, a set comprehension collects the distinct values taken by the difference between the row and column along this diagonal, which in this case gives <code>{0}</code>. That is, if we placed 8 bishops along this &#x2197; diagonal they would all attack each other along this diagonal. The sum of the row and column takes 8 distinct values, however, meaning no pair attacks along a &#x2196; diagonal.
</p>
<p><a href="https://docs.python.org/3/reference/expressions.html#comparisons">Comparison operators chain in Python</a>, so the expression:
</p>
<pre><code>n == len({Q[i]+i for i in sqs}) == len({Q[i]-i for i in sqs})
</code></pre><p>is <code>True</code> if both sets have 8 elements, that is, if the squares in <code>Q</code> are on distinct &#x2196; and &#x2197; diagonals; or, equivalently no pair of bishops placed on the squares in <code>Q</code> would attack each other. Since we already know <code>Q</code> positions 8 rooks so that no pair attacks each other, and a chess Queen combines the moves of a rook and a bishop, we can see that <code>Qs</code> generates every possible way of placing 8 Queens on a chessboard so that no pair attacks each other: which is to say, we&#8217;ve solved the <a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle">8 Queens puzzle</a>.
</p>
<pre><code>Qs = (Q for Q in permutations(sqs)
      if n == len({Q[i]+i for i in sqs})
           == len({Q[i]-i for i in sqs}))
</code></pre><p>This is beautiful code and there&#8217;s one final twist.
</p>
<p><code>Qs</code> is a <a href="https://docs.python.org/3/reference/expressions.html#generator-expressions">generator expression</a> primed to permute squares into neighbourly rooks filtered by amicable bishops yielding unthreatening Queens. Until asked, however, it does nothing.
</p>
<p style="font-size:4em">&#9813;&#9813;&#9813;&#9813;&#9813;&#9813;&#9813;&#9813;</p>

</div>


<div class="atomentry" id="easy-as-py">
<h2 class="title"><a href="/articles/easy-as-py">Easy as Py</a></h2>
<p class="meta"><abbr class="published" title="2016-03-23">2016-03-23</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/c++" rel="tag">C++</a>, <a href="/tag/c" rel="tag">C</a> &bull; <a href="/articles/easy-as-py#disqus_thread">Comments</a></p>
<h2>What makes Python Simple?</h2>
<p>I consider Python a simple language. Here&#8217;s why.
</p>

<h2>Easy to Read</h2>
<p>I can read and understand Python code (unless it&#8217;s <a href="https://benkurtovic.com/2014/06/01/obfuscating-hello-world.html">wilfully perverse</a>). Syntactic whitespace and the associated removal of punctuation results in a regular, open layout. The combination of built in containers, extensive standard libraries and high level constructs allow for clear, compact code: code which fits in your head.
</p>

<h2>Easy to Write</h2>
<p>I can write Python code which is free of syntax errors and which does what I want. Of course it helps that I&#8217;ve been actively using the language for 15 years, but I&#8217;ve been using C++ for longer and still make mistakes with it: ask me to declare a pointer to a member function, for example, or to knock up a variadic template function, and I&#8217;ll need a moment or two.
</p>

<h2>Transparent</h2>
<p>I also consider C a simple language. C offers a transparent abstraction of a register machine, with a stack, a heap, and addressable memory. If you can imagine the operation of such a machine, you can figure out C. Python is less transparent but reveals its workings if pressed. Dicts form a part of the language seen by users, and under the hood they provide the dynamic context which supports a running program. The <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">read-eval-print loop</a> makes it easy to poke and reshape your program. You can <a href="https://docs.python.org/3/library/dis.html">disassemble code</a> to see what the virtual machine sees.
</p>

<h2>Consistent improvement</h2>
<p>The language has got better since I first started using it. It has also got bigger, and this growth would, at first, seem at odds with simplicity. However, consider &#8212; as an example &#8212; the point when list comprehensions were introduced. Language support for building a list from an iterable results in compact declarative code. Simple code. What&#8217;s more, the square brackets which now delimit list comprehensions are the same square brackets that were previously used to delimit lists. The syntax may have been new but it didn&#8217;t surprise. Now consider the introduction of set and dict comprehensions, which follow logically and naturally from list comprehensions, almost as if they were discovered rather than invented.
</p>
<p>There are many other examples where additions to the language have unified and simplified.
</p>

<h2>Vision</h2>
<p>I&#8217;m not a Python insider and cannot comment on the exact balance of benevolence and dictatorship which goes into the <a href="https://www.python.org/dev/peps/">language enhancement process</a>. I would say Python doesn&#8217;t suffer from being designed by a committee. It sticks to its strengths and its direction, to its vision.
</p>

</div>


<div class="extended">
<p><a href="/articles/">Visit the Word Aligned archives...</a></p>
</div>

      
<div id="comments"><script type="text/javascript">
//<![CDATA[
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
        if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
        }
    }
    document.write('<script type="text/javascript" src="http://disqus.com/forums/wordaligned/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script></div>

    </div>
    <div id="sidebar">
      <div class="sidebar-node">
<h3>Hello, World!</h3>
<p>Welcome to <a href="/">Word Aligned</a>, a collection of articles on software development and computer programming.</p>
<p>I&#8217;m <a href="http://tag.wordaligned.org">Thomas Guest</a>, an experienced and enthusiastic computer programmer who prefers <a href="/articles/pitching-python-in-three-syllables.html">high-level languages</a> and <a href="/articles/fixed-wheels-and-simple-designs.html">simple solutions</a>. My writing has been published in a number of online and print magazines as well as here at <a href="/">wordaligned.org</a>.</p>


</div>

<div class="sidebar-node">
<h3>Feeds</h3>

<ul>
<li><a href="http://feeds.wordaligned.org/wordaligned"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Articles</a></li>
<li><a href="http://feeds.wordaligned.org/wordaligned/comments"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Comments</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Top Tags</h3>
<ul id="categories"><li><a href="/tag/python" rel="tag">Python</a> <em>(120)</em></li>
<li><a href="/tag/c++" rel="tag">C++</a> <em>(71)</em></li>
<li><a href="/tag/self" rel="tag">Self</a> <em>(62)</em></li>
<li><a href="/tag/puzzles" rel="tag">Puzzles</a> <em>(35)</em></li>
<li><a href="/tag/accu" rel="tag">ACCU</a> <em>(33)</em></li>
<li><a href="/tag/web-applications" rel="tag">Web Applications</a> <em>(27)</em></li>
<li><a href="/tag/subversion" rel="tag">Subversion</a> <em>(27)</em></li>
<li><a href="/tag/algorithms" rel="tag">Algorithms</a> <em>(25)</em></li>
<li><a href="/tag/google" rel="tag">Google</a> <em>(19)</em></li>
<li><a href="/tag/characters" rel="tag">Characters</a> <em>(17)</em></li></ul>

</div>

<div class="sidebar-node">
<h3>All Tags</h3>
<p><a href="/tag/accidents" rel="tag">accidents</a>, <a href="/tag/accu" rel="tag">accu</a>, <a href="/tag/agile" rel="tag">agile</a>, <a href="/tag/algorithms" rel="tag">algorithms</a>, <a href="/tag/android" rel="tag">android</a>, <a href="/tag/apple" rel="tag">apple</a>, <a href="/tag/apple" rel="tag">apple</a>, <a href="/tag/arc" rel="tag">arc</a>, <a href="/tag/awk" rel="tag">awk</a>, <a href="/tag/books" rel="tag">books</a>, <a href="/tag/boost" rel="tag">boost</a>, <a href="/tag/bristol" rel="tag">bristol</a>, <a href="/tag/bugs" rel="tag">bugs</a>, <a href="/tag/build" rel="tag">build</a>, <a href="/tag/c" rel="tag">c</a>, <a href="/tag/c++" rel="tag">c++</a>, <a href="/tag/characters" rel="tag">characters</a>, <a href="/tag/charts" rel="tag">charts</a>, <a href="/tag/chess" rel="tag">chess</a>, <a href="/tag/clrs" rel="tag">clrs</a>, <a href="/tag/conferences" rel="tag">conferences</a>, <a href="/tag/content" rel="tag">content</a>, <a href="/tag/crabs" rel="tag">crabs</a>, <a href="/tag/curl" rel="tag">curl</a>, <a href="/tag/cvs" rel="tag">cvs</a>, <a href="/tag/cvs2svn" rel="tag">cvs2svn</a>, <a href="/tag/cycling" rel="tag">cycling</a>, <a href="/tag/decorators" rel="tag">decorators</a>, <a href="/tag/design" rel="tag">design</a>, <a href="/tag/disqus" rel="tag">disqus</a>, <a href="/tag/docbook" rel="tag">docbook</a>, <a href="/tag/documentation" rel="tag">documentation</a>, <a href="/tag/drawing" rel="tag">drawing</a>, <a href="/tag/dynamic-languages" rel="tag">dynamic-languages</a>, <a href="/tag/editors" rel="tag">editors</a>, <a href="/tag/emacs" rel="tag">emacs</a>, <a href="/tag/erlang" rel="tag">erlang</a>, <a href="/tag/esr" rel="tag">esr</a>, <a href="/tag/etc" rel="tag">etc</a>, <a href="/tag/europython" rel="tag">europython</a>, <a href="/tag/fractals" rel="tag">fractals</a>, <a href="/tag/functional-programming" rel="tag">functional-programming</a>, <a href="/tag/github" rel="tag">github</a>, <a href="/tag/go" rel="tag">go</a>, <a href="/tag/google" rel="tag">google</a>, <a href="/tag/graphics" rel="tag">graphics</a>, <a href="/tag/haskell" rel="tag">haskell</a>, <a href="/tag/hoare" rel="tag">hoare</a>, <a href="/tag/ide" rel="tag">ide</a>, <a href="/tag/imagemagick" rel="tag">imagemagick</a>, <a href="/tag/iphone" rel="tag">iphone</a>, <a href="/tag/java" rel="tag">java</a>, <a href="/tag/knuth" rel="tag">knuth</a>, <a href="/tag/lcs" rel="tag">lcs</a>, <a href="/tag/lighttpd" rel="tag">lighttpd</a>, <a href="/tag/lisp" rel="tag">lisp</a>, <a href="/tag/markdown" rel="tag">markdown</a>, <a href="/tag/missiles" rel="tag">missiles</a>, <a href="/tag/ocr" rel="tag">ocr</a>, <a href="/tag/openid" rel="tag">openid</a>, <a href="/tag/oulipo" rel="tag">oulipo</a>, <a href="/tag/perec" rel="tag">perec</a>, <a href="/tag/perl" rel="tag">perl</a>, <a href="/tag/php" rel="tag">php</a>, <a href="/tag/pi" rel="tag">pi</a>, <a href="/tag/pictures" rel="tag">pictures</a>, <a href="/tag/pil" rel="tag">pil</a>, <a href="/tag/primes" rel="tag">primes</a>, <a href="/tag/puzzles" rel="tag">puzzles</a>, <a href="/tag/python" rel="tag">python</a>, <a href="/tag/recommended" rel="tag">recommended</a>, <a href="/tag/recursion" rel="tag">recursion</a>, <a href="/tag/regex" rel="tag">regex</a>, <a href="/tag/reviews" rel="tag">reviews</a>, <a href="/tag/ruby" rel="tag">ruby</a>, <a href="/tag/ruby-on-rails" rel="tag">ruby-on-rails</a>, <a href="/tag/scheme" rel="tag">scheme</a>, <a href="/tag/scrum" rel="tag">scrum</a>, <a href="/tag/self" rel="tag">self</a>, <a href="/tag/self" rel="tag">self</a>, <a href="/tag/shell" rel="tag">shell</a>, <a href="/tag/sicp" rel="tag">sicp</a>, <a href="/tag/spolsky" rel="tag">spolsky</a>, <a href="/tag/steganography" rel="tag">steganography</a>, <a href="/tag/streams" rel="tag">streams</a>, <a href="/tag/subversion" rel="tag">subversion</a>, <a href="/tag/syntax" rel="tag">syntax</a>, <a href="/tag/talks" rel="tag">talks</a>, <a href="/tag/teamwork" rel="tag">teamwork</a>, <a href="/tag/tesseract" rel="tag">tesseract</a>, <a href="/tag/tests" rel="tag">tests</a>, <a href="/tag/tests" rel="tag">tests</a>, <a href="/tag/torvalds" rel="tag">torvalds</a>, <a href="/tag/trac" rel="tag">trac</a>, <a href="/tag/turing" rel="tag">turing</a>, <a href="/tag/two-wheels" rel="tag">two-wheels</a>, <a href="/tag/unicode" rel="tag">unicode</a>, <a href="/tag/unix" rel="tag">unix</a>, <a href="/tag/virtualization" rel="tag">virtualization</a>, <a href="/tag/web-applications" rel="tag">web-applications</a>, <a href="/tag/webapplications" rel="tag">webapplications</a>, <a href="/tag/windows" rel="tag">windows</a>, <a href="/tag/zlib" rel="tag">zlib</a></p>

</div>

<div class="sidebar-node">
<h3>Articles</h3>
<ul>
<li><a href="/articles/">Ordered by date</a></li>
<li><a href="/articles/alphabetical-order/">Alphabetical order</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Chain</h3>
<ul>
<li><a accesskey="p" href="/articles/lazy-sequences-working-hard" title="First article">&raquo; Lazy sequences working hard</a></li>

</ul>


</div>

    </div>
  </div>
  <div id="footer">
<hr />
<p><a href="http://tag.wordaligned.org">Thomas Guest</a></p>
</div>

</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3373724-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>
</body>

</html>
