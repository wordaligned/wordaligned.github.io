<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="icon" href="/images/favicon.png" type="image/png"/>
<link href="/styles/application.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/scripts/prettify.js"></script>
<script type="text/javascript" src="/scripts/lang-lisp.js"></script>
<script type="text/javascript" src="http://www.haloscan.com/load/wordaligned"></script>

<title>Word Aligned</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="author" content="Thomas Guest" />
<meta name="description" content="A collection of articles on software development written by Thomas Guest." />
<meta name="keywords" content="Recursion, Content, Swansea, Agile, php, Arc, lighttpd, Oulipo, Steganography, Curl, cvs2svn, Europython, Bristol, Zlib, Virtualization, Scrum, Two Wheels, Android, Cycling, Pictures, Esr, Recommended, Windows, Pi, Perec, Functional Programming, Etc, Teamwork, Documentation, Unicode, Awk, Accidents, Hoare, SICP, Haskell, Puzzles, Knuth, CLRS, Java, Lisp, CVS, Build, Tesseract, Drawing, Design, Iphone, Decorators, Trac, openid, Books, Missiles, ImageMagick, Graphics, Google, Perl, Disqus, Charts, Dynamic Languages, Boost, Ruby, Apple, Bugs, Markdown, Streams, OCR, C++, Reviews, Crabs, Scheme, Shell, Animation, Primes, Syntax, IDE, Javascript, Emacs, ACCU, Self, Lcs, Tests, Ruby on Rails, Github, PIL, DocBook, Talks, Chess, Web Applications, Conferences, Editors, Subversion, Erlang, Python, Fractals, Characters, Web-applications, Turing, Algorithms, Go, Regex, C, Unix, Spolsky, Torvalds" />
<link rel="alternate" type="application/rss+xml" title="Feed" href="http://feeds.wordaligned.org/wordaligned" />
</head>

<body onload="prettyPrint()">
<div id="container">
  <div id="header">
<h1><span><a accesskey="h" href="/">Word Aligned</a></span></h1>
<h2>tales from the code face</h2>
<a class="button" href="http://feeds.wordaligned.org/wordaligned" title="Subscribe to Word Aligned"><img style="float: right;" src="/images/feed.png" alt="Feed Logo" height="28" width="28"/></a>
</div>

  <div id="page">
    <div id="content">
      <div class="atomentry" id="priority-queues-in-python">
<h2 class="title"><a href="/articles/priority-queues-in-python">Priority queues in Python</a></h2>
<p class="meta"><abbr class="published" title="2022-02-25">2022-02-25</abbr> &bull; <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/priority-queues-in-python#disqus_thread">Comments</a></p>
<p>In the previous article I noted that Python&#8217;s
<a href="https://docs.python.org/3/library/heapq.html">heapq</a> module is the
only part of standard Python I could think of which deals with sorting,
but which doesn&#8217;t give you full control over the sort order.</p>
<p>That means you need to take care when using a heapq as a priority queue.</p>
<p>For example, the <a href="https://en.wikipedia.org/wiki/A*_search_algorithm">A* search
algorithm</a> is a
<strong>best first</strong> path finder. It maintains a priority queue of possible
steps to take, ordered by an estimate of the total distance of the
path routed through these steps. At each stage it pops the next step
&#8212; the one with the shortest estimated total distance &#8212; from the queue,
then updates based on the new position.</p>
<div class="typocode">

<pre class="prettyprint">import heapq

def a_star(start, heuristic, moves):
    """A* graph search

    - start: initial state
    - heuristic(s): estimates path length from state s to finish. 
                    heuristic(s) == 0 =&gt; finished
    - moves(s): neighbours of s

    Returns the shortest path to the finish and its cost, on success.
    None otherwise.
    """
    costs = {start: 0}
    prev = {start: None}
    frontier = [(heuristic(start), start)]
    heapq.heapify(frontier)

    def path(s):
        return [] if s is None else path(prev[s]) + [s]

    while frontier:
        priority, state = heapq.heappop(frontier)
        if heuristic(state) == 0:
            return costs[state], path(state)
        for n in moves(state):
            n_cost = costs[state] + 1
            if n not in costs or n_cost &lt; costs[n]:
                costs[n] = n_cost
                heapq.heappush(frontier, (n_cost + heuristic(n), n))
                prev[n] = state

</pre>

</div>

<p>The code above is a Python A* implementation. For simplicity, we&#8217;ll
assume the cost of each step is 1. It&#8217;s easy enough to adapt the function
if this isn&#8217;t the case.</p>
<p>The priority queue here is named <code>frontier</code>, the collection of states
we need to explore. The sequence <code>heapify</code>, <code>heappop</code>, <code>heappush</code>
maintains the priority ordering. (The call to <code>heapify</code> isn&#8217;t even
needed since a list with one element is already a heap.)  So, each
time we pop a state from the queue, we get the one with the lowest
estimated cost. Then, based on the moves we can make from this new
step, we update our internal records of costs and previous nodes.</p>
<p>Note that the items on the queue are <code>(cost, state)</code> pairs. The costs
will be numbers, typically positive integers &#8212; the exact values depend
on the heuristic function.</p>
<p>Exactly what gets used as <code>state</code> is up to the caller
which supplies <code>start</code>, the initial state, and <code>moves</code>, which steps
from a state to its neighbours.</p>
<p>However, if items on the queue are tied on <code>cost</code>, the heapq may need to
compare <code>state</code> values. If the states have no defined ordering
this results in a runtime error.</p>
<pre><code>&gt;&gt;&gt; class State: pass
... 
&gt;&gt;&gt; x1, x2 = State(), State()
&gt;&gt;&gt; (1, x1) &lt; (2, x2)
True
&gt;&gt;&gt; (1, x1) &lt; (1, x2)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: '&lt;' not supported between instances of 'State' and 'State'
</code></pre>
<p>We cannot supply a sort key to the <code>heapq</code> functions. Does this mean
clients must ensure state objects &#8212; whatever they actually are &#8212; can be
compared? As the code stands, yes, but the <a href="https://docs.python.org/3/library/heapq.html#priority-queue-implementation-notes">module documentation</a> has advice on handling this situatation:</p>
<blockquote>
<p>[&#8230;] store entries as 3-element list including the priority, an
entry count, and the task. The entry count serves as a tie-breaker
so that two tasks with the same priority are returned in the order
they were added. And since no two entry counts are the same, the
tuple comparison will never attempt to directly compare two tasks.</p>
</blockquote>
<p>This strategy gives a more usable <code>a_star</code>.</p>
<div class="typocode">

<pre class="prettyprint">import heapq
import itertools

def a_star(start, heuristic, moves):
    costs = {start: 0}
    prev = {start: None}
    seq = itertools.count().__next__
    frontier = [(heuristic(start), seq(), start)]

    def path(s):
        return [] if s is None else path(prev[s]) + [s]

    while frontier:
        _, _, state = heapq.heappop(frontier)
        if heuristic(state) == 0:
            return costs[state], path(state)
        for n in moves(state):
            n_cost = costs[state] + 1
            if n not in costs or n_cost &lt; costs[n]:
                costs[n] = n_cost
                heapq.heappush(frontier, (n_cost + heuristic(n), seq(), n))
                prev[n] = state

</pre>

</div>

</div>


<div class="atomentry" id="binary-search-gets-a-sort-key">
<h2 class="title"><a href="/articles/binary-search-gets-a-sort-key">Binary search gets a sort key</a></h2>
<p class="meta"><abbr class="published" title="2022-02-15">2022-02-15</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/puzzles" rel="tag">Puzzles</a> &bull; <a href="/articles/binary-search-gets-a-sort-key#disqus_thread">Comments</a></p>
<p>Suppose you have an list of distinct elements which has been sorted
and rotated. How would you look up an element within that list?</p>
<p>For example, the list:</p>
<pre><code>[7, 11, 13, 19, 2, 3, 5]
</code></pre>
<p>is sorted (the first 7 primes, in order) and rotated (to put 7 first).</p>
<p>With this list as input, then:</p>
<ul>
<li>look up <code>13</code> returns <code>2</code> since <code>13</code> is at index <code>2</code></li>
<li>look up <code>2</code> returns <code>4</code></li>
<li>look up <code>4</code> returns the sentinel value <code>-1</code></li>
</ul>
<p>The obvious technique is to just search the list:</p>
<pre><code>def lookup(values, v):
    try:
        return values.index(v)
    except IndexError:
        return -1
</code></pre>
<p>This is a linear algorithm which processes the entire list. Is there a way
to take advantage of its sorted+rotated-ness?</p>
<p>If the list <strong>was</strong> sorted then we could apply a binary search for a
logarithmic lookup. And in fact, by applying a custom ordering, the
list <strong>is</strong> sorted.</p>
<p>How can we apply a custom ordering in Python?</p>
<p>The way to do this has changed as Python has developed. The table below shows
the evolution of standard Python functions which sort and compare.</p>
<table>
<thead>
<tr>
<th>Version</th>
<th>Year</th>
<th>Functions</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.0</td>
<td>2000</td>
<td>max, min, list.sort(<a href="http://docs.python.org/3.0/whatsnew/3.0.html#ordering-comparisons">cmp</a>), bisect.bisect</td>
<td>Note that <a href="http://docs.python.org/3.0/whatsnew/3.0.html#ordering-comparisons">cmp</a> slows the sorting process down considerably</td>
</tr>
<tr>
<td>2.3</td>
<td>2003</td>
<td>heapq</td>
<td>Also known as the priority queue algorithm</td>
</tr>
<tr>
<td>2.4</td>
<td>2004</td>
<td>sorted(iterable[, cmp[, key[, reverse]]]), list.sort([cmp[, key[, reverse]]]), itertools.groupby(iterable[, key)</td>
<td>In general, the key and reverse conversion processes are much faster than specifying an equivalent cmp function</td>
</tr>
<tr>
<td>2.4</td>
<td>2004</td>
<td>heapq.nlargest, heapq.nsmallest</td>
<td>Heapq extended</td>
</tr>
<tr>
<td>2.5</td>
<td>2006</td>
<td>max([key]), min([key]), heapq.nlargest(&#8230;[, key]), heapq.smallest(&#8230;[, key])</td>
<td></td>
</tr>
<tr>
<td>2.6</td>
<td>2008</td>
<td>heapq.merge</td>
<td>Heapq extended again</td>
</tr>
<tr>
<td>3.0</td>
<td>2008</td>
<td>sorted(iterable, key[, reverse]), list.sort(key[, reverse])</td>
<td>No more <code>cmp</code></td>
</tr>
<tr>
<td>3.5</td>
<td>2015</td>
<td>heapq.merge(&#8230;, key)</td>
<td></td>
</tr>
<tr>
<td>3.10</td>
<td>2021</td>
<td>bisect.bisect(&#8230;, key) etc</td>
<td>That leaves the low-level <code>heapq</code> functions</td>
</tr>
</tbody>
</table>
<p>The earliest versions of Python allowed you to sort lists, and
the sort was customised using a <code>cmp</code> function &#8212; though the documentation
warned there would be a performance penalty[*]. The builtin <code>min</code> and <code>max</code>
functions could not be cutomised, and nor could the comparison used in
the <code>bisect</code> module &#8212; which is Python&#8217;s binary search implementation.</p>
<p>At 2.3 the <code>heapq</code> module appeared, but, like <code>bisect</code>, there was no way
to customise the ordering of heap elements.</p>
<p>2.4 introduced the <code>key</code> argument to customise ordering,
noting this should be preferred to <code>cmp</code>. Unlike <code>cmp</code> which compares two
elements, <code>key</code> takes a single element and returns a sort rank for that element.
The <code>key</code> argument was added alongside <code>cmp</code> in <code>list.sort</code> and the new <code>sorted</code>
builtin function; and <code>key</code> was the only way to customise the grouping in
<code>itertools.groupby</code>.</p>
<p>2.5 added <code>key</code> to <code>min</code> and <code>max</code>, and also to <code>heapq.nlargest</code>, <code>heapq.nsmallest</code>.
Although these <code>heapq</code> functions now accept a <code>key</code>, the lower level heap functions
to heapify, push, pop and replace do not.</p>
<p>2.6 introduced <code>heapq.merge</code>, a handy function to merge sorted inputs
using a heap, but with no option to specify a sort key.</p>
<p>3.0 got rid of <code>cmp</code>, making <code>key</code> the only way to customise
sorting. To migrate from Python 2 to 3 any <code>cmp</code> functions need
converting to <code>key</code> functions. As with Python 2.5, at 3.0 you could
apply a key to <code>list.sort</code>, <code>sorted</code>, <code>min</code>, <code>max</code>,
<code>itertools.groupby</code>, <code>heapq.nlargest</code>, <code>heapq.nsmallest</code> &#8212; but not to
<code>bisect</code> or other <code>heapq</code> functions.</p>
<p>3.5 added <code>key</code> to <code>heapq.merge</code>, aligning it with <code>heapq.nlargest</code>
and <code>heapq.nsmallest</code>, though it remained impossible to use a sort key
with the lower level heap functions.</p>
<p>The next change came in 3.10, when the <code>key</code> parameter was
added to the <code>bisect</code> module. As far as I can tell that means the only part of
standard Python which doesn&#8217;t let you fully customise ordering is the <code>heapq</code> module.</p>
<h2 id="bisect-with-a-search-key">Bisect with a search key</h2>
<p>So, to return to the original puzzle, consider our example
sorted+rotated list:</p>
<pre><code>&gt;&gt;&gt; values = [7, 11, 13, 19, 2, 3, 5]
</code></pre>
<p>The first four elements are greater than or equal to the first
element, 7. The last three elements are less than 7.</p>
<pre><code>&gt;&gt;&gt; [v &lt; values[0] for v in values]
[False, False, False, False, True, True, True]
</code></pre>
<p>Since <code>False</code> &lt; <code>True</code> the result of the list comprehension above is sorted.
Extending this idea, the following comprehension is also sorted.</p>
<pre><code>&gt;&gt;&gt; [(v &lt; values[0], v) for v in values]
[(False, 7), (False, 11), (False, 13), (False, 19), (True, 2), (True, 3), (True, 5)]
</code></pre>
<p>Now we have a logarithmic lookup using binary search:</p>
<pre><code>from bisect import bisect_left

def lookup(values, v):
    key = lambda x: (x &lt; values[0], x)
    i = bisect_left(values, key(v), key=key)
    return i if (i &lt; len(values) and values[i] == v) else -1
</code></pre>
<h2 id="dont-search-for-v-search-for-its-key">Don&#8217;t search for v, search for its key</h2>
<p>I was surprised to realise the value <code>v</code> being looked up has to have the <code>key</code>
function applied <strong>before</strong> calling <code>bisect_left</code>. That is, to find where <code>v</code>
should go in <code>values</code> to maintain the sort order, we pass <code>key(v)</code> to <code>bisect_left</code>.
This doesn&#8217;t match the interface to binary search in other languages. It also means
in our example we have to handle empty lists as a special case.</p>
<pre><code>def lookup(values, v):
    if not values: return -1
    key = lambda x: (x &lt; values[0], x)
    i = bisect_left(values, key(v), key=key)
    return i if (i &lt; len(values) and values[i] == v) else -1
</code></pre>
<p>[*] Before the introduction of the sort <code>key</code>, the standard pattern was
<a href="https://docs.python.org/3/howto/sorting.html#the-old-way-using-decorate-sort-undecorate">decorate-sort-undecorate</a>.</p>

</div>


<div class="atomentry" id="on-exactitude-in-programming">
<h2 class="title"><a href="/articles/on-exactitude-in-programming">On Exactitude in Programming</a></h2>
<p class="meta"><abbr class="published" title="2021-01-05">2021-01-05</abbr> &bull; <a href="/tag/design" rel="tag">Design</a> &bull; <a href="/articles/on-exactitude-in-programming#disqus_thread">Comments</a></p>
<p>Recently I attended a demonstration of a product intended to help design software, right down to implementation details. It failed to convince me. It did, however, succeed in reminding me of this short work by Jorge Luis Borges:</p>
<blockquote><h3>On Exactitude in Science</h3>
<p>Jorge Luis Borges, Collected Fictions, translated by Andrew Hurley.
<p>&#8230;In that Empire, the Art of Cartography attained such Perfection that the map of a single Province occupied the entirety of a City, and the map of the Empire, the entirety of a Province. In time, those Unconscionable Maps no longer satisfied, and the Cartographers Guilds struck a Map of the Empire whose size was that of the Empire, and which coincided point for point with it. The following Generations, who were not so fond of the Study of Cartography as their Forebears had been, saw that that vast Map was Useless, and not without some Pitilessness was it, that they delivered it up to the Inclemencies of Sun and Winters. In the Deserts of the West, still today, there are Tattered Ruins of that Map, inhabited by Animals and Beggars; in all the Land there is no other Relic of the Disciplines of Geography.
<p>&#8212;Suarez Miranda, Viajes devarones prudentes, Libro IV,Cap. XLV, Lerida, 1658
</blockquote>

<p>and also of this tweet by <a href="https://twitter.com/KevlinHenney">@KevlinHenney</a>:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">The act of describing a program in unambiguous detail and the act of programming are one and the same.</p>&mdash; Kevlin Henney (@KevlinHenney) <a href="https://twitter.com/KevlinHenney/status/3361631527?ref_src=twsrc%5Etfw">August 17, 2009</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</div>


<div class="atomentry" id="python-maths-updates">
<h2 class="title"><a href="/articles/python-maths-updates">Python maths updates</a></h2>
<p class="meta"><abbr class="published" title="2021-01-03">2021-01-03</abbr> &bull; <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/python-maths-updates#disqus_thread">Comments</a></p>
<p>A quick note on some useful updates made to standard Python maths support. <a href="https://docs.python.org/3/library/math.html#math.prod">Math.prod</a> does for <code>*</code> what <a href="https://docs.python.org/3/library/functions.html#sum">sum</a> does for <code>+</code>. It was added at Python 3.8.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; math.prod([3, 4, 5])
60
&gt;&gt;&gt; math.prod([])
1

</pre>

</div>

<p>Added in 3.9, <a href="https://docs.python.org/3/library/math.html#math.lcm">math.lcm</a>, returns the least common multiple of its integer arguments. As with <a href="https://docs.python.org/3/library/math.html#math.prod">math.prod</a>, an empty list of arguments returns 1. Extended in 3.9, the related function <a href="https://docs.python.org/3/library/math.html#math.gcd">math.gcd</a> now accepts an arbitrary list of arguments.</p>
<p>For Euclidean geometry, <a href="https://docs.python.org/3/library/math.html#math.hypot">math.hypot</a> now supports n-dimensional points, and <a href="https://docs.python.org/3/library/math.html#math.dist">math.dist</a> has been added, again working on any pair of n-dimensional points.</p>
<p>These useful additions and extensions are all in the standard math module (along with several others not mentioned here). Previously you&#8217;d have to roll your own or rely on e.g. <a href="https://numpy.org/">numpy</a>.</p>
<p>I also wanted to mention a nice extension to the power function; in this case to the builtin <a href="https://docs.python.org/3/library/functions.html#pow">pow</a> &#8212; <a href="https://docs.python.org/3/library/math.html#math.pow">math.pow</a> remains as it was. Builtin <a href="https://docs.python.org/3/library/functions.html#pow">pow</a> takes an optional third parameter <code>pow(base, exp[, mod])</code>. If <code>mod</code> is specified it must be a non-zero integer, and both <code>base</code> and <code>exp</code> must also be integers. The significant but subtle change made at 3.8 is that <code>exp</code> can now be a negative integer, enabling modular inverse calculations. </p>
<p>Quoting the <a href="https://docs.python.org/3/library/functions.html#pow">documentation</a>:</p>
<blockquote><p>&#8230; If <i>mod</i> is present and <i>exp</i> is negative, <i>base</i> must be relatively prime to <i>mod</i>. In that case, <i>pow(inv_base, -exp, mod)</i> is returned, where inv_base is an inverse to base modulo mod.</p><p>Here&#8217;s an example of computing an inverse for 38 modulo 97:</p><code><pre>>>> pow(38, -1, mod=97)
23
>>> 23 * 38 % 97 == 1
True
</pre></code></blockquote>

</div>


<div class="atomentry" id="fearless-debugging">
<h2 class="title"><a href="/articles/fearless-debugging">Fearless Debugging</a></h2>
<p class="meta"><abbr class="published" title="2021-01-02">2021-01-02</abbr> &bull; <a href="/tag/puzzles" rel="tag">Puzzles</a> &bull; <a href="/articles/fearless-debugging#disqus_thread">Comments</a></p>
<h2 id="jurassic-jigsaw">Jurassic Jigsaw</h2>
<p>My thanks to <a href="http://was.tl">Eric Wastl</a> for another excellent <a href="https://adventofcode.com/">Advent of Code</a>. I&#8217;ve now <a href="https://github.com/wordaligned/advent-of-code-2020">worked through all 25 puzzles</a>, some simple, some tough, some familiar, some new; all beautifully set and highly enjoyable.</p>
<p><a href="https://adventofcode.com/2020/day/20">Day 20, Jurrasic Jigsaw</a>, took me longest by far to complete. The puzzle is easy to understand. You have to assemble jigsaw pieces into a seascape. For part one, you need to find the corner pieces. For part two, you must locate monsters in the seascape.</p>
<p>Here, a jigsaw piece is a monochrome square, represented like so:</p>
<pre><code>..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###
</code></pre>
<p>And this is the sea monster:</p>
<pre><code>                   # 
#    ##    ##    ###
 #  #  #  #  #  #
</code></pre>
<p>The twist was that the jigsaw pieces could be rotated and flipped over before matching them up. Once matched, the edges of the pieces were to be removed. Implementing the rotate, flip, match and remove code proved fiddly, and I was pleased to get this working and producing correct results for the supplied example.</p>
<p>Unfortunately my code produced the wrong answer for part two, the bit where you have to locate sea monsters. So, I would need to debug.</p>
<h2 id="fear-of-debugging">Fear of Debugging</h2>
<p>Like it or not, debugging is a key part of software development.</p>
<p>Generally, I do like it. There&#8217;s satisfaction to be had in paring scope, retracing steps, then making the right fix, improving test coverage, and generally leaving the world a better place.</p>
<p>What I don&#8217;t like, though &#8212; what scares me &#8212; is the suspicion the bug lurks in the worst possible place. What if it&#8217;s in a library we don&#8217;t have the source for? Or if it&#8217;s a timing issue caused by some erratic locking? Or if there&#8217;s an issue with the compiler for the most obscure platform. Or, in this particular case, that the code to fiddle with jigsaw pieces has a bug &#8212; a bug subtle enough to pass the examples but fail the real thing.</p>
<p>It&#8217;s not unreasonable to fear the worst. At some point the issues mentioned above <strong>will</strong> cause bugs, bugs which <strong>are</strong> hard to fix. We need to be ready.</p>
<p>Fear, though, is the wrong mindset. Debugging requires you to be calm, methodical and detached. Much as an artist draws what they see and not what they know, a programmer must observe and follow the evidence. A second pair of eyes is always useful; simply explaining the issue to a colleague gives you another perspective.</p>
<h2 id="here-be-monsters">Here be Monsters</h2>
<p>I was working on my own on the Advent of Code. I could have tried explaining to a <a href="https://en.wikipedia.org/wiki/Rubber_duck_debugging">rubber duck</a>, but didn&#8217;t. Instead I examined and traced my code. I checked and double-checked the flip, rotate, match and remove logic. I printed out intermediate state. I walked to the sea-front and back. I slept on it.</p>
<p>Fearing the worst turned out to be the wrong strategy.</p>
<p>What did work was reading the problem statement again, carefully. At last I saw it! Somehow, a rogue character had wormed its way into my inputs. The sea monster I had used looked like this:</p>
<pre><code>                   #
#    ##    ##    ###
 #  #  #  #  #  #
</code></pre>
<p>when it should have been:</p>
<pre><code>                  # 
#    ##    ##    ###
 #  #  #  #  #  #
</code></pre>
<p>Since both monsters appear the same number of times in the example seascape, my test case failed to catch the bug.</p>
<p>So, with a single, simple, whitespace correction, my advent of code was complete. One of life&#8217;s ironies is that when you lose something you find it in the last place you look. It&#8217;s not always so with debugging: a bug can exist in many different places and sometimes the fix causes the codebase to unravel, requiring a chain of additional fixes, but, in this case, finding the bug fixed it.</p>
<p><image src="/images/seascape.png" alt="Seascape with monsters" /></p>
<p>A monster can exist in many different places, and in this case finding the monster fixed it</p>

</div>


<div class="atomentry" id="complex-numbers-for-planar-geometry">
<h2 class="title"><a href="/articles/complex-numbers-for-planar-geometry">Complex numbers for planar geometry</a></h2>
<p class="meta"><abbr class="published" title="2020-12-12">2020-12-12</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/puzzles" rel="tag">Puzzles</a> &bull; <a href="/articles/complex-numbers-for-planar-geometry#disqus_thread">Comments</a></p>
<p>Once again, I&#8217;m enjoying solving <a href="http://was.tl">Eric Wastl</a>&#8217;s excellent <a href="https://adventofcode.com">Advent of Code</a> puzzles.</p>
<p>Today, <a href="day12">day 12</a> involved a ship navigating in a 2D plane. The ship follows a series of instructions taking the form of actions and values such as <code>F10 N3 F7 R90 F11 ...</code>, where, for the first part:</p>
<ul>
<li>actions N, S, E, W step by the value in the compass directions N, S, E, W</li>
<li>actions L, R turn the ship left and right by the number of degrees specified by the value</li>
<li>action F advances the ship in the direction it faces by the given value</li>
</ul>
<p>Perhaps the most obvious way to model this is by implementing a <code>Point</code> class, with <code>x</code> and <code>y</code> values, and suitable methods to advance and rotate.</p>
<p>Another way is to use complex numbers, which are natively supported by Python &#8212; and many other languages. The complex plane <em>is</em> a 2D plane. The point <code>(x, y)</code> is represented by a single complex number <code>p = x + y * j</code>. Stepping in any direction corresponds to addition, and rotation to multiplication.</p>
<p>So, the instructions <code>N, S, E, W</code> map to adding complex numbers <code>j, -j, 1, -1</code>.</p>
<p>Quarter turns left and right map to multiplication by <code>j</code> and <code>-j</code>.</p>
<div class="typocode">

<pre class="prettyprint">def ship_position(instructions):
    &#x27;&#x27;&#x27;Return the final position of the ship after following the instructions

    Instructions are a series of (action, value) pairs.
    &#x27;&#x27;&#x27;
    ship, direction = 0, 1 # Start at the origin facing E
    step = {&#x27;N&#x27;:1j, &#x27;W&#x27;:-1, &#x27;S&#x27;:-1j, &#x27;E&#x27;: 1}
    turn = {&#x27;R&#x27;:-1j, &#x27;L&#x27;:1j}
    for action, value in instructions:
        if action in &#x27;NSEW&#x27;:
            ship += value * step[action]
        elif action in &#x27;LR&#x27;:
            assert value % 90 == 0 # check rectilinear motion
            direction *= turn[action] ** (value//90)
        else:
            assert action == &#x27;F&#x27;
            ship += value * direction
    return ship

</pre>

</div>

<p>It&#8217;s also possible to implement the conditionals above arithmetically. We can think of each instruction advancing the ship (possibly by zero) and turning it (possibly by zero degrees).</p>
<div class="typocode">

<pre class="prettyprint">def ship_position(instructions):
    ship, direction = 0, 1
    step = {&#x27;N&#x27;:1j, &#x27;W&#x27;:-1, &#x27;S&#x27;:-1j, &#x27;E&#x27;: 1}
    turn = {&#x27;R&#x27;:-1j, &#x27;L&#x27;:1j}
    for action, value in instructions:
        ship += value * (step.get(action, 0) + (action==&#x27;F&#x27;) * direction)
        direction *= turn.get(action, 1) ** (value//90)
    return ship

</pre>

</div>

<p>More solutions <a href="https://github.com/wordaligned/advent-of-code-2020">here</a>, and thanks again to Eric Wastl.</p>

</div>


<div class="atomentry" id="cryptic-message">
<h2 class="title"><a href="/articles/cryptic-message">Cryptic Message</a></h2>
<p class="meta"><abbr class="published" title="2019-06-08">2019-06-08</abbr> &bull; <a href="/tag/puzzles" rel="tag">Puzzles</a> &bull; <a href="/articles/cryptic-message#disqus_thread">Comments</a></p>
<p>Anyone able to help make sense of this bizarre tweet which appeared on my timeline?</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">The challenge is to decipher the message</p>&mdash; Thomas Guest (@thomasguest) <a href="https://twitter.com/thomasguest/status/1137215876271415297?ref_src=twsrc%5Etfw">June 8, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Please answer using the same style so others can find their own solution. Bonus points for both quality and quantity.</p>
<div><img src="/images/laboratory.jpg" alt="Laboratory" title="Searching for clues" /></div>

</div>


<div class="atomentry" id="dr-gs-award-winning-puzzles">
<h2 class="title"><a href="/articles/dr-gs-award-winning-puzzles">Dr G&#8217;s Award Winning Puzzles</a></h2>
<p class="meta"><abbr class="published" title="2019-04-09">2019-04-09</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/puzzles" rel="tag">Puzzles</a> &bull; <a href="/articles/dr-gs-award-winning-puzzles#disqus_thread">Comments</a></p>
<p>A colleague of mine shares my love of puzzles. Whilst I like solving them, he also likes to design and build them. What I hadn&#8217;t realised is that there&#8217;s a community of puzzlers out there, who hold conventions, share designs, and generally celebrate and advance the art of puzzling.</p>
<p>Dr G &#8212; my colleague &#8212; is part of that community and also owns a 3D printer. He works from home but whenever he visits the office there&#8217;ll be a freshly-printed puzzle for us to play with. I feel as excited as a young hobbit when Gandalf visits the Shire.</p>
<p>The best puzzles have just a few simple pieces. You can see how the parts must finally align but the geometry conspires to confound. There <em>will</em> be a sequence of twists and turns. There <em>must</em> be.</p>
<p><img src="/images/casino-unpacked.jpg" alt="Casino"/></p>
<p>Casino, designed by Dr Volker Latussek, is both mould breaking and an instant classic. You have to slot 6 identical casino chips into a cubic box. The lip which makes the opening to the box rectangular rather than square is the single asymmetry which makes this task almost impossible rather than utterly trivial.</p>
<p>I fiddled with it, rolling the chips into position, sliding and shunting. After many minutes of manipulation I put it down, the chips loosely arranged in and on top of the box. After a lunch break I picked it up, and to my amazement the chips slid easily and directly into place.</p>
<p><img src="/images/casino-solved.jpg" alt="Casino"/></p>
<p><img src="/images/packtic-unpacked.jpg" alt="PackTIC"/></p>
<p>PackTIC, designed by Andrew Crowell is a very different puzzle. The TIC stands for Turning Interlocking Cube. A bit like a 3D version of Tetris, you have to manipulate a 5 very different cubilinear pieces so they fuse into an irregular chassis. I took this one on the train with me. At the end of the journey I had figured out how the pieces would fit, but not how to assemble them. The following morning, as with the Casino puzzle, everything just clicked into place.</p>
<p><img src="/images/packtic-solved.jpg" alt="PackTIC"/></p>

</div>


<div class="atomentry" id="aligning-the-first-line-of-a-triplequoted-string-in-python">
<h2 class="title"><a href="/articles/aligning-the-first-line-of-a-triplequoted-string-in-python">Aligning the first line of a triple-quoted string in Python</a></h2>
<p class="meta"><abbr class="published" title="2019-02-17">2019-02-17</abbr> &bull; <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/aligning-the-first-line-of-a-triplequoted-string-in-python#disqus_thread">Comments</a></p>
<p>Python&#8217;s triple-quoted strings are a convenient syntax for strings where the contents span multiple lines. Unescaped newlines are allowed in triple-quoted strings. So, rather than write:</p>
<pre><code>song = ("Happy birthday to you\n"
        "Happy birthday to you\n"
        "Happy birthday dear Gail\n"
        "Happy birthday to you\n")
</code></pre>
<p>you can write:</p>
<pre><code>song = """Happy birthday to you
Happy birthday to you
Happy birthday dear Gail
Happy birthday to you
"""
</code></pre>
<p>The only downside here is that the first line doesn&#8217;t align nicely with the lines which follow. The way around this is to embed a <code>\newline</code> escape sequence, meaning both <a href="https://docs.python.org/3/reference/lexical_analysis.html#string-and-bytes-literals" title="String and Bytes literals">backslash and newline are ignored</a>.</p>
<pre><code>song = """\
Happy birthday to you
Happy birthday to you
Happy birthday dear Gail
Happy birthday to you
"""
</code></pre>

</div>


<div class="atomentry" id="python-counters-pydiff">
<h2 class="title"><a href="/articles/python-counters-pydiff">Python Counters @PyDiff</a></h2>
<p class="meta"><abbr class="published" title="2019-01-19">2019-01-19</abbr> &bull; <a href="/tag/talks" rel="tag">Talks</a>, <a href="/tag/python" rel="tag">Python</a> &bull; <a href="/articles/python-counters-pydiff#disqus_thread">Comments</a></p>
<p>On Monday I gave a talk at <a href="http://www.pydiff.wales/">PyDiff</a> on the subject of Python Counters. A Counter is a specialised <code>dict</code> which has much in common with a <code>set</code>. Of course all dicts are like sets, but with Counters the resemblance is even stronger. The <a href="https://docs.python.org/3/library/collections.html#collections.Counter">documentation</a> states:</p>
<blockquote>
<p>The Counter class is similar to bags or multisets in other languages.</p>
</blockquote>
<p>Alongside set operations of union, intersection and is-a-subset, Counter also supports addition and subtraction &#8212; natural and unsurprising operations for a container whose job is to keep count of its elements. If you want to unite the contents of two Counters, it&#8217;s probably <code>+</code> you want rather than <code>|</code>.</p>
<p>Counters came to mind as a lightning talk subject since I had a go at the <a href="https://adventofcode.com/2018" title="25 Christmas themed puzzles made available one-per-day as a countdown to Christmas">Advent of Code</a> last year and used no fewer than 12 Counters in my <a href="https://github.com/wordaligned/advent-of-code-2018/blob/master/solutions.ipynb">solutions</a> to 25 puzzles &#8212; and that total could well increase since I haven&#8217;t finished yet.</p>
<p>The talk itself is on <a href="https://github.com/wordaligned/python-counters">github</a>.</p>
<p><a href="https://github.com/wordaligned/python-counters"><img alt="Coins" src="/images/coins.jpg"></a></p>

</div>


<div class="atomentry" id="metaphormers">
<h2 class="title"><a href="/articles/metaphormers">Metaphormers</a></h2>
<p class="meta"><abbr class="published" title="2018-05-30">2018-05-30</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/talks" rel="tag">Talks</a> &bull; <a href="/articles/metaphormers#disqus_thread">Comments</a></p>
<p><img src="/images/glyphicons/glyphicons-553-firework.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-23-fire.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-242-flash.png" alt="icon"/></p>
<p>A metaphor is a figure of speech where you describe something in terms of something else. For example, when Katy Perry sings &#8220;Baby, you&#8217;re a firework&#8221; she doesn&#8217;t mean you&#8217;re an explosive for use on bonfire night &#8212; she&#8217;s saying you&#8217;ve got a spark inside you, you should &#8220;ignite the light&#8221;, &#8220;show &#8216;em what you&#8217;re worth&#8221;, &#8220;shoot across the sky&#8221; and &#8220;make &#8216;em go, Oh, oh, oh!&#8221;.</p>
<p>You&#8217;re spectacular &#8212; a <strong>firework</strong>.</p>
<p>This post considers some metaphors for computer programming. I hope we can gain some insights into what we do by looking at it from a different angle. In other words: what are we like?</p>
<p><img src="/images/glyphicons/glyphicons-236-pen.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-108-text-resize.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-111-align-left.png" alt="icon"/></p>
<p>We <strong>write</strong> software. That&#8217;s not a metaphor though. It&#8217;s <strong>literally</strong> what we do. We write, edit, review and publish texts. In scrum teams we even work on <strong>stories</strong>. It&#8217;s not particularly helpful.</p>
<p>It&#8217;s not unhelpful either, unlike the next couple of examples, for which I blame recruitment agents.</p>
<p><img src="/images/glyphicons/glyphicons-592-person-running.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-18-music.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-49-star-empty.png" alt="icon"/></p>
<p>An advert for a programming <strong>ninja</strong> isn&#8217;t meant to attract a Japanese mercenary trained in espionage and assassination, must have 2 years PHP experience &#8212; it&#8217;s meant to make a dull job sound exciting. Similarly a <strong>rockstar</strong> is unwelcome on most software teams. Creativity and even attitude may be useful. Not so the rampant ego and <a href="http://www.thisisinsider.com/van-halen-brown-m-ms-contract-2016-9">trantrums</a>.</p>
<p><img src="/images/glyphicons/glyphicons-313-rugby.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-330-soccer-ball.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-463-basketball.png" alt="icon"/></p>
<p>How about <strong>sports</strong>? We&#8217;re <strong>agile</strong>. We work in <strong>teams</strong> on <strong>sprints</strong> scoring (story) <strong>points</strong>. In our <strong>scrum</strong> meetings we discuss <strong>tactics</strong>.</p>
<p><img src="/images/glyphicons/glyphicons-273-cake.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-274-drink.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-276-fast-food.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-278-pizza.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-277-cutlery.png" alt="icon"/></p>
<p>Is coding like <strong>cooking</strong>? We assemble the right <strong>ingredients</strong> and follow tried and trusted <strong>recipes</strong>. Our products are <strong>consumed</strong> and adjusted to <strong>taste</strong> based on feedback.</p>
<p><img src="/images/glyphicons/glyphicons-263-spade.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-311-flower.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-22-snowflake.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-232-sun.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-2-leaf.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-71-umbrella.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-361-bug.png" alt="icon"/></p>
<p>Software grows organically. Tending to a codebase is a form of <strong>gardening</strong> &#8212; we nurture new features and allow them to <strong>blossom</strong>, all the while <strong>pruning</strong> dead code and trying to keep <strong>bugs</strong> under control. Release cycles are seasonal. Success depends on both weather and climate.</p>
<p><img src="/images/glyphicons/glyphicons-535-lab-alt.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-235-brush.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-599-scissors-alt.png" alt="icon"/></p>
<p>If Computer <strong>Science</strong> is the discipline, <a href="https://en.wikipedia.org/wiki/The_Art_of_Computer_Programming">The <strong>Art</strong> of Computer Programming</a>, supplies the detail, and the practice is often described as a <strong>Craft</strong>. There&#8217;s a progression, <a href="https://en.wikipedia.org/wiki/The_Pragmatic_Programmer">from journeyman to master</a>, during which we learn the <strong>tools</strong> of our <strong>trade</strong>. Although end users may never see the elegant code which underpins the interface they use, we take pride in our work and like to think they can sense our attention to detail.</p>
<p><img src="/images/glyphicons/glyphicons-21-home.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-69-ruler.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-377-hand-saw.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-375-claw-hammer.png" alt="icon"/></p>
<p>The most popular metaphor is <a href="https://en.wikipedia.org/wiki/Code_Complete"><strong>construction</strong></a>. It&#8217;s there in our job titles: <strong>Architect</strong>, <strong>Project Manager</strong>, <strong>Engineer</strong>. We plan, assemble, build, test, deliver. Unfortunately this metaphor fails to recognise the supple, fluid nature of software &#8212; its <strong>softness</strong>.</p>
<p>If you&#8217;re building a house you start with foundations and then the walls go up, at which point it becomes impossible to change the foundations. If you&#8217;re building software, you could start with the wiring and then put the roof on. There&#8217;s nothing stopping you swapping the foundations at any point: running on another platform, or switching the memory manager, for example, is no more difficult than changing the user interface styling.</p>
<p>Or consider a software service, supported by a collaboration of microservices which are continually developed, reconfigured, replaced. That&#8217;s not construction. It&#8217;s communication.</p>
<p><img src="/images/glyphicons/glyphicons-371-globe-af.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-51-link.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-33-wifi-alt.png" alt="icon"/>
<img src="/images/glyphicons/glyphicons-552-podcast.png" alt="icon"/></p>
<p>Communication is the metaphor I&#8217;m going to champion. Code <strong>communicates</strong>, via compiler or <strong>interpreter</strong>, with the platform. It communicates with us via editor and browser. We use text, pictures, speech, gestures. We share rooms, screens, thoughts. We listen to our users. We engage with our community.</p>
<p>At the start of this post I dismissed &#8220;writing&#8221; as too literal. Beyond the literal and beneath the words, it&#8217;s evident we&#8217;re in the <strong>language</strong> business: not just programming languages, but also the dialect of our APIs and modules, the metaphors which describe and define our designs. Design patterns are simply shared metaphor &#8212; factory, visitor, facade &#8212; and a codebase communicates by shaping and extending its own local metaphors.</p>
<p>Software is the development of metaphor. We are <strong>metaphormers</strong>.</p>
<p>As Katy Perry would say: Oh, oh, oh!</p>
<p style="text-align:center">&sect;</p>

<p>The icons used on this page were downloaded from <a href="http://glyphicons.com">http://glyphicons.com</a> and are licensed under the <a href=http://creativecommons.org/licenses/by/3.0/deed.en>CC BY 3.0</a> terms.</p>

</div>


<div class="atomentry" id="dict-of-lists">
<h2 class="title"><a href="/articles/dict-of-lists">Creating a dict of lists in Python</a></h2>
<p class="meta"><abbr class="published" title="2018-04-29">2018-04-29</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/streams" rel="tag">Streams</a> &bull; <a href="/articles/dict-of-lists#disqus_thread">Comments</a></p>
<p>Suppose you have a list of objects which you want to convert into a dict mapping from some object key to the (sub-)list of objects with that key. To provide a simple example, let&#8217;s start with a list of fruits.</p>
<div class="typocode">

<pre class="prettyprint">from collections import namedtuple

Fruit = namedtuple(&#x27;Fruit&#x27;, &#x27;name colour&#x27;)

def banana():     return Fruit(&#x27;banana&#x27;, &#x27;yellow&#x27;)
def grape():      return Fruit(&#x27;grape&#x27;, &#x27;green&#x27;)
def pear():       return Fruit(&#x27;pear&#x27;, &#x27;green&#x27;)
def strawberry(): return Fruit(&#x27;strawberry&#x27;, &#x27;red&#x27;)
def cherry():     return Fruit(&#x27;cherry&#x27;, &#x27;red&#x27;)

fruits = [
    banana(), pear(), cherry(), cherry(), pear(),
    grape(), banana(), grape(), cherry(), grape(),
    strawberry(), pear(), grape(), cherry()]

</pre>

</div>

<p>We&#8217;d like to arrange a fruitbowl &#8212; a dict which groups fruits by colour. This can be done by creating an empty bowl, then iterating through the fruits placing each in the correct list.</p>
<div class="typocode">

<pre class="prettyprint">fruitbowl = {}

for fruit in fruits:
    fruitbowl.setdefault(fruit.colour, []).append(fruit)

</pre>

</div>

<p><code>Dict.setdefault</code> is a bit of an oddity in Python, both doing something and returning a value, but it&#8217;s a convenient shorthand in this case. Despite this convenience it&#8217;s more common to use a <code>defaultdict</code>.</p>
<div class="typocode">

<pre class="prettyprint">from collections import defaultdict

fruitbowl = defaultdict(list)

for fruit in fruits:
    fruitbowl[fruit.colour].append(fruit)

</pre>

</div>

<p>Here&#8217;s a function to display the fruitbowl.</p>
<div class="typocode">

<pre class="prettyprint">def print_bowl(bowl):
    print(&#x27;\n&#x27;.join(
        &#x27;{}: {}&#x27;.format(colour,
                        &#x27;, &#x27;.join(f.name for f in fruits))
        for colour, fruits in bowl.items()))

</pre>

</div>

<p>If we call this function, we see the fruits have indeed been grouped by colour.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; print_bowl(fruitbowl)
yellow: banana, banana
green: pear, pear, grape, grape, grape, pear, grape
red: cherry, cherry, cherry, strawberry, cherry

</pre>

</div>

<p>This is all fine and idiomatic Python, but whenever I see an empty dict being created followed by a loop to populate it, I wonder if a comprehension could be used.</p>
<p>Is there a way to declare and initialise the dict in a single expression? Here&#8217;s the best I came up with.</p>
<div class="typocode">

<pre class="prettyprint">from operator import attrgetter
from itertools import groupby

colour = attrgetter(&#x27;colour&#x27;)

fruitbowl = {
    col: list(fts)
    for col, fts in groupby(sorted(fruits, key=colour), colour)}

</pre>

</div>

<p>Is this better than the <code>defaultdict</code> solution. Probably not, but it&#8217;s a technique worth remembering. Maybe the <code>fruitbowl</code> isn&#8217;t needed, and we actually just need to iterate through the fruits grouped by colour. For example, which colour is most popular?</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; max(fruitbowl.items(), key=lambda kv: len(kv[1]))[0]
&#x27;green&#x27;

</pre>

</div>

<p>Using <code>groupby</code>, we don&#8217;t need the bowl.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; def grouplen(k_gp):
...     return sum(1 for _ in k_gp[1])
&gt;&gt;&gt; max(groupby(sorted(fruits, key=colour), colour), key=grouplen)[0]
&gt;&gt;&gt; &#x27;green&#x27;

</pre>

</div>

<p>In this case, we don&#8217;t need <code>groupby</code> either. <a href="./timtowtdi-vs-tsboapooowtdi">There is more than one way to do it</a>.</p>
<div class="typocode">

<pre class="prettyprint">&gt;&gt;&gt; from collections import Counter
&gt;&gt;&gt; Counter(map(colour, fruits)).most_common(1)
[(&#x27;green&#x27;, 7)]

</pre>

</div>

</div>


<div class="atomentry" id="timtowtdi-vs-tsboapooowtdi">
<h2 class="title"><a href="/articles/timtowtdi-vs-tsboapooowtdi">TIMTOWTDI vs TSBO-APOO-OWTDI</a></h2>
<p class="meta"><abbr class="published" title="2018-04-19">2018-04-19</abbr> &bull; <a href="/tag/python" rel="tag">Python</a>, <a href="/tag/perl" rel="tag">Perl</a> &bull; <a href="/articles/timtowtdi-vs-tsboapooowtdi#disqus_thread">Comments</a></p>
<h2 id="timtowtdi">TIMTOWTDI</h2>
<p>TIMTOWTDI stands for &#8220;There is more than one way to do it&#8221;, an approach promoted by the Perl community.</p>
<p>The mindset behind it gets explored in more detail by the language&#8217;s creator, Larry Wall, in a talk given in 1999: <a href="https://www.perl.com/pub/1999/03/pm.html/">&#8220;Perl, the first postmodern computer language&#8221;</a>. He attributes the slogan to his daughter, Heidi, who says it&#8217;s a strategy which works well in her maths class; and <strong>she</strong> associates it with another saying used at school: &#8220;Tsall Good&#8221;. This doesn&#8217;t mean everything is good, or even everything has good bits. It means, overall, things are good. See the big picture.</p>
<p>Perl epitomises this. It&#8217;s eclectic and inclusive, supporting a variety of styles. One-liner? Fine! Like a shell script? Sure! Structured programming, object-oriented, functional? Why not! Tsall good.</p>
<p>I like that.</p>
<p>But do I feel that way about programming?</p>
<h2 id="tsbo-apoo-owtdi">TSBO-APOO-OWTDI</h2>
<p>A contrasting mantra appears in the <a href="https://www.python.org/dev/peps/pep-0020/">Zen of Python</a>, a list of aphorisms which summarise the guiding principles behind Python&#8217;s design. Item number 13 states &#8220;There should be one &#8212; and preferably only one &#8212; obvious way to do it.&#8221;</p>
<p>Perhaps realising this sounds overly prescriptive, this rule is tempered by item 14, &#8220;Although that way may not be obvious at first unless you&#8217;re Dutch.&#8221;</p>
<p>Guido van Rossum, Python&#8217;s BDFL &#8212; Benevolent Dictator For Life &#8212; would be the Dutch person who finds things obvious. That&#8217;s right: <strong>Dictator</strong>. Programmers don&#8217;t like being told what to do any more than two year olds. How then has Python become so popular? </p>
<p>Maybe emphasis falls on <strong>should</strong>. There <strong>should</strong> be only one obvious way to do it: it&#8217;s just that &#8212; Dutch or otherwise &#8212; we haven&#8217;t got there yet.</p>
<h2 id="timtop">TIMTOP</h2>
<p>For example, there is more than one Python. Obviously there&#8217;s Python 2 and Python 3, but it&#8217;s less obvious which to use. Don&#8217;t forget <a href="https://pypy.org/">PyPy</a>. Increasingly Python comes packaged with data processing and visualisation extensions, served up as a <a href="http://jupyter.org/">Jupyter</a> notebook.</p>
<h2 id="timtopom">TIMTOPOM</h2>
<p>There is more than one program options module.</p>
<p>When I started with Python there was <a href="https://docs.python.org/3/library/getopt.html">getopt</a>, the one and only command line handler. Coming from a C/C++ background I was quite happy to use something resembling GNU&#8217;s getopt. Then <a href="https://docs.python.org/3/library/optparse.html">optparse</a> appeared. Now there&#8217;s <a href="https://docs.python.org/3/library/argparse.html">argparse</a>. All of these libraries are readily available. Which should I use? Not optparse, that&#8217;s deprecated, unless I&#8217;m already using it and it works, that is. Regarding the other contenders, the <a href="https://docs.python.org/3/library/getopt.html">documentation</a> archly notes:</p>
<blockquote>
<p>Users who are unfamiliar with the C <a href="http://man7.org/linux/man-pages/man3/getopt.3.html"><code>getopt()</code></a> function or who would like to write less code and get better help and error messages should consider using the <a href="https://docs.python.org/3/library/argparse.html#module-argparse">argparse module</a> instead.</p>
</blockquote>
<p>There are other non-standard Python options for parsing a command line too: ones which <a href="http://docopt.org/">generate code from the usage</a> notes, or by <a href="https://github.com/google/python-fire">inspecting the code you want to expose</a>.</p>
<p>There is more than one way to do it.</p>
<h2 id="timtoutf">TIMTOUTF</h2>
<p>There is more than one unit test framework. The obvious one, <a href="https://docs.python.org/3/library/unittest.html">unittest</a>, like getopt, draws inspiration from elsewhere &#8212; in this case Java&#8217;s Junit. Unfortunately the port is too faithful, and you&#8217;ll have to inherit from super classes etc to test something. I much prefer <a href="https://docs.pytest.org">PyTest</a>, which flexes the language itself to deliver test assertions as <code>assert</code>s.</p>
<p>There&#8217;s also a <a href="https://docs.python.org/3/library/doctest.html">doctest</a> module in the standard library which executes and checks code found in strings (hold that thought!), and there are many other non-standard testing frameworks.</p>
<p>There is more than one way to do it.</p>
<h2 id="timtowofs">TIMTOWOFS</h2>
<p>There is more than one way of formatting strings.</p>
<p>As we&#8217;ve seen there&#8217;s more than one Python, and libraries are always up for reinvention. This is arguably evolution rather than a multiplicity of options. That is, the most recent way to do it should be preferred.</p>
<p>When it comes to string formatting, though, there has <strong>always</strong> been more than one way to do it, and more ways are still being added.</p>
<p>Do you use <code>'single'</code> or <code>"double"</code> quotes for a string? <code>"""Triple"""</code> quotes. Raw strings? Raw with an <code>r</code> or Raw with an <code>R</code>? TIMTOWTDI.</p>
<p>What if you want to embed the value of a variable in a string? Users familiar with C&#8217;s <code>printf()</code> function might prefer <code>%</code> formatting. Fans of $shell $parameter $expansion can use <a href="https://docs.python.org/3/library/string.html#template-strings">template strings</a>.</p>
<p><a href="https://www.python.org/dev/peps/pep-3101/">Advanced string formatting</a> &#8212; <code>str.format</code> &#8212; appeared in Python 3.0, backported to Python 2.6. No doubt it has advantages over <code>%</code> formatting, but for me it&#8217;s a little more obscure and a little less obvious. Python 3.6 introduces <a href="https://www.python.org/dev/peps/pep-0498/">f-strings</a> which build on <code>str.format</code> and knock down my reservations. The syntax allows you to evaluate expressions in strings: evidently Python is heading in Perl&#8217;s direction.</p>
<h2 id="apsdotadiw">APSDOTADIW</h2>
<p>Let&#8217;s finish by returning to Perl, and to <a href="https://www.perl.com/pub/1999/03/pm.html/">Larry Wall&#8217;s 1999 talk</a>. </p>
<blockquote>
<p>How many times have we heard the mantra that a program should do one thing and do it well?</p>
</blockquote>
<p>Perl is not that program. Perl wants to do everything well. It integrates features and makes no attempt to homogenise them.</p>
<blockquote>
<p>You&#8217;ve all heard the saying: If all you have is a hammer, everything starts to look like a nail.</p>
</blockquote>
<p>Perl is no hammer: it has memorably been described as a Swiss army chainsaw, but Larry Wall likens it to a more conventional tool.</p>
<blockquote>
<p>If all you have is duct tape, everything starts to look like a duct. Right. When&#8217;s the last time you used duct tape on a duct?</p>
</blockquote>
<p>Python may aspire to offer a single obvious way to do something. It fails splendidly, being more duct tape than hammer.</p>
<hr />
<p>I presented this blog post as a <a href="https://www.meetup.com/PyDiff/events/249220768">lightning talk at PyDiff</a> a couple of days ago. The <a href="/docs/timtowtdi">slides are here</a>. The talk was recorded too: <a href="https://cardiff.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=324c4015-51ed-4bd7-a1c7-a8c50089e746">I appear about 24 minutes in</a>.</p>

</div>


<div class="atomentry" id="ddd-wales-2018">
<h2 class="title"><a href="/articles/ddd-wales-2018">DDD Wales, 2018</a></h2>
<p class="meta"><abbr class="published" title="2018-03-25">2018-03-25</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/swansea" rel="tag">Swansea</a> &bull; <a href="/articles/ddd-wales-2018#disqus_thread">Comments</a></p>
<p>The first ever <a href="https://www.dddwales.com/">DDD Wales</a> was held yesterday at <a href="https://swansea.techhub.com/">TechHub Swansea</a>. It was a free-to-attend one day event comprising 5 full one hour sessions split into 3 parallel tracks; that makes 15 sessions to choose from. Additionally, there were lightning talks in the lunch break.</p>
<div><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Wow what a day! Time for some rest! Thank you again to all our amazing sponsors, exhibitors, Speakers, attendees and venue. <br><br>See you next year <a href="https://twitter.com/hashtag/DDDWales?src=hash&amp;ref_src=twsrc%5Etfw">#DDDWales</a></p>&mdash; DDD Wales (@dddcymru) <a href="https://twitter.com/dddcymru/status/977684471750316032?ref_src=twsrc%5Etfw">March 24, 2018</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div>

<p>I enjoyed <a href="https://twitter.com/kevinrjones">Kevin Jones</a>&#8217; introduction to Kotlin, the more so since it was almost entirely coded live. Kevin ably demonstrated Kotlin to be &#8220;Java without the ceremony&#8221;. I could see connections with other modern compiled languages &#8212; Swift for example &#8212; languages which aren&#8217;t feature-shy, but which aim for a light, clean syntax; languages which build on existing systems and libraries. It was interesting to see his use of the JetBrains IDE as a teaching aid, and indeed to pick up on audience thoughts on the use of IDEs to flesh out code.</p>
<p><a href="https://twitter.com/ChrisCundill">Chris Cundill&#8217;s</a> talk on <a href="http://releaseflow.org/#about">&#8220;release flow&#8221;</a> was another highlight. You may not have heard of release flow but you&#8217;ll know what it is: a tried and tested strategy for code branching. Chris used his talk to challenge and call out some more recent alternatives &#8212; Gitflow being the prime target. The session got me thinking. One dimension Chris didn&#8217;t cover was people: personalities, roles and permissions. Who can merge to which branch? Which developers work in private then push bulk updates? Git has won the version control system battle. The fight has moved into surrounding areas: branching, merging, reviewing, continuous integration, and the competition is bringing improvements in tooling and best practice.</p>
<p>The final talk I attended was <a href="https://twitter.com/davidcarboni">David Carboni&#8217;s</a> session on creating a minimal Docker container to run a microservice written in <a href="https://golang.org/">Go</a>. David started off by explaining why simplicity matters. I agree. I couldn&#8217;t agree more. The rest of the session was, again, live coding, replaying a <a href="https://github.com/davidcarboni/ddd">demo</a> which uses the techniques described in <a href="https://blog.codeship.com/building-minimal-docker-containers-for-go-applications/">a couple</a> of <a href="http://devcenter.wercker.com/docs/quickstarts/advanced/building-minimal-containers-with-go">blog posts</a> to whittle a Docker container down from a base size of ~700MB to a <a href="https://docs.docker.com/develop/develop-images/baseimages/">scratch</a> size ~7MB.</p>
<p>All in all, a great day. The split-level <a href="https://swansea.techhub.com/">venue</a> suited the three track conference well. The speakers delivered terrific sessions which the audiences engaged with. I&#8217;d like to thank the organisers, sponsors, speakers, and other attendees.</p>

</div>


<div class="atomentry" id="perec-igniteswansea-3">
<h2 class="title"><a href="/articles/perec-igniteswansea-3">Perec @IgniteSwansea #3</a></h2>
<p class="meta"><abbr class="published" title="2018-02-03">2018-02-03</abbr> &bull; <a href="/tag/self" rel="tag">Self</a>, <a href="/tag/perec" rel="tag">Perec</a>, <a href="/tag/talks" rel="tag">Talks</a>, <a href="/tag/oulipo" rel="tag">Oulipo</a> &bull; <a href="/articles/perec-igniteswansea-3#disqus_thread">Comments</a></p>
<p><img src="/docs/ignite/perec/me-at-ignite.jpg" alt="Puzzle"/></p>
<p>At <a href="http://www.igniteswansea.co.uk/">Ignite Swansea #3</a> I spoke about Georges Perec&#8217;s masterpiece, Life A User&#8217;s Manual. </p>
<p>Perec was &#8212; and indeed still is &#8212; a member of OuLiPo, a Parisian literary group interested in exploring the effects of applying mathematical patterns to text. His work seemed an appropriate subject for a presentation constrained to fit the ignite formula:</p>
<blockquote>
<p>20 slides &times; 15 seconds = 5 minutes</p>
</blockquote>
<p>It&#8217;s material I&#8217;ve spoken about <a href="/tags/perec">before</a> but <a href="/docs/ignite/perec/">the slides are new</a>. The talk was <a href="https://youtu.be/-y7YOKIa6yQ">recorded</a>. I enjoyed attempting <a href="https://en.wikipedia.org/wiki/Just_a_Minute">just-a-minute</a> &times; 5, though on the night I could have sworn I was subject to a cruel powerpoint bug which sped up the playback.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-y7YOKIa6yQ?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<p>OuLiPo fans might like to see if they can find the clinamen. The moustache is what happens in the fourth week of <a href="https://uk.movember.com/">Movember</a>. My thanks to all <a href="http://www.igniteswansea.co.uk/">@IgniteSwansea</a> and <a href="https://www.cinemaco.co.uk/">Cinema &amp; Co</a> for putting on such a great evening.</p>

</div>


<div class="extended">
<p><a href="/articles/">Visit the Word Aligned archives...</a></p>
</div>

      
<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://wordaligned.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<script id="dsq-count-scr" src="//wordaligned.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
    <div id="sidebar">
      <div class="sidebar-node">
<h3>Hello, World!</h3>
<p>Welcome to <a href="/">Word Aligned</a>, a collection of articles on software development and computer programming.</p>
<p>I&#8217;m <a href="http://tag.wordaligned.org">Thomas Guest</a>, an experienced and enthusiastic computer programmer who prefers <a href="/articles/pitching-python-in-three-syllables.html">high-level languages</a> and <a href="/articles/fixed-wheels-and-simple-designs.html">simple solutions</a>. My writing has been published in a number of online and print magazines as well as here at <a href="/">wordaligned.org</a>.</p>


</div>

<div class="sidebar-node">
<h3>Feeds</h3>

<ul>
<li><a href="http://feeds.wordaligned.org/wordaligned"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Articles</a></li>
<li><a href="http://feeds.wordaligned.org/wordaligned/comments"><img src="/images/buttons/feed-icon-14x14.png" alt="feed icon"/> Comments</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Top Tags</h3>
<ul id="categories"><li><a href="/tag/python" rel="tag">Python</a> <em>(130)</em></li>
<li><a href="/tag/c++" rel="tag">C++</a> <em>(71)</em></li>
<li><a href="/tag/self" rel="tag">Self</a> <em>(70)</em></li>
<li><a href="/tag/puzzles" rel="tag">Puzzles</a> <em>(41)</em></li>
<li><a href="/tag/accu" rel="tag">ACCU</a> <em>(33)</em></li>
<li><a href="/tag/subversion" rel="tag">Subversion</a> <em>(27)</em></li>
<li><a href="/tag/web-applications" rel="tag">Web Applications</a> <em>(27)</em></li>
<li><a href="/tag/algorithms" rel="tag">Algorithms</a> <em>(25)</em></li>
<li><a href="/tag/google" rel="tag">Google</a> <em>(19)</em></li>
<li><a href="/tag/streams" rel="tag">Streams</a> <em>(17)</em></li></ul>

</div>

<div class="sidebar-node">
<h3>All Tags</h3>
<p><a href="/tag/accidents" rel="tag">accidents</a>, <a href="/tag/accu" rel="tag">accu</a>, <a href="/tag/agile" rel="tag">agile</a>, <a href="/tag/algorithms" rel="tag">algorithms</a>, <a href="/tag/android" rel="tag">android</a>, <a href="/tag/animation" rel="tag">animation</a>, <a href="/tag/apple" rel="tag">apple</a>, <a href="/tag/arc" rel="tag">arc</a>, <a href="/tag/awk" rel="tag">awk</a>, <a href="/tag/books" rel="tag">books</a>, <a href="/tag/boost" rel="tag">boost</a>, <a href="/tag/bristol" rel="tag">bristol</a>, <a href="/tag/bugs" rel="tag">bugs</a>, <a href="/tag/build" rel="tag">build</a>, <a href="/tag/c" rel="tag">c</a>, <a href="/tag/c++" rel="tag">c++</a>, <a href="/tag/characters" rel="tag">characters</a>, <a href="/tag/charts" rel="tag">charts</a>, <a href="/tag/chess" rel="tag">chess</a>, <a href="/tag/clrs" rel="tag">clrs</a>, <a href="/tag/conferences" rel="tag">conferences</a>, <a href="/tag/content" rel="tag">content</a>, <a href="/tag/crabs" rel="tag">crabs</a>, <a href="/tag/curl" rel="tag">curl</a>, <a href="/tag/cvs" rel="tag">cvs</a>, <a href="/tag/cvs2svn" rel="tag">cvs2svn</a>, <a href="/tag/cycling" rel="tag">cycling</a>, <a href="/tag/decorators" rel="tag">decorators</a>, <a href="/tag/design" rel="tag">design</a>, <a href="/tag/disqus" rel="tag">disqus</a>, <a href="/tag/docbook" rel="tag">docbook</a>, <a href="/tag/documentation" rel="tag">documentation</a>, <a href="/tag/drawing" rel="tag">drawing</a>, <a href="/tag/dynamic-languages" rel="tag">dynamic-languages</a>, <a href="/tag/editors" rel="tag">editors</a>, <a href="/tag/emacs" rel="tag">emacs</a>, <a href="/tag/erlang" rel="tag">erlang</a>, <a href="/tag/esr" rel="tag">esr</a>, <a href="/tag/etc" rel="tag">etc</a>, <a href="/tag/europython" rel="tag">europython</a>, <a href="/tag/fractals" rel="tag">fractals</a>, <a href="/tag/functional-programming" rel="tag">functional-programming</a>, <a href="/tag/github" rel="tag">github</a>, <a href="/tag/go" rel="tag">go</a>, <a href="/tag/google" rel="tag">google</a>, <a href="/tag/graphics" rel="tag">graphics</a>, <a href="/tag/haskell" rel="tag">haskell</a>, <a href="/tag/hoare" rel="tag">hoare</a>, <a href="/tag/ide" rel="tag">ide</a>, <a href="/tag/imagemagick" rel="tag">imagemagick</a>, <a href="/tag/iphone" rel="tag">iphone</a>, <a href="/tag/java" rel="tag">java</a>, <a href="/tag/javascript" rel="tag">javascript</a>, <a href="/tag/knuth" rel="tag">knuth</a>, <a href="/tag/lcs" rel="tag">lcs</a>, <a href="/tag/lighttpd" rel="tag">lighttpd</a>, <a href="/tag/lisp" rel="tag">lisp</a>, <a href="/tag/markdown" rel="tag">markdown</a>, <a href="/tag/missiles" rel="tag">missiles</a>, <a href="/tag/ocr" rel="tag">ocr</a>, <a href="/tag/openid" rel="tag">openid</a>, <a href="/tag/oulipo" rel="tag">oulipo</a>, <a href="/tag/perec" rel="tag">perec</a>, <a href="/tag/perl" rel="tag">perl</a>, <a href="/tag/php" rel="tag">php</a>, <a href="/tag/pi" rel="tag">pi</a>, <a href="/tag/pictures" rel="tag">pictures</a>, <a href="/tag/pil" rel="tag">pil</a>, <a href="/tag/primes" rel="tag">primes</a>, <a href="/tag/puzzles" rel="tag">puzzles</a>, <a href="/tag/python" rel="tag">python</a>, <a href="/tag/recommended" rel="tag">recommended</a>, <a href="/tag/recursion" rel="tag">recursion</a>, <a href="/tag/regex" rel="tag">regex</a>, <a href="/tag/reviews" rel="tag">reviews</a>, <a href="/tag/ruby" rel="tag">ruby</a>, <a href="/tag/ruby-on-rails" rel="tag">ruby-on-rails</a>, <a href="/tag/scheme" rel="tag">scheme</a>, <a href="/tag/scrum" rel="tag">scrum</a>, <a href="/tag/self" rel="tag">self</a>, <a href="/tag/shell" rel="tag">shell</a>, <a href="/tag/sicp" rel="tag">sicp</a>, <a href="/tag/spolsky" rel="tag">spolsky</a>, <a href="/tag/steganography" rel="tag">steganography</a>, <a href="/tag/streams" rel="tag">streams</a>, <a href="/tag/subversion" rel="tag">subversion</a>, <a href="/tag/swansea" rel="tag">swansea</a>, <a href="/tag/syntax" rel="tag">syntax</a>, <a href="/tag/talks" rel="tag">talks</a>, <a href="/tag/teamwork" rel="tag">teamwork</a>, <a href="/tag/tesseract" rel="tag">tesseract</a>, <a href="/tag/tests" rel="tag">tests</a>, <a href="/tag/torvalds" rel="tag">torvalds</a>, <a href="/tag/trac" rel="tag">trac</a>, <a href="/tag/turing" rel="tag">turing</a>, <a href="/tag/two-wheels" rel="tag">two-wheels</a>, <a href="/tag/unicode" rel="tag">unicode</a>, <a href="/tag/unix" rel="tag">unix</a>, <a href="/tag/virtualization" rel="tag">virtualization</a>, <a href="/tag/web-applications" rel="tag">web-applications</a>, <a href="/tag/webapplications" rel="tag">webapplications</a>, <a href="/tag/windows" rel="tag">windows</a>, <a href="/tag/zlib" rel="tag">zlib</a></p>

</div>

<div class="sidebar-node">
<h3>Articles</h3>
<ul>
<li><a href="/articles/">Ordered by date</a></li>
<li><a href="/articles/alphabetical-order/">Alphabetical order</a></li>
</ul>


</div>

<div class="sidebar-node">
<h3>Chain</h3>
<ul>
<li><a accesskey="p" href="/articles/priority-queues-in-python" title="First article">&raquo; Priority queues in Python</a></li>

</ul>


</div>

    </div>
  </div>
  <div id="footer">
<hr />
<p><a href="http://tag.wordaligned.org">Thomas Guest</a></p>
</div>

</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3373724-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>
</body>

</html>
